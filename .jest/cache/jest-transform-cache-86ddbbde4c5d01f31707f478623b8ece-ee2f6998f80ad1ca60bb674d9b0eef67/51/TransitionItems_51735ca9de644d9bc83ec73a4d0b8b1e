20343ea4884398bffe3c498fc7425794
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _TransitionItem = _interopRequireDefault(require("./TransitionItem"));

var TransitionItems = function () {
  function TransitionItems() {
    (0, _classCallCheck2.default)(this, TransitionItems);
    this._items = [];
  }

  (0, _createClass2.default)(TransitionItems, [{
    key: "count",
    value: function count() {
      return this._items.length;
    }
  }, {
    key: "add",
    value: function add(item) {
      if (this._items.findIndex(function (e) {
        return e.name === item.name && e.route === item.route;
      }) >= 0) {
        return false;
      }

      this._items = [].concat((0, _toConsumableArray2.default)(this._items), [item]);
      return true;
    }
  }, {
    key: "remove",
    value: function remove(name, route) {
      var index = this._items.findIndex(function (e) {
        return e.name === name && e.route === route;
      });

      if (index >= 0) {
        this._items = [].concat((0, _toConsumableArray2.default)(this._items.slice(0, index)), (0, _toConsumableArray2.default)(this._items.slice(index + 1)));
        return true;
      }

      return false;
    }
  }, {
    key: "getItems",
    value: function getItems() {
      return this._items;
    }
  }, {
    key: "getRoutes",
    value: function getRoutes() {
      var routes = [];

      for (var i = 0; i < this._items.length; i++) {
        if (!routes.includes(this._items[i].route)) {
          routes.push(this._items[i].route);
        }
      }

      if (routes.length !== 2) {
        throw new Error("Number of routes should be 2, was " + routes.length);
      }

      return {
        fromRoute: routes[0],
        toRoute: routes[1]
      };
    }
  }, {
    key: "getItemByNameAndRoute",
    value: function getItemByNameAndRoute(name, route) {
      return this._items.find(function (e) {
        return e.name === name && e.route === route;
      });
    }
  }, {
    key: "getSharedElements",
    value: function getSharedElements(fromRoute, toRoute) {
      return this._getItemPairs(fromRoute, toRoute).filter(function (pair) {
        return pair.toItem !== undefined && pair.fromItem !== undefined;
      });
    }
  }, {
    key: "getTransitionElements",
    value: function getTransitionElements(fromRoute, toRoute) {
      var itemPairs = this._getItemPairs(fromRoute, toRoute).filter(function (pair) {
        return pair.toItem !== undefined && pair.fromItem !== undefined;
      });

      var items = this._items.filter(function (e) {
        return e.getIsMounted() && (e.appear !== undefined || e.disappear !== undefined) && (e.route === fromRoute || e.route === toRoute);
      });

      items = items.filter(function (e) {
        return itemPairs.findIndex(function (p) {
          return e.name === p.fromItem.name && e.route === p.fromItem.route || e.name === p.toItem.name && e.route === p.toItem.route;
        }) === -1;
      });
      return items;
    }
  }, {
    key: "_getNamePairMap",
    value: function _getNamePairMap(fromRoute, toRoute) {
      var nameMap = this._items.filter(function (p) {
        return p.getIsMounted();
      }).reduce(function (map, item) {
        var pairByName = map.get(item.name);

        if (!pairByName) {
          pairByName = {};
          map.set(item.name, pairByName);
        }

        if (item.route === fromRoute) pairByName.fromItem = item;
        if (item.route === toRoute) pairByName.toItem = item;

        if (!pairByName.fromItem && !pairByName.toItem) {
          map.delete(item.name);
        }

        return map;
      }, new Map());

      return nameMap;
    }
  }, {
    key: "_getItemPairs",
    value: function _getItemPairs(fromRoute, toRoute) {
      var nameMap = this._getNamePairMap(fromRoute, toRoute);

      var pairs = Array.from(nameMap.values());

      var anchorItems = this._items.filter(function (e) {
        return (e.route === fromRoute || e.route === toRoute) && e.anchor;
      });

      return pairs.map(function (p) {
        var fromItem = p.fromItem,
            toItem = p.toItem;

        if (fromItem) {
          fromItem.anchors = anchorItems.filter(function (e) {
            return e.route === p.fromItem.route && e.anchor === p.fromItem.name;
          });
        }

        if (toItem) {
          toItem.anchors = anchorItems.filter(function (e) {
            return e.route === p.toItem.route && e.anchor === p.toItem.name;
          });
        }

        return {
          fromItem: fromItem,
          toItem: toItem
        };
      });
    }
  }]);
  return TransitionItems;
}();

exports.default = TransitionItems;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlRyYW5zaXRpb25JdGVtcy5qcyJdLCJuYW1lcyI6WyJUcmFuc2l0aW9uSXRlbXMiLCJfaXRlbXMiLCJsZW5ndGgiLCJpdGVtIiwiZmluZEluZGV4IiwiZSIsIm5hbWUiLCJyb3V0ZSIsImluZGV4Iiwic2xpY2UiLCJyb3V0ZXMiLCJpIiwiaW5jbHVkZXMiLCJwdXNoIiwiRXJyb3IiLCJmcm9tUm91dGUiLCJ0b1JvdXRlIiwiZmluZCIsIl9nZXRJdGVtUGFpcnMiLCJmaWx0ZXIiLCJwYWlyIiwidG9JdGVtIiwidW5kZWZpbmVkIiwiZnJvbUl0ZW0iLCJpdGVtUGFpcnMiLCJpdGVtcyIsImdldElzTW91bnRlZCIsImFwcGVhciIsImRpc2FwcGVhciIsInAiLCJuYW1lTWFwIiwicmVkdWNlIiwibWFwIiwicGFpckJ5TmFtZSIsImdldCIsInNldCIsImRlbGV0ZSIsIk1hcCIsIl9nZXROYW1lUGFpck1hcCIsInBhaXJzIiwiQXJyYXkiLCJmcm9tIiwidmFsdWVzIiwiYW5jaG9ySXRlbXMiLCJhbmNob3IiLCJhbmNob3JzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBQ0E7O0lBRXFCQSxlO0FBQ25CLDZCQUFjO0FBQUE7QUFDWixTQUFLQyxNQUFMLEdBQWMsRUFBZDtBQUNEOzs7OzRCQUllO0FBQ2QsYUFBTyxLQUFLQSxNQUFMLENBQVlDLE1BQW5CO0FBQ0Q7Ozt3QkFFR0MsSSxFQUErQjtBQUNqQyxVQUFJLEtBQUtGLE1BQUwsQ0FBWUcsU0FBWixDQUFzQixVQUFBQyxDQUFDO0FBQUEsZUFBSUEsQ0FBQyxDQUFDQyxJQUFGLEtBQVdILElBQUksQ0FBQ0csSUFBaEIsSUFBd0JELENBQUMsQ0FBQ0UsS0FBRixLQUFZSixJQUFJLENBQUNJLEtBQTdDO0FBQUEsT0FBdkIsS0FBOEUsQ0FBbEYsRUFBcUY7QUFDbkYsZUFBTyxLQUFQO0FBQ0Q7O0FBQ0QsV0FBS04sTUFBTCw4Q0FBa0IsS0FBS0EsTUFBdkIsSUFBK0JFLElBQS9CO0FBQ0EsYUFBTyxJQUFQO0FB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O0FBRUQ7O0FBQ0QsWUFBSWUsTUFBSixFQUFZO0FBQ1ZBLFVBQUFBLE1BQU0sQ0FBQ3dCLE9BQVAsR0FBaUJGLFdBQVcsQ0FBQ3hCLE1BQVosQ0FBbUIsVUFBQWQsQ0FBQztBQUFBLG1CQUFJQSxDQUFDLENBQUNFLEtBQUYsS0FBWXNCLENBQUMsQ0FBQ1IsTUFBRixDQUFTZCxLQUFyQixJQUN0Q0YsQ0FBQyxDQUFDdUMsTUFBRixLQUFhZixDQUFDLENBQUNSLE1BQUYsQ0FBU2YsSUFEWTtBQUFBLFdBQXBCLENBQWpCO0FBRUQ7O0FBQ0QsZUFBTztBQUFFaUIsVUFBQUEsUUFBUSxFQUFSQSxRQUFGO0FBQVlGLFVBQUFBLE1BQU0sRUFBTkE7QUFBWixTQUFQO0FBQ0QsT0FYTSxDQUFQO0FBWUQiLCJzb3VyY2VzQ29udGVudCI6WyJcbmltcG9ydCBUcmFuc2l0aW9uSXRlbSBmcm9tICcuL1RyYW5zaXRpb25JdGVtJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgVHJhbnNpdGlvbkl0ZW1zIHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5faXRlbXMgPSBbXTtcbiAgfVxuXG4gIF9pdGVtczogQXJyYXk8VHJhbnNpdGlvbkl0ZW0+XG5cbiAgY291bnQoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5faXRlbXMubGVuZ3RoO1xuICB9XG5cbiAgYWRkKGl0ZW06IFRyYW5zaXRpb25JdGVtKTogYm9vbGVhbiB7XG4gICAgaWYgKHRoaXMuX2l0ZW1zLmZpbmRJbmRleChlID0+IGUubmFtZSA9PT0gaXRlbS5uYW1lICYmIGUucm91dGUgPT09IGl0ZW0ucm91dGUpID49IDApIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgdGhpcy5faXRlbXMgPSBbLi4udGhpcy5faXRlbXMsIGl0ZW1dO1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgcmVtb3ZlKG5hbWU6IHN0cmluZywgcm91dGU6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IGluZGV4ID0gdGhpcy5faXRlbXMuZmluZEluZGV4KGUgPT4gZS5uYW1lID09PSBuYW1lICYmIGUucm91dGUgPT09IHJvdXRlKTtcbiAgICBpZiAoaW5kZXggPj0gMCkge1xuICAgICAgdGhpcy5faXRlbXMgPSBbLi4udGhpcy5faXRlbXMuc2xpY2UoMCwgaW5kZXgpLCAuLi50aGlzLl9pdGVtcy5zbGljZShpbmRleCArIDEpXTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBnZXRJdGVtcygpIHtcbiAgICByZXR1cm4gdGhpcy5faXRlbXM7XG4gIH1cblxuICBnZXRSb3V0ZXMoKSB7XG4gICAgY29uc3Qgcm91dGVzID0gW107XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLl9pdGVtcy5sZW5ndGg7IGkrKykge1xuICAgICAgaWYgKCFyb3V0ZXMuaW5jbHVkZXModGhpcy5faXRlbXNbaV0ucm91dGUpKSB7XG4gICAgICAgIHJvdXRlcy5wdXNoKHRoaXMuX2l0ZW1zW2ldLnJvdXRlKTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHJvdXRlcy5sZW5ndGggIT09IDIpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgTnVtYmVyIG9mIHJvdXRlcyBzaG91bGQgYmUgMiwgd2FzICR7cm91dGVzLmxlbmd0aH1gKTtcbiAgICB9XG5cbiAgICByZXR1cm4geyBmcm9tUm91dGU6IHJvdXRlc1swXSwgdG9Sb3V0ZTogcm91dGVzWzFdIH07XG4gIH1cblxuICBnZXRJdGVtQnlOYW1lQW5kUm91dGUobmFtZTogc3RyaW5nLCByb3V0ZTogc3RyaW5nKTogVHJhbnNpdGlvbkl0ZW0ge1xuICAgIHJldHVybiB0aGlzLl9pdGVtcy5maW5kKGUgPT4gZS5uYW1lID09PSBuYW1lICYmIGUucm91dGUgPT09IHJvdXRlKTtcbiAgfVxuXG4gIGdldFNoYXJlZEVsZW1lbnRzKGZyb21Sb3V0ZTogc3RyaW5nLCB0b1JvdXRlOiBzdHJpbmcpOiBBcnJheTxUcmFuc2l0aW9uSXRlbT4ge1xuICAgIHJldHVybiB0aGlzLl9nZXRJdGVtUGFpcnMoZnJvbVJvdXRlLCB0b1JvdXRlKVxuICAgICAgLmZpbHRlcihwYWlyID0+IHBhaXIudG9JdGVtICE9PSB1bmRlZmluZWQgJiYgcGFpci5mcm9tSXRlbSAhPT0gdW5kZWZpbmVkKTtcbiAgfVxuXG4gIGdldFRyYW5zaXRpb25FbGVtZW50cyhmcm9tUm91dGU6IHN0cmluZywgdG9Sb3V0ZTogc3RyaW5nKTogQXJyYXk8VHJhbnNpdGlvbkl0ZW0+IHtcbiAgICBjb25zdCBpdGVtUGFpcnMgPSB0aGlzLl9nZXRJdGVtUGFpcnMoZnJvbVJvdXRlLCB0b1JvdXRlKVxuICAgICAgLmZpbHRlcihwYWlyID0+IHBhaXIudG9JdGVtICE9PSB1bmRlZmluZWQgJiYgcGFpci5mcm9tSXRlbSAhPT0gdW5kZWZpbmVkKTtcblxuICAgIGxldCBpdGVtcyA9IHRoaXMuX2l0ZW1zLmZpbHRlcihlID0+IGUuZ2V0SXNNb3VudGVkKCkgJiYgKGUuYXBwZWFyICE9PSB1bmRlZmluZWRcbiAgICAgIHx8IGUuZGlzYXBwZWFyICE9PSB1bmRlZmluZWQpICYmIChlLnJvdXRlID09PSBmcm9tUm91dGUgfHwgZS5yb3V0ZSA9PT0gdG9Sb3V0ZSkpO1xuXG5cbiAgICBpdGVtcyA9IGl0ZW1zLmZpbHRlcihlID0+IGl0ZW1QYWlycy5maW5kSW5kZXgocCA9PiAoZS5uYW1lID09PSBwLmZyb21JdGVtLm5hbWVcbiAgICAgICYmIGUucm91dGUgPT09IHAuZnJvbUl0ZW0ucm91dGUpXG4gICAgICB8fCAoZS5uYW1lID09PSBwLnRvSXRlbS5uYW1lICYmIGUucm91dGUgPT09IHAudG9JdGVtLnJvdXRlKSkgPT09IC0xKTtcblxuICAgIHJldHVybiBpdGVtcztcbiAgfVxuXG4gIF9nZXROYW1lUGFpck1hcChmcm9tUm91dGU6IHN0cmluZywgdG9Sb3V0ZTogc3RyaW5nKTogTWFwPFRyYW5zaXRpb25JdGVtLCBUcmFuc2l0aW9uSXRlbT4ge1xuICAgIGNvbnN0IG5hbWVNYXAgPSB0aGlzLl9pdGVtcy5maWx0ZXIocCA9PiBwLmdldElzTW91bnRlZCgpKS5yZWR1Y2UoKG1hcCwgaXRlbSkgPT4ge1xuICAgICAgbGV0IHBhaXJCeU5hbWUgPSBtYXAuZ2V0KGl0ZW0ubmFtZSk7XG4gICAgICBpZiAoIXBhaXJCeU5hbWUpIHtcbiAgICAgICAgcGFpckJ5TmFtZSA9IHt9O1xuICAgICAgICBtYXAuc2V0KGl0ZW0ubmFtZSwgcGFpckJ5TmFtZSk7XG4gICAgICB9XG4gICAgICBpZiAoaXRlbS5yb3V0ZSA9PT0gZnJvbVJvdXRlKSBwYWlyQnlOYW1lLmZyb21JdGVtID0gaXRlbTtcbiAgICAgIGlmIChpdGVtLnJvdXRlID09PSB0b1JvdXRlKSBwYWlyQnlOYW1lLnRvSXRlbSA9IGl0ZW07XG4gICAgICAvLyBkZWxldGUgZW1wdHkgcGFpcnNcbiAgICAgIGlmICghcGFpckJ5TmFtZS5mcm9tSXRlbSAmJiAhcGFpckJ5TmFtZS50b0l0ZW0pIHsgbWFwLmRlbGV0ZShpdGVtLm5hbWUpOyB9XG5cbiAgICAgIHJldHVybiBtYXA7XG4gICAgfSwgbmV3IE1hcCgpKTtcblxuICAgIHJldHVybiBuYW1lTWFwO1xuICB9XG5cbiAgX2dldEl0ZW1QYWlycyhmcm9tUm91dGU6IHN0cmluZywgdG9Sb3V0ZTogc3RyaW5nKTogQXJyYXk8VHJhbnNpdGlvbkl0ZW0+IHtcbiAgICBjb25zdCBuYW1lTWFwID0gdGhpcy5fZ2V0TmFtZVBhaXJNYXAoZnJvbVJvdXRlLCB0b1JvdXRlKTtcbiAgICBjb25zdCBwYWlycyA9IEFycmF5LmZyb20obmFtZU1hcC52YWx1ZXMoKSk7XG4gICAgY29uc3QgYW5jaG9ySXRlbXMgPSB0aGlzLl9pdGVtc1xuICAgICAgLmZpbHRlcihlID0+IChlLnJvdXRlID09PSBmcm9tUm91dGUgfHwgZS5yb3V0ZSA9PT0gdG9Sb3V0ZSkgJiYgZS5hbmNob3IpO1xuXG4gICAgcmV0dXJuIHBhaXJzLm1hcChwID0+IHtcbiAgICAgIGNvbnN0IHsgZnJvbUl0ZW0sIHRvSXRlbSB9ID0gcDtcbiAgICAgIGlmIChmcm9tSXRlbSkge1xuICAgICAgICBmcm9tSXRlbS5hbmNob3JzID0gYW5jaG9ySXRlbXMuZmlsdGVyKGUgPT4gZS5yb3V0ZSA9PT0gcC5mcm9tSXRlbS5yb3V0ZVxuICAgICAgICAmJiBlLmFuY2hvciA9PT0gcC5mcm9tSXRlbS5uYW1lKTtcbiAgICAgIH1cbiAgICAgIGlmICh0b0l0ZW0pIHtcbiAgICAgICAgdG9JdGVtLmFuY2hvcnMgPSBhbmNob3JJdGVtcy5maWx0ZXIoZSA9PiBlLnJvdXRlID09PSBwLnRvSXRlbS5yb3V0ZVxuICAgICAgICAmJiBlLmFuY2hvciA9PT0gcC50b0l0ZW0ubmFtZSk7XG4gICAgICB9XG4gICAgICByZXR1cm4geyBmcm9tSXRlbSwgdG9JdGVtIH07XG4gICAgfSk7XG4gIH1cbn1cbiJdfQ==