{"version":3,"sources":["TransitionItems.js"],"names":["TransitionItems","_items","length","item","findIndex","e","name","route","index","slice","routes","i","includes","push","Error","fromRoute","toRoute","find","_getItemPairs","filter","pair","toItem","undefined","fromItem","itemPairs","items","getIsMounted","appear","disappear","p","nameMap","reduce","map","pairByName","get","set","delete","Map","_getNamePairMap","pairs","Array","from","values","anchorItems","anchor","anchors"],"mappings":"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","sourcesContent":["\nimport TransitionItem from './TransitionItem';\n\nexport default class TransitionItems {\n  constructor() {\n    this._items = [];\n  }\n\n  _items: Array<TransitionItem>\n\n  count(): number {\n    return this._items.length;\n  }\n\n  add(item: TransitionItem): boolean {\n    if (this._items.findIndex(e => e.name === item.name && e.route === item.route) >= 0) {\n      return false;\n    }\n    this._items = [...this._items, item];\n    return true;\n  }\n\n  remove(name: string, route: string): boolean {\n    const index = this._items.findIndex(e => e.name === name && e.route === route);\n    if (index >= 0) {\n      this._items = [...this._items.slice(0, index), ...this._items.slice(index + 1)];\n      return true;\n    }\n    return false;\n  }\n\n  getItems() {\n    return this._items;\n  }\n\n  getRoutes() {\n    const routes = [];\n    for (let i = 0; i < this._items.length; i++) {\n      if (!routes.includes(this._items[i].route)) {\n        routes.push(this._items[i].route);\n      }\n    }\n    if (routes.length !== 2) {\n      throw new Error(`Number of routes should be 2, was ${routes.length}`);\n    }\n\n    return { fromRoute: routes[0], toRoute: routes[1] };\n  }\n\n  getItemByNameAndRoute(name: string, route: string): TransitionItem {\n    return this._items.find(e => e.name === name && e.route === route);\n  }\n\n  getSharedElements(fromRoute: string, toRoute: string): Array<TransitionItem> {\n    return this._getItemPairs(fromRoute, toRoute)\n      .filter(pair => pair.toItem !== undefined && pair.fromItem !== undefined);\n  }\n\n  getTransitionElements(fromRoute: string, toRoute: string): Array<TransitionItem> {\n    const itemPairs = this._getItemPairs(fromRoute, toRoute)\n      .filter(pair => pair.toItem !== undefined && pair.fromItem !== undefined);\n\n    let items = this._items.filter(e => e.getIsMounted() && (e.appear !== undefined\n      || e.disappear !== undefined) && (e.route === fromRoute || e.route === toRoute));\n\n\n    items = items.filter(e => itemPairs.findIndex(p => (e.name === p.fromItem.name\n      && e.route === p.fromItem.route)\n      || (e.name === p.toItem.name && e.route === p.toItem.route)) === -1);\n\n    return items;\n  }\n\n  _getNamePairMap(fromRoute: string, toRoute: string): Map<TransitionItem, TransitionItem> {\n    const nameMap = this._items.filter(p => p.getIsMounted()).reduce((map, item) => {\n      let pairByName = map.get(item.name);\n      if (!pairByName) {\n        pairByName = {};\n        map.set(item.name, pairByName);\n      }\n      if (item.route === fromRoute) pairByName.fromItem = item;\n      if (item.route === toRoute) pairByName.toItem = item;\n      // delete empty pairs\n      if (!pairByName.fromItem && !pairByName.toItem) { map.delete(item.name); }\n\n      return map;\n    }, new Map());\n\n    return nameMap;\n  }\n\n  _getItemPairs(fromRoute: string, toRoute: string): Array<TransitionItem> {\n    const nameMap = this._getNamePairMap(fromRoute, toRoute);\n    const pairs = Array.from(nameMap.values());\n    const anchorItems = this._items\n      .filter(e => (e.route === fromRoute || e.route === toRoute) && e.anchor);\n\n    return pairs.map(p => {\n      const { fromItem, toItem } = p;\n      if (fromItem) {\n        fromItem.anchors = anchorItems.filter(e => e.route === p.fromItem.route\n        && e.anchor === p.fromItem.name);\n      }\n      if (toItem) {\n        toItem.anchors = anchorItems.filter(e => e.route === p.toItem.route\n        && e.anchor === p.toItem.name);\n      }\n      return { fromItem, toItem };\n    });\n  }\n}\n"]}