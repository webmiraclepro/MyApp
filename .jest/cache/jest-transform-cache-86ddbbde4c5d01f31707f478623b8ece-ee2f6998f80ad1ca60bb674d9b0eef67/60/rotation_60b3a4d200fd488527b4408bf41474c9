94283109ace5209bd4c54f12c7d6da65
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.radToDeg = exports.degToRad = exports.getQuadrant = exports.getBoundingBox = exports.rotatePoint = exports.getOriginalRect = void 0;

var _Metrics = require("../Types/Metrics");

var getOriginalRect = function getOriginalRect(params) {
  if (params.theta === 0) {
    return params.boundingBox;
  }

  var _params$boundingBox = params.boundingBox,
      x = _params$boundingBox.x,
      y = _params$boundingBox.y,
      width = _params$boundingBox.width,
      height = _params$boundingBox.height;

  if (params.skipWidth) {
    var cx = x + (Math.cos(params.theta) * width - Math.sin(params.theta) * height) / 2;
    var cy = y + (Math.sin(params.theta) * width + Math.cos(params.theta) * height) / 2;
    var p0 = rotatePoint({
      x: x,
      y: y,
      cx: cx,
      cy: cy,
      theta: params.theta
    });
    return {
      x: Math.round(p0.x),
      y: Math.round(p0.y),
      width: width,
      height: height
    };
  }

  var theta = -1 * params.theta;
  var cos = Math.cos(theta);
  var sin = Math.sin(theta);

  if (Math.abs(Math.abs(sin) - Math.abs(cos)) <= Number.EPSILON) {
    theta = small + theta;
    cos = Math.cos(theta);
    sin = Math.sin(theta);
  }

  var quad = getQuadrant(theta);
  var a = 1 / (Math.pow(cos, 2) - Math.pow(sin, 2));
  var aw = 1 * width * cos;
  var bw = height * sin;
  var nw = quad === 0 || quad === 2 ? a * (aw - bw) : a * (aw + bw);
  var ah = -1 * width * sin;
  var bh = height * cos;
  var nh = quad === 0 || quad === 2 ? a * (ah + bh) : a * (ah - bh);
  var retVal = {
    x: Math.round(x + (width - Math.abs(nw)) * 0.5),
    y: Math.round(y + (height - Math.abs(nh)) * 0.5),
    width: Math.abs(Math.round(nw)),
    height: Math.abs(Math.round(nh))
  };
  return retVal;
};

exports.getOriginalRect = getOriginalRect;

var rotatePoint = function rotatePoint(params) {
  var x = params.x,
      y = params.y,
      cx = params.cx,
      cy = params.cy,
      theta = params.theta;
  var cos = Math.cos(theta);
  var sin = Math.sin(theta);
  var nx = cos * (x - cx) + sin * (y - cy) + cx;
  var ny = cos * (y - cy) - sin * (x - cx) + cy;
  return {
    x: nx,
    y: ny
  };
};

exports.rotatePoint = rotatePoint;

var getBoundingBox = function getBoundingBox(params) {
  var _params$rect = params.rect,
      x = _params$rect.x,
      y = _params$rect.y,
      width = _params$rect.width,
      height = _params$rect.height;
  var theta = params.theta;
  var cx = x + width / 2;
  var cy = y + height / 2;
  var tl = rotatePoint({
    x: x,
    y: y,
    cx: cx,
    cy: cy,
    theta: theta
  });
  var bl = rotatePoint({
    x: x,
    y: y + height,
    cx: cx,
    cy: cy,
    theta: theta
  });
  var tr = rotatePoint({
    x: x + width,
    y: y,
    cx: cx,
    cy: cy,
    theta: theta
  });
  var br = rotatePoint({
    x: x + width,
    y: y + height,
    cx: cx,
    cy: cy,
    theta: theta
  });
  var minX = Math.min(tl.x, bl.x, tr.x, br.x);
  var maxX = Math.max(tl.x, bl.x, tr.x, br.x);
  var minY = Math.min(tl.y, bl.y, tr.y, br.y);
  var maxY = Math.max(tl.y, bl.y, tr.y, br.y);
  return {
    x: minX,
    y: minY,
    width: maxX - minX,
    height: maxY - minY
  };
};

exports.getBoundingBox = getBoundingBox;

var getQuadrant = function getQuadrant(theta) {
  var angle = theta * 180 / Math.PI;
  var normangle = angle % 360;

  if (normangle < 0) {
    normangle += 360;
  }

  var p = normangle / 360;
  if (p >= 0 && p <= 0.25) return 0;
  if (p > 0.25 && p <= 0.5) return 1;
  if (p > 0.5 && p <= 0.75) return 2;
  if (p > 0.75 && p <= 1) return 3;
  return -1;
};

exports.getQuadrant = getQuadrant;

var degToRad = function degToRad(deg) {
  return deg * Math.PI / 180;
};

exports.degToRad = degToRad;

var radToDeg = function radToDeg(rad) {
  return rad * 180 / Math.PI;
};

exports.radToDeg = radToDeg;
var small = degToRad(0.00000001);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJvdGF0aW9uLmpzIl0sIm5hbWVzIjpbImdldE9yaWdpbmFsUmVjdCIsInBhcmFtcyIsInRoZXRhIiwiYm91bmRpbmdCb3giLCJ4IiwieSIsIndpZHRoIiwiaGVpZ2h0Iiwic2tpcFdpZHRoIiwiY3giLCJNYXRoIiwiY29zIiwic2luIiwiY3kiLCJwMCIsInJvdGF0ZVBvaW50Iiwicm91bmQiLCJhYnMiLCJOdW1iZXIiLCJFUFNJTE9OIiwic21hbGwiLCJxdWFkIiwiZ2V0UXVhZHJhbnQiLCJhIiwicG93IiwiYXciLCJidyIsIm53IiwiYWgiLCJiaCIsIm5oIiwicmV0VmFsIiwibngiLCJueSIsImdldEJvdW5kaW5nQm94IiwicmVjdCIsInRsIiwiYmwiLCJ0ciIsImJyIiwibWluWCIsIm1pbiIsIm1heFgiLCJtYXgiLCJtaW5ZIiwibWF4WSIsImFuZ2xlIiwiUEkiLCJub3JtYW5nbGUiLCJwIiwiZGVnVG9SYWQiLCJkZWciLCJyYWRUb0RlZyIsInJhZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFDQTs7QUFRTyxJQUFNQSxlQUFlLEdBQUcsU0FBbEJBLGVBQWtCLENBQUNDLE1BQUQsRUFBZ0Q7QUFDN0UsTUFBSUEsTUFBTSxDQUFDQyxLQUFQLEtBQWlCLENBQXJCLEVBQXdCO0FBQ3RCLFdBQU9ELE1BQU0sQ0FBQ0UsV0FBZDtBQUNEOztBQUg0RSw0QkFLN0NGLE1BQU0sQ0FBQ0UsV0FMc0M7QUFBQSxNQUtyRUMsQ0FMcUUsdUJBS3JFQSxDQUxxRTtBQUFBLE1BS2xFQyxDQUxrRSx1QkFLbEVBLENBTGtFO0FBQUEsTUFLL0RDLEtBTCtELHVCQUsvREEsS0FMK0Q7QUFBQSxNQUt4REMsTUFMd0QsdUJBS3hEQSxNQUx3RDs7QUFPN0UsTUFBSU4sTUFBTSxDQUFDTyxTQUFYLEVBQXNCO0FBQ3BCLFFBQU1DLEVBQUUsR0FBR0wsQ0FBQyxHQUFJLENBQUNNLElBQUksQ0FBQ0MsR0FBTCxDQUFTVixNQUFNLENBQUNDLEtBQWhCLElBQXlCSSxLQUF6QixHQUFpQ0ksSUFBSSxDQUFDRSxHQUFMLENBQVNYLE1BQU0sQ0FBQ0MsS0FBaEIsSUFBeUJLLE1BQTNELElBQXFFLENBQXJGO0FBQ0EsUUFBTU0sRUFBRSxHQUFHUixDQUFDLEdBQUksQ0FBQ0ssSUFBSSxDQUFDRSxHQUFMLENBQVNYLE1BQU0sQ0FBQ0MsS0FBaEIsSUFBeUJJLEtBQXpCLEdBQWlDSSxJQUFJLENBQUNDLEdBQUwsQ0FBU1YsTUFBTSxDQUFDQyxLQUFoQixJQUF5QkssTUFBM0QsSUFBcUUsQ0FBckY7QUFDQSxRQUFNTyxFQUFFLEdBQUdDLFdBQVcsQ0FBQztBQUFFWCxNQUFBQSxDQUFDLEVBQURBLENBQUY7QUFBS0MsTUFBQUEsQ0FBQyxFQUFEQSxDQUFMO0FBQVFJLE1BQUFBLEVBQUUsRUFBRkEsRUFBUjtBQUFZSSxNQUFBQSxFQUFFLEVBQUZBLEVBQVo7QUFBZ0JYLE1BQUFBLEtBQUssRUFBRUQsTUFBTSxDQUFDQztBQUE5QixLQUFELENBQXRCO0FBQ0EsV0FBTztBQUFFRSxNQUFBQSxDQUFDLEVBQUVNLElBQUksQ0FBQ00sS0FBTCxDQUFXRixFQUFFLENBQUNWLENBQWQsQ0FBTDtBQUF1QkMsTUFBQUEsQ0FBQyxFQUFFSyxJQUFJLENBQUNNLEtBQUwsQ0FBV0YsRUFBRSxDQUFDVCxDQUFkLENBQTFCO0FBQTRDQyxNQUFBQSxLQUFLLEVBQUxBLEtBQTVDO0FBQW1EQyxNQUFBQSxNQUFNLEVBQU5BO0FBQW5ELEtBQVA7QUFDRDs7QUFFRCxNQUFJTCxLQUFLLEdBQUcsQ0FBQyxDQUFELEdBQUtELE1BQU0sQ0FBQ0MsS0FBeEI7QUFDQSxNQUFJUyxHQUFHLEdBQUdELElBQUksQ0FBQ0MsR0FBTCxDQUFTVCxLQUFULENBQVY7QUFDQSxNQUFJVSxHQUFHLEdBQUdGLElBQUksQ0FBQ0UsR0FBTCxDQUFTVixLQUFULENBQVY7O0FBRUEsTUFBSVEsSUFBSSxDQUFDTyxHQUFMLENBQVNQLElBQUksQ0FBQ08sR0FBTCxDQUFTTCxHQUFULElBQWdCRixJQUFJLENBQUNPLEdBQUwsQ0FBU04sR0FBVCxDQUF6QixLQUEyQ08sTUFBTSxDQUFDQyxPQUF0RCxFQUErRDtBQUM3RGpCLElBQUFBLEtBQUssR0FBR2tCLEtBQUssR0FBR2xCLEtBQWhCO0FBQ0FTLElBQUFBLEdBQUcsR0FBR0QsSUFBSSxDQUFDQyxHQUFMLENBQVNULEtBQVQsQ0FBTjtBQUNBVSxJQUFBQSxHQUFHLEdBQUdGLElBQUksQ0FBQ0UsR0FBTCxDQUFTVixLQUFULENBQU47QUFDRDs7QUFHRCxNQUFNbUIsSUFBSSxHQUFHQyxXQUFXLENBQUNwQixLQUFELENBQXhCO0FBQ0EsTUFBTXFCLENBQUMsR0FBRyxLQUFLYixJQUFJLENBQUNjLEdBQUwsQ0FBU2IsR0FBVCxFQUFjLENBQWQsSUFBb0JELElBQUksQ0FBQ2MsR0FBTCxDQUFTWixHQUFULEVBQWMsQ0FBZCxDQUF6QixDQUFWO0FBRUEsTUFBTWEsRUFBRSxHQUFJLElBQUluQixLQUFMLEdBQWNLLEdBQXpCO0FBQ0EsTUFBTWUsRUFBRSxHQUFJbkIsTUFBTSxHQUFHSyxHQUFyQjtBQUNBLE1BQU1lLEVBQUUsR0FBSU4sSUFBSSxLQUFLLENBQVQsSUFBY0EsSUFBSSxLQUFLLENBQXhCLEdBQTZCRSxDQUFDLElBQUlFLEVBQUUsR0FBR0MsRUFBVCxDQUE5QixHQUE2Q0gsQ0FBQyxJQUFJRSxFQUFFLEdBQUdDLEVBQVQsQ0FBekQ7QUFFQSxNQUFNRSxFQUFFLEdBQUksQ0FBQyxDQUFELEdBQUt0QixLQUFOLEdBQWVNLEdBQTFCO0FBQ0EsTUFBTWlCLEVBQUUsR0FBSXRCLE1BQU0sR0FBR0ksR0FBckI7QUFDQSxNQUFNbUIsRUFBRSxHQUFJVCxJQUFJLEtBQUssQ0FBVCxJQUFjQSxJQUFJLEtBQUssQ0FBeEIsR0FBNkJFLENBQUMsSUFBSUssRUFBRSxHQUFHQyxFQUFULENBQTlCLEdBQTZDTixDQUFDLElBQUlLLEVBQUUsR0FBR0MsRUFBVCxDQUF6RDtBQUVBLE1BQU1FLE1BQU0sR0FBRztBQUNiM0IsSUFBQUEsQ0FBQyxFQUFFTSxJQUFJLENBQUNNLEtBQUwsQ0FBV1osQ0FBQyxHQUFHLENBQUNFLEtBQUssR0FBR0ksSUFBSSxDQUFDTyxHQUFMLENBQVNVLEVBQVQsQ0FBVCxJQUF5QixHQUF4QyxDQURVO0FBRWJ0QixJQUFBQSxDQUFDLEVBQUVLLElBQUksQ0FBQ00sS0FBTCxDQUFXWCxDQUFDLEdBQUcsQ0FBQ0UsTUFBTSxHQUFHRyxJQUFJLENBQUNPLEdBQUwsQ0FBU2EsRUFBVCxDQUFWLElBQTBCLEdBQXpDLENBRlU7QUFHYnhCLElBQUFBLEtBQUssRUFBRUksSUFBSSxDQUFDTyxHQUFMLENBQVNQLElBQUksQ0FBQ00sS0FBTCxDQUFXVyxFQUFYLENBQVQsQ0FITTtBQUlicEIsSUFBQUEsTUFBTSxFQUFFRyxJQUFJLENBQUNPLEdBQUwsQ0FBU1AsSUFBSSxDQUFDTSxLQUFMLENBQVdjLEVBQVgsQ0FBVDtBQUpLLEdBQWY7QUFNQSxTQUFPQyxNQUFQO0FBQ0QsQ0EzQ007Ozs7QUFvREEsSUFBTWhCLFdBQVcsR0FBRyxTQUFkQSxXQUFjLENBQUNkLE1BQUQsRUFBbUM7QUFBQSxNQUNwREcsQ0FEb0QsR0FDNUJILE1BRDRCLENBQ3BERyxDQURvRDtBQUFBLE1BQ2pEQyxDQURpRCxHQUM1QkosTUFENEIsQ0FDakRJLENBRGlEO0FBQUEsTUFDOUNJLEVBRDhDLEdBQzVCUixNQUQ0QixDQUM5Q1EsRUFEOEM7QUFBQSxNQUMxQ0ksRUFEMEMsR0FDNUJaLE1BRDRCLENBQzFDWSxFQUQwQztBQUFBLE1BQ3RDWCxLQURzQyxHQUM1QkQsTUFENEIsQ0FDdENDLEtBRHNDO0FBRzVELE1BQU1TLEdBQUcsR0FBR0QsSUFBSSxDQUFDQyxHQUFMLENBQVNULEtBQVQsQ0FBWjtBQUNBLE1BQU1VLEdBQUcsR0FBR0YsSUFBSSxDQUFDRSxHQUFMLENBQVNWLEtBQVQsQ0FBWjtBQUNBLE1BQU04QixFQUFFLEdBQUlyQixHQUFHLElBQUlQLENBQUMsR0FBR0ssRUFBUixDQUFKLEdBQW9CRyxHQUFHLElBQUlQLENBQUMsR0FBR1EsRUFBUixDQUF2QixHQUFzQ0osRUFBakQ7QUFDQSxNQUFNd0IsRUFBRSxHQUFJdEIsR0FBRyxJQUFJTixDQUFDLEdBQUdRLEVBQVIsQ0FBSixHQUFvQkQsR0FBRyxJQUFJUixDQUFDLEdBQUdLLEVBQVIsQ0FBdkIsR0FBc0NJLEVBQWpEO0FBQ0EsU0FBTztBQUFFVCxJQUFBQSxDQUFDLEVBQUU0QixFQUFMO0FBQVMzQixJQUFBQSxDQUFDLEVBQUU0QjtBQUFaLEdBQVA7QUFDRCxDQVJNOzs7O0FBY0EsSUFBTUMsY0FBYyxHQUFHLFNBQWpCQSxjQUFpQixDQUFDakMsTUFBRCxFQUFzQztBQUFBLHFCQUNsQ0EsTUFBTSxDQUFDa0MsSUFEMkI7QUFBQSxNQUMxRC9CLENBRDBELGdCQUMxREEsQ0FEMEQ7QUFBQSxNQUN2REMsQ0FEdUQsZ0JBQ3ZEQSxDQUR1RDtBQUFBLE1BQ3BEQyxLQURvRCxnQkFDcERBLEtBRG9EO0FBQUEsTUFDN0NDLE1BRDZDLGdCQUM3Q0EsTUFENkM7QUFBQSxNQUUxREwsS0FGMEQsR0FFaERELE1BRmdELENBRTFEQyxLQUYwRDtBQUlsRSxNQUFNTyxFQUFFLEdBQUdMLENBQUMsR0FBSUUsS0FBSyxHQUFHLENBQXhCO0FBQ0EsTUFBTU8sRUFBRSxHQUFHUixDQUFDLEdBQUlFLE1BQU0sR0FBRyxDQUF6QjtBQUVBLE1BQU02QixFQUFFLEdBQUdyQixXQUFXLENBQUM7QUFBRVgsSUFBQUEsQ0FBQyxFQUFEQSxDQUFGO0FBQUtDLElBQUFBLENBQUMsRUFBREEsQ0FBTDtBQUFRSSxJQUFBQSxFQUFFLEVBQUZBLEVBQVI7QUFBWUksSUFBQUEsRUFBRSxFQUFGQSxFQUFaO0FBQWdCWCxJQUFBQSxLQUFLLEVBQUxBO0FBQWhCLEdBQUQsQ0FBdEI7QUFDQSxNQUFNbUMsRUFBRSxHQUFHdEIsV0FBVyxDQUFDO0FBQUVYLElBQUFBLENBQUMsRUFBREEsQ0FBRjtBQUFLQyxJQUFBQSxDQUFDLEVBQUVBLENBQUMsR0FBR0UsTUFBWjtBQUFvQkUsSUFBQUEsRUFBRSxFQUFGQSxFQUFwQjtBQUF3QkksSUFBQUEsRUFBRSxFQUFGQSxFQUF4QjtBQUE0QlgsSUFBQUEsS0FBSyxFQUFMQTtBQUE1QixHQUFELENBQXRCO0FBQ0EsTUFBTW9DLEVBQUUsR0FBR3ZCLFdBQVcsQ0FBQztBQUFFWCxJQUFBQSxDQUFDLEVBQUVBLENBQUMsR0FBR0UsS0FBVDtBQUFnQkQsSUFBQUEsQ0FBQyxFQUFEQSxDQUFoQjtBQUFtQkksSUFBQUEsRUFBRSxFQUFGQSxFQUFuQjtBQUF1QkksSUFBQUEsRUFBRSxFQUFGQSxFQUF2QjtBQUEyQlgsSUFBQUEsS0FBSyxFQUFMQTtBQUEzQixHQUFELENBQXRCO0FBQ0EsTUFBTXFDLEVBQUUsR0FBR3hCLFdBQVcsQ0FBQztBQUFFWCxJQUFBQSxDQUFDLEVBQUVBLENBQUMsR0FBR0UsS0FBVDtBQUFnQkQsSUFBQUEsQ0FBQyxFQUFFQSxDQUFDLEdBQUdFLE1BQXZCO0FBQStCRSxJQUFBQSxFQUFFLEVBQUZBLEVBQS9CO0FBQW1DSSxJQUFBQSxFQUFFLEVBQUZBLEVBQW5DO0FBQXVDWCxJQUFBQSxLQUFLLEVBQUxBO0FBQXZDLEdBQUQsQ0FBdEI7QUFFQSxNQUFNc0MsSUFBSSxHQUFHOUIsSUFBSSxDQUFDK0IsR0FBTCxDQUFTTCxFQUFFLENBQUNoQyxDQUFaLEVBQWVpQyxFQUFFLENBQUNqQyxDQUFsQixFQUFxQmtDLEVBQUUsQ0FBQ2xDLENBQXhCLEVBQTJCbUMsRUFBRSxDQUFDbkMsQ0FBOUIsQ0FBYjtBQUNBLE1BQU1zQyxJQUFJLEdBQUdoQyxJQUFJLENBQUNpQyxHQUFMLENBQVNQLEVBQUUsQ0FBQ2hDLENBQVosRUFBZWlDLEVBQUUsQ0FBQ2pDLENBQWxCLEVBQXFCa0MsRUFBRSxDQUFDbEMsQ0FBeEIsRUFBMkJtQyxFQUFFLENBQUNuQyxDQUE5QixDQUFiO0FBQ0EsTUFBTXdDLElBQUksR0FBR2xDLElBQUksQ0FBQytCLEdBQUwsQ0FBU0wsRUFBRSxDQUFDL0IsQ0FBWixFQUFlZ0MsRUFBRSxDQUFDaEMsQ0FBbEIsRUFBcUJpQyxFQUFFLENBQUNqQyxDQUF4QixFQUEyQmtDLEVBQUUsQ0FBQ2xDLENBQTlCLENBQWI7QUFDQSxNQUFNd0MsSUFBSSxHQUFHbkMsSUFBSSxDQUFDaUMsR0FBTCxDQUFTUCxFQUFFLENBQUMvQixDQUFaLEVBQWVnQyxFQUFFLENBQUNoQyxDQUFsQixFQUFxQmlDLEVBQUUsQ0FBQ2pDLENBQXhCLEVBQTJCa0MsRUFBRSxDQUFDbEMsQ0FBOUIsQ0FBYjtBQUVBLFNBQU87QUFDTEQsSUFBQUEsQ0FBQyxFQUFFb0MsSUFERTtBQUVMbkMsSUFBQUEsQ0FBQyxFQUFFdUMsSUFGRTtBQUdMdEMsSUFBQUEsS0FBSyxFQUFFb0MsSUFBSSxHQUFHRixJQUhUO0FBSUxqQyxJQUFBQSxNQUFNLEVBQUVzQyxJQUFJLEdBQUdEO0FBSlYsR0FBUDtBQU1ELENBdkJNOzs7O0FBeUJBLElBQU10QixXQUFXLEdBQUcsU0FBZEEsV0FBYyxDQUFDcEIsS0FBRCxFQUFtQjtBQUM1QyxNQUFNNEMsS0FBSyxHQUFHNUMsS0FBSyxHQUFHLEdBQVIsR0FBY1EsSUFBSSxDQUFDcUMsRUFBakM7QUFDQSxNQUFJQyxTQUFTLEdBQUdGLEtBQUssR0FBRyxHQUF4Qjs7QUFDQSxNQUFJRSxTQUFTLEdBQUcsQ0FBaEIsRUFBbUI7QUFDakJBLElBQUFBLFNBQVMsSUFBSSxHQUFiO0FBQ0Q7O0FBQ0QsTUFBTUMsQ0FBQyxHQUFHRCxTQUFTLEdBQUcsR0FBdEI7QUFDQSxNQUFJQyxDQUFDLElBQUksQ0FBTCxJQUFVQSxDQUFDLElBQUksSUFBbkIsRUFBeUIsT0FBTyxDQUFQO0FBQ3pCLE1BQUlBLENBQUMsR0FBRyxJQUFKLElBQVlBLENBQUMsSUFBSSxHQUFyQixFQUEwQixPQUFPLENBQVA7QUFDMUIsTUFBSUEsQ0FBQyxHQUFHLEdBQUosSUFBV0EsQ0FBQyxJQUFJLElBQXBCLEVBQTBCLE9BQU8sQ0FBUDtBQUMxQixNQUFJQSxDQUFDLEdBQUcsSUFBSixJQUFZQSxDQUFDLElBQUksQ0FBckIsRUFBd0IsT0FBTyxDQUFQO0FBQ3hCLFNBQU8sQ0FBQyxDQUFSO0FBQ0QsQ0FaTTs7OztBQWNBLElBQU1DLFFBQVEsR0FBRyxTQUFYQSxRQUFXLENBQUNDLEdBQUQ7QUFBQSxTQUF5QkEsR0FBRyxHQUFHekMsSUFBSSxDQUFDcUMsRUFBWCxHQUFnQixHQUF6QztBQUFBLENBQWpCOzs7O0FBQ0EsSUFBTUssUUFBUSxHQUFHLFNBQVhBLFFBQVcsQ0FBQ0MsR0FBRDtBQUFBLFNBQXlCQSxHQUFHLEdBQUcsR0FBTixHQUFZM0MsSUFBSSxDQUFDcUMsRUFBMUM7QUFBQSxDQUFqQjs7O0FBRVAsSUFBTTNCLEtBQUssR0FBRzhCLFFBQVEsQ0FBQyxVQUFELENBQXRCIiwic291cmNlc0NvbnRlbnQiOlsiXG5pbXBvcnQgeyBNZXRyaWNzIH0gZnJvbSAnLi4vVHlwZXMvTWV0cmljcyc7XG5cbmV4cG9ydCB0eXBlIEdldE9yaWdpbmFsUmVjdFBhcmFtZXRlcnMgPSB7XG4gIGJvdW5kaW5nQm94OiBNZXRyaWNzLCAvLyBCb3VuZGluZyBib3hcbiAgdGhldGE6IG51bWJlciwgLy8gT3JpZ2luYWwgcm90YXRpb24gaW4gcmFkaWFuc1xuICBza2lwV2lkdGg6ID9Cb29sZWFuIC8vIFNob3VsZCB3ZSBwZXJmb3JtIHRoZSBBbmRyb2lkIHZlcnNpb24gb2YgdGhlIHJvdGF0aW9uIHdoZXJlXG4gICAgICAgICAgICAgICAgICAgICAgLy8gV2lkdGgvSGVpZ2h0IGlzIHNhbWUgKG5vIGJvdW5kaW5nIGJveCwganVzdCB4L3kgaXMgc2V0Pylcbn1cbmV4cG9ydCBjb25zdCBnZXRPcmlnaW5hbFJlY3QgPSAocGFyYW1zOiBHZXRPcmlnaW5hbFJlY3RQYXJhbWV0ZXJzKTogTWV0cmljcyA9PiB7XG4gIGlmIChwYXJhbXMudGhldGEgPT09IDApIHtcbiAgICByZXR1cm4gcGFyYW1zLmJvdW5kaW5nQm94O1xuICB9XG5cbiAgY29uc3QgeyB4LCB5LCB3aWR0aCwgaGVpZ2h0IH0gPSBwYXJhbXMuYm91bmRpbmdCb3g7XG5cbiAgaWYgKHBhcmFtcy5za2lwV2lkdGgpIHtcbiAgICBjb25zdCBjeCA9IHggKyAoKE1hdGguY29zKHBhcmFtcy50aGV0YSkgKiB3aWR0aCAtIE1hdGguc2luKHBhcmFtcy50aGV0YSkgKiBoZWlnaHQpIC8gMik7XG4gICAgY29uc3QgY3kgPSB5ICsgKChNYXRoLnNpbihwYXJhbXMudGhldGEpICogd2lkdGggKyBNYXRoLmNvcyhwYXJhbXMudGhldGEpICogaGVpZ2h0KSAvIDIpO1xuICAgIGNvbnN0IHAwID0gcm90YXRlUG9pbnQoeyB4LCB5LCBjeCwgY3ksIHRoZXRhOiBwYXJhbXMudGhldGEgfSk7XG4gICAgcmV0dXJuIHsgeDogTWF0aC5yb3VuZChwMC54KSwgeTogTWF0aC5yb3VuZChwMC55KSwgd2lkdGgsIGhlaWdodCB9O1xuICB9XG5cbiAgbGV0IHRoZXRhID0gLTEgKiBwYXJhbXMudGhldGE7XG4gIGxldCBjb3MgPSBNYXRoLmNvcyh0aGV0YSk7XG4gIGxldCBzaW4gPSBNYXRoLnNpbih0aGV0YSk7XG5cbiAgaWYgKE1hdGguYWJzKE1hdGguYWJzKHNpbikgLSBNYXRoLmFicyhjb3MpKSA8PSBOdW1iZXIuRVBTSUxPTikge1xuICAgIHRoZXRhID0gc21hbGwgKyB0aGV0YTtcbiAgICBjb3MgPSBNYXRoLmNvcyh0aGV0YSk7XG4gICAgc2luID0gTWF0aC5zaW4odGhldGEpO1xuICB9XG5cbiAgLy8gR2V0IHJvdGF0ZWQgaGVpZ2h0L3dpZHRoXG4gIGNvbnN0IHF1YWQgPSBnZXRRdWFkcmFudCh0aGV0YSk7XG4gIGNvbnN0IGEgPSAxIC8gKE1hdGgucG93KGNvcywgMikgLSAoTWF0aC5wb3coc2luLCAyKSkpO1xuXG4gIGNvbnN0IGF3ID0gKDEgKiB3aWR0aCkgKiBjb3M7XG4gIGNvbnN0IGJ3ID0gKGhlaWdodCAqIHNpbik7XG4gIGNvbnN0IG53ID0gKHF1YWQgPT09IDAgfHwgcXVhZCA9PT0gMikgPyBhICogKGF3IC0gYncpIDogYSAqIChhdyArIGJ3KTtcblxuICBjb25zdCBhaCA9ICgtMSAqIHdpZHRoKSAqIHNpbjtcbiAgY29uc3QgYmggPSAoaGVpZ2h0ICogY29zKTtcbiAgY29uc3QgbmggPSAocXVhZCA9PT0gMCB8fCBxdWFkID09PSAyKSA/IGEgKiAoYWggKyBiaCkgOiBhICogKGFoIC0gYmgpO1xuXG4gIGNvbnN0IHJldFZhbCA9IHtcbiAgICB4OiBNYXRoLnJvdW5kKHggKyAod2lkdGggLSBNYXRoLmFicyhudykpICogMC41KSxcbiAgICB5OiBNYXRoLnJvdW5kKHkgKyAoaGVpZ2h0IC0gTWF0aC5hYnMobmgpKSAqIDAuNSksXG4gICAgd2lkdGg6IE1hdGguYWJzKE1hdGgucm91bmQobncpKSxcbiAgICBoZWlnaHQ6IE1hdGguYWJzKE1hdGgucm91bmQobmgpKSxcbiAgfTtcbiAgcmV0dXJuIHJldFZhbDtcbn07XG5cbmV4cG9ydCB0eXBlIFJvdGF0ZVBvaW50UGFyYW1ldGVycyA9IHtcbiAgeDogbnVtYmVyLFxuICB5OiBudW1iZXIsXG4gIGN4OiBudW1iZXIsXG4gIGN5OiBudW1iZXIsXG4gIHRoZXRhOiBudW1iZXIsXG59XG5leHBvcnQgY29uc3Qgcm90YXRlUG9pbnQgPSAocGFyYW1zOiBSb3RhdGVQb2ludFBhcmFtZXRlcnMpID0+IHtcbiAgY29uc3QgeyB4LCB5LCBjeCwgY3ksIHRoZXRhIH0gPSBwYXJhbXM7XG5cbiAgY29uc3QgY29zID0gTWF0aC5jb3ModGhldGEpO1xuICBjb25zdCBzaW4gPSBNYXRoLnNpbih0aGV0YSk7XG4gIGNvbnN0IG54ID0gKGNvcyAqICh4IC0gY3gpKSArIChzaW4gKiAoeSAtIGN5KSkgKyBjeDtcbiAgY29uc3QgbnkgPSAoY29zICogKHkgLSBjeSkpIC0gKHNpbiAqICh4IC0gY3gpKSArIGN5O1xuICByZXR1cm4geyB4OiBueCwgeTogbnkgfTtcbn07XG5cbmV4cG9ydCB0eXBlIEdldEJvdW5kaW5nQm94UGFyYW1ldGVycyA9IHtcbiAgcmVjdDogTWV0cmljcyxcbiAgdGhldGE6IG51bWJlcixcbn07XG5leHBvcnQgY29uc3QgZ2V0Qm91bmRpbmdCb3ggPSAocGFyYW1zOiBHZXRCb3VuZGluZ0JveFBhcmFtZXRlcnMpID0+IHtcbiAgY29uc3QgeyB4LCB5LCB3aWR0aCwgaGVpZ2h0IH0gPSBwYXJhbXMucmVjdDtcbiAgY29uc3QgeyB0aGV0YSB9ID0gcGFyYW1zO1xuXG4gIGNvbnN0IGN4ID0geCArICh3aWR0aCAvIDIpO1xuICBjb25zdCBjeSA9IHkgKyAoaGVpZ2h0IC8gMik7XG5cbiAgY29uc3QgdGwgPSByb3RhdGVQb2ludCh7IHgsIHksIGN4LCBjeSwgdGhldGEgfSk7XG4gIGNvbnN0IGJsID0gcm90YXRlUG9pbnQoeyB4LCB5OiB5ICsgaGVpZ2h0LCBjeCwgY3ksIHRoZXRhIH0pO1xuICBjb25zdCB0ciA9IHJvdGF0ZVBvaW50KHsgeDogeCArIHdpZHRoLCB5LCBjeCwgY3ksIHRoZXRhIH0pO1xuICBjb25zdCBiciA9IHJvdGF0ZVBvaW50KHsgeDogeCArIHdpZHRoLCB5OiB5ICsgaGVpZ2h0LCBjeCwgY3ksIHRoZXRhIH0pO1xuXG4gIGNvbnN0IG1pblggPSBNYXRoLm1pbih0bC54LCBibC54LCB0ci54LCBici54KTtcbiAgY29uc3QgbWF4WCA9IE1hdGgubWF4KHRsLngsIGJsLngsIHRyLngsIGJyLngpO1xuICBjb25zdCBtaW5ZID0gTWF0aC5taW4odGwueSwgYmwueSwgdHIueSwgYnIueSk7XG4gIGNvbnN0IG1heFkgPSBNYXRoLm1heCh0bC55LCBibC55LCB0ci55LCBici55KTtcblxuICByZXR1cm4ge1xuICAgIHg6IG1pblgsXG4gICAgeTogbWluWSxcbiAgICB3aWR0aDogbWF4WCAtIG1pblgsXG4gICAgaGVpZ2h0OiBtYXhZIC0gbWluWSxcbiAgfTtcbn07XG5cbmV4cG9ydCBjb25zdCBnZXRRdWFkcmFudCA9ICh0aGV0YTogbnVtYmVyKSA9PiB7XG4gIGNvbnN0IGFuZ2xlID0gdGhldGEgKiAxODAgLyBNYXRoLlBJO1xuICBsZXQgbm9ybWFuZ2xlID0gYW5nbGUgJSAzNjA7XG4gIGlmIChub3JtYW5nbGUgPCAwKSB7XG4gICAgbm9ybWFuZ2xlICs9IDM2MDtcbiAgfVxuICBjb25zdCBwID0gbm9ybWFuZ2xlIC8gMzYwO1xuICBpZiAocCA+PSAwICYmIHAgPD0gMC4yNSkgcmV0dXJuIDA7XG4gIGlmIChwID4gMC4yNSAmJiBwIDw9IDAuNSkgcmV0dXJuIDE7XG4gIGlmIChwID4gMC41ICYmIHAgPD0gMC43NSkgcmV0dXJuIDI7XG4gIGlmIChwID4gMC43NSAmJiBwIDw9IDEpIHJldHVybiAzO1xuICByZXR1cm4gLTE7XG59O1xuXG5leHBvcnQgY29uc3QgZGVnVG9SYWQgPSAoZGVnOiBudW1iZXIpOiBudW1iZXIgPT4gZGVnICogTWF0aC5QSSAvIDE4MDtcbmV4cG9ydCBjb25zdCByYWRUb0RlZyA9IChyYWQ6IG51bWJlcik6IG51bWJlciA9PiByYWQgKiAxODAgLyBNYXRoLlBJO1xuXG5jb25zdCBzbWFsbCA9IGRlZ1RvUmFkKDAuMDAwMDAwMDEpO1xuIl19