35af84208b28bbdfb41c05efc5ff2774
var _extends = Object.assign || function (target) {
  for (var i = 1; i < arguments.length; i++) {
    var source = arguments[i];

    for (var key in source) {
      if (Object.prototype.hasOwnProperty.call(source, key)) {
        target[key] = source[key];
      }
    }
  }

  return target;
};

var _templateObject = _taggedTemplateLiteral(['\n      SafeModule.create(...) was invoked without any options parameter.\n    '], ['\n      SafeModule.create(...) was invoked without any options parameter.\n    ']),
    _templateObject2 = _taggedTemplateLiteral(['\n             When attempting to resolve the native component ', ',\n             componentOverrides.', ' is expected to be a function, but found\n             ', ' instead.\n          '], ['\n             When attempting to resolve the native component ', ',\n             componentOverrides.', ' is expected to be a function, but found\n             ', ' instead.\n          ']),
    _templateObject3 = _taggedTemplateLiteral(['\n            When attempting to resolve the native component ', ',\n            componentOverrides.', ' is expected to be a function that returns a React\n            component. Instead, ', ' was found.\n          '], ['\n            When attempting to resolve the native component ', ',\n            componentOverrides.', ' is expected to be a function that returns a React\n            component. Instead, ', ' was found.\n          ']);

var _reactNative = require('react-native');

var _dedent = require('dedent');

var _dedent2 = _interopRequireDefault(_dedent);

var _SafeModule = require('./SafeModule');

var _SafeModule2 = _interopRequireDefault(_SafeModule);

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}

function _taggedTemplateLiteral(strings, raw) {
  return Object.freeze(Object.defineProperties(strings, {
    raw: {
      value: Object.freeze(raw)
    }
  }));
}

var first = function first(array, fn) {
  var result = void 0;
  var i = 0;

  for (; i < array.length; i++) {
    result = fn(array[i]);
    if (result) return result;
  }

  return null;
};

var moduleWithName = function moduleWithName(nameOrArray) {
  if (!nameOrArray) return null;
  if (Array.isArray(nameOrArray)) return first(nameOrArray, moduleWithName);
  return _reactNative.UIManager[nameOrArray];
};

var findFirstResolver = function findFirstResolver(namespace) {
  return function findFirstOnNamespace(nameOrArray) {
    if (!nameOrArray) return null;
    if (Array.isArray(nameOrArray)) return first(nameOrArray, findFirstOnNamespace);
    return nameOrArray in namespace ? nameOrArray : null;
  };
};

var findFirstViewName = findFirstResolver(_reactNative.UIManager);

var getPrimaryName = function getPrimaryName(nameOrArray) {
  return Array.isArray(nameOrArray) ? getPrimaryName(nameOrArray[0]) : nameOrArray;
};

var defaultGetVersion = function defaultGetVersion(module) {
  return module.VERSION;
};

function SafeComponentCreate(options) {
  if (!options) {
    throw new Error((0, _dedent2.default)(_templateObject));
  }

  var viewName = options.viewName;
  var propOverrides = options.propOverrides;
  var componentOverrides = options.componentOverrides;
  var mockComponent = options.mockComponent;
  var mock = options.mock;
  var getVersion = options.getVersion;

  if (!getVersion) {
    getVersion = defaultGetVersion;
  }

  if (!viewName) {
    throw new Error('\n      SafeModule.component(...) requires a viewName property to be specified.\n    ');
  }

  if (!mockComponent) {
    throw new Error('\n      SafeModule.component(...) requires a mockComponent property to be specified.\n    ');
  }

  var PRIMARY_VIEW_NAME = getPrimaryName(viewName);
  var realViewName = findFirstViewName(viewName);
  var realViewConfig = _reactNative.UIManager[realViewName];

  if (!realViewName || !realViewConfig) {
    return mockComponent;
  }

  var moduleOptions = _extends({}, options, {
    mock: mock || {},
    moduleName: realViewName + 'Manager'
  });

  var nativeModule = (0, _SafeModule2.default)(moduleOptions);
  var version = getVersion(realViewConfig.Constants || {});

  if (propOverrides) {
    var overrides = propOverrides[version];
    var boundOverrides = {};

    if (overrides) {
      if (typeof overrides === 'function') {
        boundOverrides = overrides(realViewConfig.NativeProps, realViewConfig, nativeModule);
      } else {
        boundOverrides = _extends({}, overrides);
      }
    }

    _extends(realViewConfig.NativeProps, boundOverrides);
  }

  var nativeComponent = (0, _reactNative.requireNativeComponent)(realViewName);
  var result = nativeComponent;

  result.runCommand = function (instance, name) {
    for (var _len = arguments.length, args = Array(_len > 2 ? _len - 2 : 0), _key = 2; _key < _len; _key++) {
      args[_key - 2] = arguments[_key];
    }

    return _reactNative.Platform.select({
      android: function android() {
        return _reactNative.UIManager.dispatchViewManagerCommand((0, _reactNative.findNodeHandle)(instance), _reactNative.UIManager[realViewName].Commands[name], args);
      },
      ios: function ios() {
        return nativeModule[name].apply(nativeModule, [(0, _reactNative.findNodeHandle)(instance)].concat(args));
      },
      default: function _default() {}
    })();
  };

  result.updateView = function (instance, props) {
    var native = function native() {
      return _reactNative.UIManager.updateView((0, _reactNative.findNodeHandle)(instance), realViewName, props);
    };

    _reactNative.Platform.select({
      ios: native,
      android: native,
      default: function _default() {}
    })();
  };

  if (componentOverrides) {
    var _overrides = componentOverrides[version];

    if (_overrides) {
      if (__DEV__) {
        if (typeof _overrides !== 'function') {
          console.error((0, _dedent2.default)(_templateObject2, PRIMARY_VIEW_NAME, version, typeof _overrides));
        }
      }

      result = _overrides(nativeComponent, nativeModule);

      if (__DEV__) {
        if (typeof result !== 'function') {
          console.error((0, _dedent2.default)(_templateObject3, PRIMARY_VIEW_NAME, version, typeof result));
        }
      }
    }
  }

  return result;
}

module.exports = SafeComponentCreate;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIk5hdGl2ZVNhZmVDb21wb25lbnQuanMiXSwibmFtZXMiOlsiX2V4dGVuZHMiLCJPYmplY3QiLCJhc3NpZ24iLCJ0YXJnZXQiLCJpIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwic291cmNlIiwia2V5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwiX3RlbXBsYXRlT2JqZWN0IiwiX3RhZ2dlZFRlbXBsYXRlTGl0ZXJhbCIsIl90ZW1wbGF0ZU9iamVjdDIiLCJfdGVtcGxhdGVPYmplY3QzIiwiX3JlYWN0TmF0aXZlIiwicmVxdWlyZSIsIl9kZWRlbnQiLCJfZGVkZW50MiIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJfU2FmZU1vZHVsZSIsIl9TYWZlTW9kdWxlMiIsIm9iaiIsIl9fZXNNb2R1bGUiLCJkZWZhdWx0Iiwic3RyaW5ncyIsInJhdyIsImZyZWV6ZSIsImRlZmluZVByb3BlcnRpZXMiLCJ2YWx1ZSIsImZpcnN0IiwiYXJyYXkiLCJmbiIsInJlc3VsdCIsIm1vZHVsZVdpdGhOYW1lIiwibmFtZU9yQXJyYXkiLCJBcnJheSIsImlzQXJyYXkiLCJVSU1hbmFnZXIiLCJmaW5kRmlyc3RSZXNvbHZlciIsIm5hbWVzcGFjZSIsImZpbmRGaXJzdE9uTmFtZXNwYWNlIiwiZmluZEZpcnN0Vmlld05hbWUiLCJnZXRQcmltYXJ5TmFtZSIsImRlZmF1bHRHZXRWZXJzaW9uIiwibW9kdWxlIiwiVkVSU0lPTiIsIlNhZmVDb21wb25lbnRDcmVhdGUiLCJvcHRpb25zIiwiRXJyb3IiLCJ2aWV3TmFtZSIsInByb3BPdmVycmlkZXMiLCJjb21wb25lbnRPdmVycmlkZXMiLCJtb2NrQ29tcG9uZW50IiwibW9jayIsImdldFZlcnNpb24iLCJQUklNQVJZX1ZJRVdfTkFNRSIsInJlYWxWaWV3TmFtZSIsInJlYWxWaWV3Q29uZmlnIiwibW9kdWxlT3B0aW9ucyIsIm1vZHVsZU5hbWUiLCJuYXRpdmVNb2R1bGUiLCJ2ZXJzaW9uIiwiQ29uc3RhbnRzIiwib3ZlcnJpZGVzIiwiYm91bmRPdmVycmlkZXMiLCJOYXRpdmVQcm9wcyIsIm5hdGl2ZUNvbXBvbmVudCIsInJlcXVpcmVOYXRpdmVDb21wb25lbnQiLCJydW5Db21tYW5kIiwiaW5zdGFuY2UiLCJuYW1lIiwiX2xlbiIsImFyZ3MiLCJfa2V5IiwiUGxhdGZvcm0iLCJzZWxlY3QiLCJhbmRyb2lkIiwiZGlzcGF0Y2hWaWV3TWFuYWdlckNvbW1hbmQiLCJmaW5kTm9kZUhhbmRsZSIsIkNvbW1hbmRzIiwiaW9zIiwiYXBwbHkiLCJjb25jYXQiLCJfZGVmYXVsdCIsInVwZGF0ZVZpZXciLCJwcm9wcyIsIm5hdGl2ZSIsIl9vdmVycmlkZXMiLCJfX0RFVl9fIiwiY29uc29sZSIsImVycm9yIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBQUEsSUFBSUEsUUFBUSxHQUFDQyxNQUFNLENBQUNDLE1BQVAsSUFBZSxVQUFTQyxNQUFULEVBQWdCO0FBQUMsT0FBSSxJQUFJQyxDQUFDLEdBQUMsQ0FBVixFQUFZQSxDQUFDLEdBQUNDLFNBQVMsQ0FBQ0MsTUFBeEIsRUFBK0JGLENBQUMsRUFBaEMsRUFBbUM7QUFBQyxRQUFJRyxNQUFNLEdBQUNGLFNBQVMsQ0FBQ0QsQ0FBRCxDQUFwQjs7QUFBd0IsU0FBSSxJQUFJSSxHQUFSLElBQWVELE1BQWYsRUFBc0I7QUFBQyxVQUFHTixNQUFNLENBQUNRLFNBQVAsQ0FBaUJDLGNBQWpCLENBQWdDQyxJQUFoQyxDQUFxQ0osTUFBckMsRUFBNENDLEdBQTVDLENBQUgsRUFBb0Q7QUFBQ0wsUUFBQUEsTUFBTSxDQUFDSyxHQUFELENBQU4sR0FBWUQsTUFBTSxDQUFDQyxHQUFELENBQWxCO0FBQXlCO0FBQUM7QUFBQzs7QUFBQSxTQUFPTCxNQUFQO0FBQWUsQ0FBL047O0FBQWdPLElBQUlTLGVBQWUsR0FBQ0Msc0JBQXNCLENBQUMsQ0FBQyxpRkFBRCxDQUFELEVBQXFGLENBQUMsaUZBQUQsQ0FBckYsQ0FBMUM7QUFBQSxJQUFvTkMsZ0JBQWdCLEdBQUNELHNCQUFzQixDQUFDLENB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LE9BQU8sQ0FBQ0MsS0FBUixDQUFjLENBQUMsR0FBRXpFLFFBQVEsQ0FBQ00sT0FBWixFQUFxQlYsZ0JBQXJCLEVBQ2QwQyxpQkFEYyxFQUVkTSxPQUZjLEVBR2QsT0FBTzdCLE1BSE8sQ0FBZDtBQUtDO0FBQ0E7QUFDQTtBQUNBOztBQUVELFNBQU9BLE1BQVA7QUFDQzs7QUFFRFksTUFBTSxDQUFDK0MsT0FBUCxHQUFlN0MsbUJBQWYiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgX2V4dGVuZHM9T2JqZWN0LmFzc2lnbnx8ZnVuY3Rpb24odGFyZ2V0KXtmb3IodmFyIGk9MTtpPGFyZ3VtZW50cy5sZW5ndGg7aSsrKXt2YXIgc291cmNlPWFyZ3VtZW50c1tpXTtmb3IodmFyIGtleSBpbiBzb3VyY2Upe2lmKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzb3VyY2Usa2V5KSl7dGFyZ2V0W2tleV09c291cmNlW2tleV07fX19cmV0dXJuIHRhcmdldDt9O3ZhciBfdGVtcGxhdGVPYmplY3Q9X3RhZ2dlZFRlbXBsYXRlTGl0ZXJhbChbJ1xcbiAgICAgIFNhZmVNb2R1bGUuY3JlYXRlKC4uLikgd2FzIGludm9rZWQgd2l0aG91dCBhbnkgb3B0aW9ucyBwYXJhbWV0ZXIuXFxuICAgICddLFsnXFxuICAgICAgU2FmZU1vZHVsZS5jcmVhdGUoLi4uKSB3YXMgaW52b2tlZCB3aXRob3V0IGFueSBvcHRpb25zIHBhcmFtZXRlci5cXG4gICAgJ10pLF90ZW1wbGF0ZU9iamVjdDI9X3RhZ2dlZFRlbXBsYXRlTGl0ZXJhbChbJ1xcbiAgICAgICAgICAgICBXaGVuIGF0dGVtcHRpbmcgdG8gcmVzb2x2ZSB0aGUgbmF0aXZlIGNvbXBvbmVudCAnLCcsXFxuICAgICAgICAgICAgIGNvbXBvbmVudE92ZXJyaWRlcy4nLCcgaXMgZXhwZWN0ZWQgdG8gYmUgYSBmdW5jdGlvbiwgYnV0IGZvdW5kXFxuICAgICAgICAgICAgICcsJyBpbnN0ZWFkLlxcbiAgICAgICAgICAnXSxbJ1xcbiAgICAgICAgICAgICBXaGVuIGF0dGVtcHRpbmcgdG8gcmVzb2x2ZSB0aGUgbmF0aXZlIGNvbXBvbmVudCAnLCcsXFxuICAgICAgICAgICAgIGNvbXBvbmVudE92ZXJyaWRlcy4nLCcgaXMgZXhwZWN0ZWQgdG8gYmUgYSBmdW5jdGlvbiwgYnV0IGZvdW5kXFxuICAgICAgICAgICAgICcsJyBpbnN0ZWFkLlxcbiAgICAgICAgICAnXSksX3RlbXBsYXRlT2JqZWN0Mz1fdGFnZ2VkVGVtcGxhdGVMaXRlcmFsKFsnXFxuICAgICAgICAgICAgV2hlbiBhdHRlbXB0aW5nIHRvIHJlc29sdmUgdGhlIG5hdGl2ZSBjb21wb25lbnQgJywnLFxcbiAgICAgICAgICAgIGNvbXBvbmVudE92ZXJyaWRlcy4nLCcgaXMgZXhwZWN0ZWQgdG8gYmUgYSBmdW5jdGlvbiB0aGF0IHJldHVybnMgYSBSZWFjdFxcbiAgICAgICAgICAgIGNvbXBvbmVudC4gSW5zdGVhZCwgJywnIHdhcyBmb3VuZC5cXG4gICAgICAgICAgJ10sWydcXG4gICAgICAgICAgICBXaGVuIGF0dGVtcHRpbmcgdG8gcmVzb2x2ZSB0aGUgbmF0aXZlIGNvbXBvbmVudCAnLCcsXFxuICAgICAgICAgICAgY29tcG9uZW50T3ZlcnJpZGVzLicsJyBpcyBleHBlY3RlZCB0byBiZSBhIGZ1bmN0aW9uIHRoYXQgcmV0dXJucyBhIFJlYWN0XFxuICAgICAgICAgICAgY29tcG9uZW50LiBJbnN0ZWFkLCAnLCcgd2FzIGZvdW5kLlxcbiAgICAgICAgICAnXSk7dmFyIF9yZWFjdE5hdGl2ZT1yZXF1aXJlKCdyZWFjdC1uYXRpdmUnKTtcblxuXG5cblxuXG52YXIgX2RlZGVudD1yZXF1aXJlKCdkZWRlbnQnKTt2YXIgX2RlZGVudDI9X2ludGVyb3BSZXF1aXJlRGVmYXVsdChfZGVkZW50KTtcbnZhciBfU2FmZU1vZHVsZT1yZXF1aXJlKCcuL1NhZmVNb2R1bGUnKTt2YXIgX1NhZmVNb2R1bGUyPV9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX1NhZmVNb2R1bGUpO2Z1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKXtyZXR1cm4gb2JqJiZvYmouX19lc01vZHVsZT9vYmo6e2RlZmF1bHQ6b2JqfTt9ZnVuY3Rpb24gX3RhZ2dlZFRlbXBsYXRlTGl0ZXJhbChzdHJpbmdzLHJhdyl7cmV0dXJuIE9iamVjdC5mcmVlemUoT2JqZWN0LmRlZmluZVByb3BlcnRpZXMoc3RyaW5ncyx7cmF3Ont2YWx1ZTpPYmplY3QuZnJlZXplKHJhdyl9fSkpO31cblxudmFyIGZpcnN0PWZ1bmN0aW9uIGZpcnN0KGFycmF5LGZuKXtcbnZhciByZXN1bHQ9dm9pZCAwO1xudmFyIGk9MDtcbi8qIGVzbGludCBuby1wbHVzcGx1czogMCAqL1xuZm9yKDtpPGFycmF5Lmxlbmd0aDtpKyspe1xucmVzdWx0PWZuKGFycmF5W2ldKTtcbmlmKHJlc3VsdClyZXR1cm4gcmVzdWx0O1xufVxucmV0dXJuIG51bGw7XG59O1xuXG52YXIgbW9kdWxlV2l0aE5hbWU9ZnVuY3Rpb24gbW9kdWxlV2l0aE5hbWUobmFtZU9yQXJyYXkpe1xuaWYoIW5hbWVPckFycmF5KXJldHVybiBudWxsO1xuaWYoQXJyYXkuaXNBcnJheShuYW1lT3JBcnJheSkpcmV0dXJuIGZpcnN0KG5hbWVPckFycmF5LG1vZHVsZVdpdGhOYW1lKTtcbnJldHVybiBfcmVhY3ROYXRpdmUuVUlNYW5hZ2VyW25hbWVPckFycmF5XTtcbn07XG5cbnZhciBmaW5kRmlyc3RSZXNvbHZlcj1mdW5jdGlvbiBmaW5kRmlyc3RSZXNvbHZlcihuYW1lc3BhY2Upe3JldHVybiBmdW5jdGlvbiBmaW5kRmlyc3RPbk5hbWVzcGFjZShuYW1lT3JBcnJheSl7XG5pZighbmFtZU9yQXJyYXkpcmV0dXJuIG51bGw7XG5pZihBcnJheS5pc0FycmF5KG5hbWVPckFycmF5KSlyZXR1cm4gZmlyc3QobmFtZU9yQXJyYXksZmluZEZpcnN0T25OYW1lc3BhY2UpO1xucmV0dXJuIG5hbWVPckFycmF5IGluIG5hbWVzcGFjZT9uYW1lT3JBcnJheTpudWxsO1xufTt9O1xuXG52YXIgZmluZEZpcnN0Vmlld05hbWU9ZmluZEZpcnN0UmVzb2x2ZXIoX3JlYWN0TmF0aXZlLlVJTWFuYWdlcik7XG5cbnZhciBnZXRQcmltYXJ5TmFtZT1mdW5jdGlvbiBnZXRQcmltYXJ5TmFtZShuYW1lT3JBcnJheSl7XG5yZXR1cm4gQXJyYXkuaXNBcnJheShuYW1lT3JBcnJheSk/Z2V0UHJpbWFyeU5hbWUobmFtZU9yQXJyYXlbMF0pOm5hbWVPckFycmF5O1xufTtcblxudmFyIGRlZmF1bHRHZXRWZXJzaW9uPWZ1bmN0aW9uIGRlZmF1bHRHZXRWZXJzaW9uKG1vZHVsZSl7cmV0dXJuIG1vZHVsZS5WRVJTSU9OO307XG5cbmZ1bmN0aW9uIFNhZmVDb21wb25lbnRDcmVhdGUob3B0aW9ucyl7XG5pZighb3B0aW9ucyl7XG50aHJvdyBuZXcgRXJyb3IoKDAsX2RlZGVudDIuZGVmYXVsdCkoX3RlbXBsYXRlT2JqZWN0KSk7XG5cblxufXZhclxuXG52aWV3TmFtZT1cblxuXG5cblxub3B0aW9ucy52aWV3TmFtZTt2YXIgcHJvcE92ZXJyaWRlcz1vcHRpb25zLnByb3BPdmVycmlkZXM7dmFyIGNvbXBvbmVudE92ZXJyaWRlcz1vcHRpb25zLmNvbXBvbmVudE92ZXJyaWRlczt2YXIgbW9ja0NvbXBvbmVudD1vcHRpb25zLm1vY2tDb21wb25lbnQ7dmFyIG1vY2s9b3B0aW9ucy5tb2NrO3ZhclxuXG5nZXRWZXJzaW9uPVxub3B0aW9ucy5nZXRWZXJzaW9uO1xuXG5pZighZ2V0VmVyc2lvbil7XG5nZXRWZXJzaW9uPWRlZmF1bHRHZXRWZXJzaW9uO1xufVxuXG5pZighdmlld05hbWUpe1xudGhyb3cgbmV3IEVycm9yKCdcXG4gICAgICBTYWZlTW9kdWxlLmNvbXBvbmVudCguLi4pIHJlcXVpcmVzIGEgdmlld05hbWUgcHJvcGVydHkgdG8gYmUgc3BlY2lmaWVkLlxcbiAgICAnKTtcblxuXG59XG5cbmlmKCFtb2NrQ29tcG9uZW50KXtcbnRocm93IG5ldyBFcnJvcignXFxuICAgICAgU2FmZU1vZHVsZS5jb21wb25lbnQoLi4uKSByZXF1aXJlcyBhIG1vY2tDb21wb25lbnQgcHJvcGVydHkgdG8gYmUgc3BlY2lmaWVkLlxcbiAgICAnKTtcblxuXG59XG5cbnZhciBQUklNQVJZX1ZJRVdfTkFNRT1nZXRQcmltYXJ5TmFtZSh2aWV3TmFtZSk7XG5cbnZhciByZWFsVmlld05hbWU9ZmluZEZpcnN0Vmlld05hbWUodmlld05hbWUpO1xudmFyIHJlYWxWaWV3Q29uZmlnPV9yZWFjdE5hdGl2ZS5VSU1hbmFnZXJbcmVhbFZpZXdOYW1lXTtcblxuaWYoIXJlYWxWaWV3TmFtZXx8IXJlYWxWaWV3Q29uZmlnKXtcbnJldHVybiBtb2NrQ29tcG9uZW50O1xufVxuXG52YXIgbW9kdWxlT3B0aW9ucz1fZXh0ZW5kcyh7fSxvcHRpb25zLHtcbm1vY2s6bW9ja3x8e30sXG5tb2R1bGVOYW1lOnJlYWxWaWV3TmFtZSsnTWFuYWdlcid9KTtcblxuXG52YXIgbmF0aXZlTW9kdWxlPSgwLF9TYWZlTW9kdWxlMi5kZWZhdWx0KShtb2R1bGVPcHRpb25zKTtcblxudmFyIHZlcnNpb249Z2V0VmVyc2lvbihyZWFsVmlld0NvbmZpZy5Db25zdGFudHN8fHt9KTtcblxuaWYocHJvcE92ZXJyaWRlcyl7XG52YXIgb3ZlcnJpZGVzPXByb3BPdmVycmlkZXNbdmVyc2lvbl07XG52YXIgYm91bmRPdmVycmlkZXM9e307XG5pZihvdmVycmlkZXMpe1xuaWYodHlwZW9mIG92ZXJyaWRlcz09PSdmdW5jdGlvbicpe1xuYm91bmRPdmVycmlkZXM9b3ZlcnJpZGVzKHJlYWxWaWV3Q29uZmlnLk5hdGl2ZVByb3BzLHJlYWxWaWV3Q29uZmlnLG5hdGl2ZU1vZHVsZSk7XG59ZWxzZXtcbmJvdW5kT3ZlcnJpZGVzPV9leHRlbmRzKHt9LG92ZXJyaWRlcyk7XG59XG59XG5fZXh0ZW5kcyhyZWFsVmlld0NvbmZpZy5OYXRpdmVQcm9wcyxib3VuZE92ZXJyaWRlcyk7XG59XG5cbnZhciBuYXRpdmVDb21wb25lbnQ9KDAsX3JlYWN0TmF0aXZlLnJlcXVpcmVOYXRpdmVDb21wb25lbnQpKHJlYWxWaWV3TmFtZSk7XG5cbnZhciByZXN1bHQ9bmF0aXZlQ29tcG9uZW50O1xuXG5yZXN1bHQucnVuQ29tbWFuZD1mdW5jdGlvbihpbnN0YW5jZSxuYW1lKXtmb3IodmFyIF9sZW49YXJndW1lbnRzLmxlbmd0aCxhcmdzPUFycmF5KF9sZW4+Mj9fbGVuLTI6MCksX2tleT0yO19rZXk8X2xlbjtfa2V5Kyspe2FyZ3NbX2tleS0yXT1hcmd1bWVudHNbX2tleV07fVxucmV0dXJuIF9yZWFjdE5hdGl2ZS5QbGF0Zm9ybS5zZWxlY3Qoe1xuYW5kcm9pZDpmdW5jdGlvbiBhbmRyb2lkKCl7cmV0dXJuIF9yZWFjdE5hdGl2ZS5VSU1hbmFnZXIuZGlzcGF0Y2hWaWV3TWFuYWdlckNvbW1hbmQoXG4oMCxfcmVhY3ROYXRpdmUuZmluZE5vZGVIYW5kbGUpKGluc3RhbmNlKSxcbl9yZWFjdE5hdGl2ZS5VSU1hbmFnZXJbcmVhbFZpZXdOYW1lXS5Db21tYW5kc1tuYW1lXSxcbmFyZ3MpO30sXG5cbmlvczpmdW5jdGlvbiBpb3MoKXtyZXR1cm4gbmF0aXZlTW9kdWxlW25hbWVdLmFwcGx5KG5hdGl2ZU1vZHVsZSxbKDAsX3JlYWN0TmF0aXZlLmZpbmROb2RlSGFuZGxlKShpbnN0YW5jZSldLmNvbmNhdChhcmdzKSk7fSxcbmRlZmF1bHQ6ZnVuY3Rpb24gX2RlZmF1bHQoKXt9fSkoKTtcblxufTtcblxucmVzdWx0LnVwZGF0ZVZpZXc9ZnVuY3Rpb24oaW5zdGFuY2UscHJvcHMpe1xudmFyIG5hdGl2ZT1mdW5jdGlvbiBuYXRpdmUoKXtyZXR1cm4gX3JlYWN0TmF0aXZlLlVJTWFuYWdlci51cGRhdGVWaWV3KCgwLF9yZWFjdE5hdGl2ZS5maW5kTm9kZUhhbmRsZSkoaW5zdGFuY2UpLHJlYWxWaWV3TmFtZSxwcm9wcyk7fTtcbl9yZWFjdE5hdGl2ZS5QbGF0Zm9ybS5zZWxlY3Qoe1xuaW9zOm5hdGl2ZSxcbmFuZHJvaWQ6bmF0aXZlLFxuZGVmYXVsdDpmdW5jdGlvbiBfZGVmYXVsdCgpe319KSgpO1xuXG59O1xuXG5pZihjb21wb25lbnRPdmVycmlkZXMpe1xudmFyIF9vdmVycmlkZXM9Y29tcG9uZW50T3ZlcnJpZGVzW3ZlcnNpb25dO1xuaWYoX292ZXJyaWRlcyl7XG5pZihfX0RFVl9fKXtcbmlmKHR5cGVvZiBfb3ZlcnJpZGVzIT09J2Z1bmN0aW9uJyl7XG5jb25zb2xlLmVycm9yKCgwLF9kZWRlbnQyLmRlZmF1bHQpKF90ZW1wbGF0ZU9iamVjdDIsXG5QUklNQVJZX1ZJRVdfTkFNRSxcbnZlcnNpb24sXG50eXBlb2YgX292ZXJyaWRlcykpO1xuXG59XG59XG5cbnJlc3VsdD1fb3ZlcnJpZGVzKG5hdGl2ZUNvbXBvbmVudCxuYXRpdmVNb2R1bGUpO1xuXG5pZihfX0RFVl9fKXtcbmlmKHR5cGVvZiByZXN1bHQhPT0nZnVuY3Rpb24nKXtcbmNvbnNvbGUuZXJyb3IoKDAsX2RlZGVudDIuZGVmYXVsdCkoX3RlbXBsYXRlT2JqZWN0MyxcblBSSU1BUllfVklFV19OQU1FLFxudmVyc2lvbixcbnR5cGVvZiByZXN1bHQpKTtcblxufVxufVxufVxufVxuXG5yZXR1cm4gcmVzdWx0O1xufVxuXG5tb2R1bGUuZXhwb3J0cz1TYWZlQ29tcG9uZW50Q3JlYXRlOyJdfQ==