{"version":3,"sources":["NativeSafeModule.js"],"names":["_extends","Object","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","_templateObject","_taggedTemplateLiteral","_templateObject2","_templateObject3","_templateObject4","_reactNative","require","_dedent","_dedent2","_interopRequireDefault","obj","__esModule","default","strings","raw","freeze","defineProperties","value","UNMOCKED_PROPERTY_WHITELIST","VERSION","addListener","removeListeners","eventEmitterMock","first","array","fn","result","moduleWithName","nameOrArray","Array","isArray","NativeModules","getPrimaryName","getModule","moduleNameOrNames","mock","isEventEmitter","module","defaultGetVersion","create","SafeModuleCreate","options","Error","moduleName","versionOverrides","getVersion","MODULE_NAME","version","__DEV__","keys","forEach","console","warn","emitter","NativeEventEmitter","overrides","boundOverrides","exports"],"mappings":"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","sourcesContent":["var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};var _templateObject=_taggedTemplateLiteral(['\\n      SafeModule.module(...) was invoked without any options parameter.\\n    '],['\\n      SafeModule.module(...) was invoked without any options parameter.\\n    ']),_templateObject2=_taggedTemplateLiteral(['\\n      SafeModule.module(...) requires a moduleName property to be specified.\\n    '],['\\n      SafeModule.module(...) requires a moduleName property to be specified.\\n    ']),_templateObject3=_taggedTemplateLiteral(['\\n      Missing a \"mock\" parameter.\\n    '],['\\n      Missing a \"mock\" parameter.\\n    ']),_templateObject4=_taggedTemplateLiteral(['\\n          ReactNative.NativeModules.','.',' did not have a corresponding prop defined\\n          in the mock provided to SafeModule.\\n        '],['\\n          ReactNative.NativeModules.','.',' did not have a corresponding prop defined\\n          in the mock provided to SafeModule.\\n        ']);var _reactNative=require('react-native');\nvar _dedent=require('dedent');var _dedent2=_interopRequireDefault(_dedent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _taggedTemplateLiteral(strings,raw){return Object.freeze(Object.defineProperties(strings,{raw:{value:Object.freeze(raw)}}));}\n\n// const AccountModule = SafeModule.create({\n//   moduleName: ['SomeNativeModule', 'SomeOldNameOfThatModule'],\n//   isEventEmitter: true,\n//   getVersion: module => module.VERSION,\n//   onInit: (module, version) => {},\n//   onNoModuleFound: () => {},\n//   onVersionFound: (version) => {},\n//   onOverrideUsed: (version, overrideName) => {},\n//   onOverrideCalled: (version, overrideName) => {},\n//   mock: {\n//     push: () => Promise.resolve(),\n//     pushNative: () => Promise.resolve(),\n//     setTitle: noop,\n//   },\n//   overrides: {\n//     7: {\n//       push: old => (id, props, options) => {\n//         return old(id, props, !!options.animated);\n//       },\n//     },\n//   },\n// });\n\nvar hasOwnProperty=Object.prototype.hasOwnProperty;\n\nvar UNMOCKED_PROPERTY_WHITELIST={\nVERSION:true,\naddListener:true,\nremoveListeners:true};\n\n\nvar eventEmitterMock={\naddListener:function addListener(){},\nremoveListeners:function removeListeners(){}};\n\n\nvar first=function first(array,fn){\nvar result=void 0;\nvar i=0;\n/* eslint no-plusplus: 0 */\nfor(;i<array.length;i++){\nresult=fn(array[i]);\nif(result)return result;\n}\nreturn null;\n};\n\nvar moduleWithName=function moduleWithName(nameOrArray){\nif(!nameOrArray)return null;\nif(Array.isArray(nameOrArray))return first(nameOrArray,moduleWithName);\nreturn _reactNative.NativeModules[nameOrArray];\n};\n\nvar getPrimaryName=function getPrimaryName(nameOrArray){\nreturn Array.isArray(nameOrArray)?getPrimaryName(nameOrArray[0]):nameOrArray;\n};\n\nvar getModule=function getModule(moduleNameOrNames,mock,isEventEmitter){\nvar module=moduleWithName(moduleNameOrNames);\n// TODO: in __DEV__, we should console.warn if anything but the first module got used.\nif(module)return module;\n// For Platform.OS === 'ios', we must ensure that `module` contains event\n// emitter methods expected by `NativeEventEmitter`, even in the case of a\n// mock. Otherwise, calling the emitter will throw an error.\nif(isEventEmitter)return _extends({},mock,eventEmitterMock);\nreturn mock;\n};\n\nvar defaultGetVersion=function defaultGetVersion(module){return module.VERSION;};\n\n\nvar create=function SafeModuleCreate(options){\nif(!options){\nthrow new Error((0,_dedent2.default)(_templateObject));\n\n\n}var\n\nmoduleName=\n\n\n\noptions.moduleName;var mock=options.mock;var isEventEmitter=options.isEventEmitter;var versionOverrides=options.versionOverrides;var\n\ngetVersion=\noptions.getVersion;\n\nif(!getVersion){\ngetVersion=defaultGetVersion;\n}\n\nif(!moduleName){\nthrow new Error((0,_dedent2.default)(_templateObject2));\n\n\n}\nvar MODULE_NAME=getPrimaryName(moduleName);\n\nif(!mock){\nthrow new Error((0,_dedent2.default)(_templateObject3));\n\n\n}\n\nvar result={};\n\nvar module=getModule(moduleName,mock,isEventEmitter);\nvar version=getVersion(module);\n\nif(__DEV__){\nObject.keys(module).forEach(function(key){\nif(!hasOwnProperty.call(mock,key)&&!UNMOCKED_PROPERTY_WHITELIST[key]){\nconsole.warn((0,_dedent2.default)(_templateObject4,\nMODULE_NAME,key));\n\n\n}\n});\n}\n\nif(isEventEmitter){\n// TODO(lmr): should this be put inside of a try/catch?\nresult.emitter=new _reactNative.NativeEventEmitter(module);\n}\n\nvar overrides=void 0;\nvar boundOverrides=void 0;\nif(versionOverrides){\noverrides=versionOverrides[version];\nboundOverrides={};\nif(overrides){\nObject.keys(overrides).forEach(function(key){\nif(typeof overrides[key]==='function'){\nboundOverrides[key]=overrides[key](module[key],module);\n}else{\nboundOverrides[key]=overrides[key];\n}\n});\n}\n}\n\n_extends(\nresult,\nmock,\nmodule,\nboundOverrides);\n\n\nreturn result;\n};\n\nmodule.exports=create;"]}