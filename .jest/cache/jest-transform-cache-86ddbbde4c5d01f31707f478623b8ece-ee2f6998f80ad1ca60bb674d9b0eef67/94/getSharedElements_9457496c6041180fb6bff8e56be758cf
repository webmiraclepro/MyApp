76b210ad64083fb9979efe6e0b4f9092
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getSharedElements = void 0;

var _objectSpread2 = _interopRequireDefault(require("@babel/runtime/helpers/objectSpread"));

var _react = _interopRequireDefault(require("react"));

var _reactNative = require("react-native");

var _TransitionItem = _interopRequireDefault(require("../TransitionItem"));

var _Utils = require("../Utils");

var _InterpolatorTypes = require("./InterpolatorTypes");

var _InterpolatorSpecification = require("../Types/InterpolatorSpecification");

var getSharedElements = function getSharedElements(sharedElements, getInterpolationFunction) {
  return sharedElements.map(function (pair, idx) {
    var fromItem = pair.fromItem,
        toItem = pair.toItem;

    var element = _react.default.Children.only(fromItem.reactElement.props.children);

    var equalAspectRatio = getIsEqualAspectRatio(fromItem, toItem);
    var transitionStyles = getTransitionStyle(fromItem, toItem, getInterpolationFunction, equalAspectRatio);
    var key = "so-" + idx.toString();
    var animationStyle = transitionStyles.styles;
    var nativeAnimationStyle = [transitionStyles.nativeStyles];
    var resolvedMetrics = (0, _Utils.getResolvedMetrics)(fromItem, fromItem.metrics);
    var overrideStyles = {
      position: 'absolute',
      left: resolvedMetrics.x,
      top: resolvedMetrics.y,
      width: resolvedMetrics.width,
      height: resolvedMetrics.height
    };
    var props = (0, _objectSpread2.default)({}, element.props, {
      __index: fromItem.index
    });

    if (fromItem.animated) {
      props[fromItem.animated] = getInterpolationFunction(false);
    } else if (toItem.animated) {
      props[toItem.animated] = getInterpolationFunction(false);
    }

    var component = _react.default.createElement(element.type, (0, _objectSpread2.default)({}, props, {
      key: key
    }));

    return (0, _Utils.createAnimatedWrapper)({
      component: component,
      nativeStyles: nativeAnimationStyle,
      styles: animationStyle,
      overrideStyles: overrideStyles,
      equalAspectRatio: equalAspectRatio,
      log: true,
      logPrefix: "SE: " + fromItem.name + "/" + fromItem.route
    });
  });
};

exports.getSharedElements = getSharedElements;

var getIsEqualAspectRatio = function getIsEqualAspectRatio(fromItem, toItem) {
  var fromAspect = Math.round(fromItem.metrics.width / fromItem.metrics.height * 100) / 100;
  var toAspect = Math.round(toItem.metrics.width / toItem.metrics.height * 100) / 100;
  return fromAspect === toAspect;
};

var getTransitionStyle = function getTransitionStyle(fromItem, toItem, getInterpolationFunction, equalAspectRatio) {
  var interpolatorInfo = {
    from: {
      metrics: fromItem.metrics,
      boundingbox: fromItem.boundingBoxMetrics,
      style: fromItem.getFlattenedStyle()
    },
    to: {
      metrics: toItem.metrics,
      style: toItem.getFlattenedStyle(),
      boundingbox: toItem.boundingBoxMetrics
    },
    scaleX: toItem.scaleRelativeTo(fromItem).x,
    scaleY: toItem.scaleRelativeTo(fromItem).y,
    equalAspectRatio: equalAspectRatio,
    getInterpolation: getInterpolationFunction,
    dimensions: _reactNative.Dimensions.get('window')
  };
  var nativeStyles = [];
  var styles = [];
  (0, _InterpolatorTypes.getInterpolatorTypes)().forEach(function (interpolator) {
    var interpolatorResult = interpolator.interpolatorFunction(interpolatorInfo);

    if (interpolatorResult) {
      if (interpolatorResult.nativeAnimationStyles) {
        nativeStyles.push(interpolatorResult.nativeAnimationStyles);
      }

      if (interpolatorResult.animationStyles) {
        styles.push(interpolatorResult.animationStyles);
      }
    }
  });
  return {
    nativeStyles: (0, _objectSpread2.default)({}, (0, _Utils.mergeStyles)(nativeStyles)),
    styles: (0, _objectSpread2.default)({
      width: fromItem.metrics.width,
      height: fromItem.metrics.height
    }, (0, _Utils.mergeStyles)(styles))
  };
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImdldFNoYXJlZEVsZW1lbnRzLmpzIl0sIm5hbWVzIjpbImdldFNoYXJlZEVsZW1lbnRzIiwic2hhcmVkRWxlbWVudHMiLCJnZXRJbnRlcnBvbGF0aW9uRnVuY3Rpb24iLCJtYXAiLCJwYWlyIiwiaWR4IiwiZnJvbUl0ZW0iLCJ0b0l0ZW0iLCJlbGVtZW50IiwiUmVhY3QiLCJDaGlsZHJlbiIsIm9ubHkiLCJyZWFjdEVsZW1lbnQiLCJwcm9wcyIsImNoaWxkcmVuIiwiZXF1YWxBc3BlY3RSYXRpbyIsImdldElzRXF1YWxBc3BlY3RSYXRpbyIsInRyYW5zaXRpb25TdHlsZXMiLCJnZXRUcmFuc2l0aW9uU3R5bGUiLCJrZXkiLCJ0b1N0cmluZyIsImFuaW1hdGlvblN0eWxlIiwic3R5bGVzIiwibmF0aXZlQW5pbWF0aW9uU3R5bGUiLCJuYXRpdmVTdHlsZXMiLCJyZXNvbHZlZE1ldHJpY3MiLCJtZXRyaWNzIiwib3ZlcnJpZGVTdHlsZXMiLCJwb3NpdGlvbiIsImxlZnQiLCJ4IiwidG9wIiwieSIsIndpZHRoIiwiaGVpZ2h0IiwiX19pbmRleCIsImluZGV4IiwiYW5pbWF0ZWQiLCJjb21wb25lbnQiLCJjcmVhdGVFbGVtZW50IiwidHlwZSIsImxvZyIsImxvZ1ByZWZpeCIsIm5hbWUiLCJyb3V0ZSIsImZyb21Bc3BlY3QiLCJNYXRoIiwicm91bmQiLCJ0b0FzcGVjdCIsImludGVycG9sYXRvckluZm8iLCJmcm9tIiwiYm91bmRpbmdib3giLCJib3VuZGluZ0JveE1ldHJpY3MiLCJzdHlsZSIsImdldEZsYXR0ZW5lZFN0eWxlIiwidG8iLCJzY2FsZVgiLCJzY2FsZVJlbGF0aXZlVG8iLCJzY2FsZVkiLCJnZXRJbnRlcnBvbGF0aW9uIiwiZGltZW5zaW9ucyIsIkRpbWVuc2lvbnMiLCJnZXQiLCJmb3JFYWNoIiwiaW50ZXJwb2xhdG9yIiwiaW50ZXJwb2xhdG9yUmVzdWx0IiwiaW50ZXJwb2xhdG9yRnVuY3Rpb24iLCJuYXRpdmVBbmltYXRpb25TdHlsZXMiLCJwdXNoIiwiYW5pbWF0aW9uU3R5bGVzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFFQTs7QUFDQTs7QUFFQTs7QUFDQTs7QUFFQSxJQUFNQSxpQkFBaUIsR0FBRyxTQUFwQkEsaUJBQW9CLENBQUNDLGNBQUQsRUFDeEJDLHdCQUR3QjtBQUFBLFNBQ2VELGNBQWMsQ0FBQ0UsR0FBZixDQUFtQixVQUFDQyxJQUFELEVBQU9DLEdBQVAsRUFBZTtBQUFBLFFBQ2pFQyxRQURpRSxHQUM1Q0YsSUFENEMsQ0FDakVFLFFBRGlFO0FBQUEsUUFDdkRDLE1BRHVELEdBQzVDSCxJQUQ0QyxDQUN2REcsTUFEdUQ7O0FBRXpFLFFBQU1DLE9BQU8sR0FBR0MsZUFBTUMsUUFBTixDQUFlQyxJQUFmLENBQW9CTCxRQUFRLENBQUNNLFlBQVQsQ0FBc0JDLEtBQXRCLENBQTRCQyxRQUFoRCxDQUFoQjs7QUFFQSxRQUFNQyxnQkFBZ0IsR0FBR0MscUJBQXFCLENBQUNWLFFBQUQsRUFBV0MsTUFBWCxDQUE5QztBQUVBLFFBQU1VLGdCQUFnQixHQUFHQyxrQkFBa0IsQ0FBQ1osUUFBRCxFQUFXQyxNQUFYLEVBQW1CTCx3QkFBbkIsRUFDekNhLGdCQUR5QyxDQUEzQztBQUdBLFFBQU1JLEdBQUcsV0FBU2QsR0FBRyxDQUFDZSxRQUFKLEVBQWxCO0FBQ0EsUUFBTUMsY0FBYyxHQUFHSixnQkFBZ0IsQ0FBQ0ssTUFBeEM7QUFDQSxRQUFNQyxvQkFBb0IsR0FBRyxDQUFDTixnQkFBZ0IsQ0FBQ08sWUFBbEIsQ0FBN0I7QUFDQSxRQUFNQyxlQUFlLEdBQUcsK0JBQW1CbkIsUUFBbkIsRUFBNkJBLFFBQVEsQ0FBQ29CLE9BQXRDLENBQXhCO0FBRUEsUUFBTUMsY0FBYyxHQUFHO0FBQ3JCQyxNQUFBQSxRQUFRLEVBQUUsVUFEVztBQUVyQkMsTUFBQUEsSUFBSSxFQUFFSixlQUFlLENBQUNLLENBRkQ7QUFHckJDLE1BQUFBLEdBQUcsRUFBRU4sZUFBZSxDQUFDTyxDQUhBO0FBSXJCQyxNQUFBQSxLQUFLLEVBQUVSLGVBQWUsQ0FBQ1EsS0FKRjtBQUtyQkMsTUFBQUEsTUFBTSxFQUFFVCxlQUFlLENBQUNTO0FBTEgsS0FBdkI7QUFRQSxRQUFNckIsS0FBSyxtQ0FBUUwsT0FBTyxDQUFDSyxLQUFoQjtBQUF1QnNCLE1BQUFBLE9BQU8sRUFBRTdCLFFBQVEsQ0FBQzhCO0FBQXpDLE1BQVg7O0FBQ0EsUUFBSTlCLFFBQVEsQ0FBQytCLFFBQWIsRUFBdUI7QUFDckJ4QixNQUFBQSxLQUFLLENBQUNQLFFBQVEsQ0FBQytCLFFBQVYsQ0FBTCxHQUEyQm5DLHdCQUF3QixDQUFDLEtBQUQsQ0FBbkQ7QUFDRCxLQUZELE1BRU8sSUFBSUssTUFBTSxDQUFDOEIsUUFBWCxFQUFxQjtBQUMxQnhCLE1BQUFBLEtBQUssQ0FBQ04sTUFBTSxDQUFDOEIsUUFBUixDQUFMLEdBQXlCbkMsd0JBQXdCLENBQUMsS0FBRCxDQUFqRDtBQUNEOztBQUVELFFBQU1vQyxTQUFTLEdBQUc3QixlQUFNOEIsYUFBTixDQUFvQi9CLE9BQU8sQ0FBQ2dDLElBQTVCLGtDQUF1QzNCLEtBQXZDO0FBQThDTSxNQUFBQSxHQUFHLEVBQUhBO0FBQTlDLE9BQWxCOztBQUVBLFdBQU8sa0NBQXNCO0FBQzNCbUIsTUFBQUEsU0FBUyxFQUFUQSxTQUQyQjtBQUUzQmQsTUFBQUEsWUFBWSxFQUFFRCxvQkFGYTtBQUczQkQsTUFBQUEsTUFBTSxFQUFFRCxjQUhtQjtBQUkzQk0sTUFBQUEsY0FBYyxFQUFkQSxjQUoyQjtBQUszQlosTUFBQUEsZ0JBQWdCLEVBQWhCQSxnQkFMMkI7QUFNM0IwQixNQUFBQSxHQUFHLEVBQUUsSUFOc0I7QUFPM0JDLE1BQUFBLFNBQVMsV0FBU3BDLFFBQVEsQ0FBQ3FDLElBQWxCLFNBQTBCckMsUUFBUSxDQUFDc0M7QUFQakIsS0FBdEIsQ0FBUDtBQVNELEdBeEN3QyxDQURmO0FBQUEsQ0FBMUI7Ozs7QUEyQ0EsSUFBTTVCLHFCQUFxQixHQUFHLFNBQXhCQSxxQkFBd0IsQ0FBQ1YsUUFBRCxFQUFXQyxNQUFYLEVBQXNCO0FBQ2xELE1BQU1zQyxVQUFVLEdBQUdDLElBQUksQ0FBQ0MsS0FBTCxDQUFZekMsUUFBUSxDQUFDb0IsT0FBVCxDQUFpQk8sS0FBakIsR0FBeUIzQixRQUFRLENBQUNvQixPQUFULENBQWlCUSxNQUEzQyxHQUFxRCxHQUFoRSxJQUF1RSxHQUExRjtBQUNBLE1BQU1jLFFBQVEsR0FBR0YsSUFBSSxDQUFDQyxLQUFMLENBQVl4QyxNQUFNLENBQUNtQixPQUFQLENBQWVPLEtBQWYsR0FBdUIxQixNQUFNLENBQUNtQixPQUFQLENBQWVRLE1BQXZDLEdBQWlELEdBQTVELElBQW1FLEdBQXBGO0FBQ0EsU0FBT1csVUFBVSxLQUFLRyxRQUF0QjtBQUNELENBSkQ7O0FBTUEsSUFBTTlCLGtCQUFrQixHQUFHLFNBQXJCQSxrQkFBcUIsQ0FDekJaLFFBRHlCLEVBQ0NDLE1BREQsRUFDeUJMLHdCQUR6QixFQUV6QmEsZ0JBRnlCLEVBR3RCO0FBQ0gsTUFBTWtDLGdCQUEyQyxHQUFHO0FBQ2xEQyxJQUFBQSxJQUFJLEVBQUU7QUFDSnhCLE1BQUFBLE9BQU8sRUFBRXBCLFFBQVEsQ0FBQ29CLE9BRGQ7QUFFSnlCLE1BQUFBLFdBQVcsRUFBRTdDLFFBQVEsQ0FBQzhDLGtCQUZsQjtBQUdKQyxNQUFBQSxLQUFLLEVBQUUvQyxRQUFRLENBQUNnRCxpQkFBVDtBQUhILEtBRDRDO0FBTWxEQyxJQUFBQSxFQUFFLEVBQUU7QUFDRjdCLE1BQUFBLE9BQU8sRUFBRW5CLE1BQU0sQ0FBQ21CLE9BRGQ7QUFFRjJCLE1BQUFBLEtBQUssRUFBRTlDLE1BQU0sQ0FBQytDLGlCQUFQLEVBRkw7QUFHRkgsTUFBQUEsV0FBVyxFQUFFNUMsTUFBTSxDQUFDNkM7QUFIbEIsS0FOOEM7QUFXbERJLElBQUFBLE1BQU0sRUFBRWpELE1BQU0sQ0FBQ2tELGVBQVAsQ0FBdUJuRCxRQUF2QixFQUFpQ3dCLENBWFM7QUFZbEQ0QixJQUFBQSxNQUFNLEVBQUVuRCxNQUFNLENBQUNrRCxlQUFQLENBQXVCbkQsUUFBdkIsRUFBaUMwQixDQVpTO0FBYWxEakIsSUFBQUEsZ0JBQWdCLEVBQWhCQSxnQkFia0Q7QUFjbEQ0QyxJQUFBQSxnQkFBZ0IsRUFBRXpELHdCQWRnQztBQWVsRDBELElBQUFBLFVBQVUsRUFBRUMsd0JBQVdDLEdBQVgsQ0FBZSxRQUFmO0FBZnNDLEdBQXBEO0FBa0JBLE1BQU10QyxZQUFZLEdBQUcsRUFBckI7QUFDQSxNQUFNRixNQUFNLEdBQUcsRUFBZjtBQUVBLGlEQUF1QnlDLE9BQXZCLENBQStCLFVBQUFDLFlBQVksRUFBSTtBQUM3QyxRQUFNQyxrQkFBa0IsR0FBR0QsWUFBWSxDQUFDRSxvQkFBYixDQUFrQ2pCLGdCQUFsQyxDQUEzQjs7QUFDQSxRQUFJZ0Isa0JBQUosRUFBd0I7QUFDdEIsVUFBSUEsa0JBQWtCLENBQUNFLHFCQUF2QixFQUE4QztBQUM1QzNDLFFBQUFBLFlBQVksQ0FBQzRDLElBQWIsQ0FBa0JILGtCQUFrQixDQUFDRSxxQkFBckM7QUFDRDs7QUFDRCxVQUFJRixrQkFBa0IsQ0FBQ0ksZUFBdkIsRUFBd0M7QUFDdEMvQyxRQUFBQSxNQUFNLENBQUM4QyxJQUFQLENBQVlILGtCQUFrQixDQUFDSSxlQUEvQjtBQUNEO0FBQ0Y7QUFDRixHQVZEO0FBWUEsU0FBTztBQUNMN0MsSUFBQUEsWUFBWSxrQ0FDUCx3QkFBWUEsWUFBWixDQURPLENBRFA7QUFJTEYsSUFBQUEsTUFBTTtBQUNKVyxNQUFBQSxLQUFLLEVBQUUzQixRQUFRLENBQUNvQixPQUFULENBQWlCTyxLQURwQjtBQUVKQyxNQUFBQSxNQUFNLEVBQUU1QixRQUFRLENBQUNvQixPQUFULENBQWlCUTtBQUZyQixPQUdELHdCQUFZWixNQUFaLENBSEM7QUFKRCxHQUFQO0FBVUQsQ0EvQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgRGltZW5zaW9ucyB9IGZyb20gJ3JlYWN0LW5hdGl2ZSc7XG5cbmltcG9ydCBUcmFuc2l0aW9uSXRlbSBmcm9tICcuLi9UcmFuc2l0aW9uSXRlbSc7XG5pbXBvcnQgeyBjcmVhdGVBbmltYXRlZFdyYXBwZXIsIGdldFJlc29sdmVkTWV0cmljcywgbWVyZ2VTdHlsZXMgfSBmcm9tICcuLi9VdGlscyc7XG5cbmltcG9ydCB7IGdldEludGVycG9sYXRvclR5cGVzIH0gZnJvbSAnLi9JbnRlcnBvbGF0b3JUeXBlcyc7XG5pbXBvcnQgeyBJbnRlcnBvbGF0b3JTcGVjaWZpY2F0aW9uIH0gZnJvbSAnLi4vVHlwZXMvSW50ZXJwb2xhdG9yU3BlY2lmaWNhdGlvbic7XG5cbmNvbnN0IGdldFNoYXJlZEVsZW1lbnRzID0gKHNoYXJlZEVsZW1lbnRzOiBBcnJheTxhbnk+LFxuICBnZXRJbnRlcnBvbGF0aW9uRnVuY3Rpb246IEZ1bmN0aW9uKSA9PiBzaGFyZWRFbGVtZW50cy5tYXAoKHBhaXIsIGlkeCkgPT4ge1xuICBjb25zdCB7IGZyb21JdGVtLCB0b0l0ZW0gfSA9IHBhaXI7XG4gIGNvbnN0IGVsZW1lbnQgPSBSZWFjdC5DaGlsZHJlbi5vbmx5KGZyb21JdGVtLnJlYWN0RWxlbWVudC5wcm9wcy5jaGlsZHJlbik7XG5cbiAgY29uc3QgZXF1YWxBc3BlY3RSYXRpbyA9IGdldElzRXF1YWxBc3BlY3RSYXRpbyhmcm9tSXRlbSwgdG9JdGVtKTtcblxuICBjb25zdCB0cmFuc2l0aW9uU3R5bGVzID0gZ2V0VHJhbnNpdGlvblN0eWxlKGZyb21JdGVtLCB0b0l0ZW0sIGdldEludGVycG9sYXRpb25GdW5jdGlvbixcbiAgICBlcXVhbEFzcGVjdFJhdGlvKTtcblxuICBjb25zdCBrZXkgPSBgc28tJHtpZHgudG9TdHJpbmcoKX1gO1xuICBjb25zdCBhbmltYXRpb25TdHlsZSA9IHRyYW5zaXRpb25TdHlsZXMuc3R5bGVzO1xuICBjb25zdCBuYXRpdmVBbmltYXRpb25TdHlsZSA9IFt0cmFuc2l0aW9uU3R5bGVzLm5hdGl2ZVN0eWxlc107XG4gIGNvbnN0IHJlc29sdmVkTWV0cmljcyA9IGdldFJlc29sdmVkTWV0cmljcyhmcm9tSXRlbSwgZnJvbUl0ZW0ubWV0cmljcyk7XG5cbiAgY29uc3Qgb3ZlcnJpZGVTdHlsZXMgPSB7XG4gICAgcG9zaXRpb246ICdhYnNvbHV0ZScsXG4gICAgbGVmdDogcmVzb2x2ZWRNZXRyaWNzLngsXG4gICAgdG9wOiByZXNvbHZlZE1ldHJpY3MueSxcbiAgICB3aWR0aDogcmVzb2x2ZWRNZXRyaWNzLndpZHRoLFxuICAgIGhlaWdodDogcmVzb2x2ZWRNZXRyaWNzLmhlaWdodCxcbiAgfTtcblxuICBjb25zdCBwcm9wcyA9IHsgLi4uZWxlbWVudC5wcm9wcywgX19pbmRleDogZnJvbUl0ZW0uaW5kZXggfTtcbiAgaWYgKGZyb21JdGVtLmFuaW1hdGVkKSB7XG4gICAgcHJvcHNbZnJvbUl0ZW0uYW5pbWF0ZWRdID0gZ2V0SW50ZXJwb2xhdGlvbkZ1bmN0aW9uKGZhbHNlKTtcbiAgfSBlbHNlIGlmICh0b0l0ZW0uYW5pbWF0ZWQpIHtcbiAgICBwcm9wc1t0b0l0ZW0uYW5pbWF0ZWRdID0gZ2V0SW50ZXJwb2xhdGlvbkZ1bmN0aW9uKGZhbHNlKTtcbiAgfVxuXG4gIGNvbnN0IGNvbXBvbmVudCA9IFJlYWN0LmNyZWF0ZUVsZW1lbnQoZWxlbWVudC50eXBlLCB7IC4uLnByb3BzLCBrZXkgfSk7XG5cbiAgcmV0dXJuIGNyZWF0ZUFuaW1hdGVkV3JhcHBlcih7XG4gICAgY29tcG9uZW50LFxuICAgIG5hdGl2ZVN0eWxlczogbmF0aXZlQW5pbWF0aW9uU3R5bGUsXG4gICAgc3R5bGVzOiBhbmltYXRpb25TdHlsZSxcbiAgICBvdmVycmlkZVN0eWxlcyxcbiAgICBlcXVhbEFzcGVjdFJhdGlvLFxuICAgIGxvZzogdHJ1ZSxcbiAgICBsb2dQcmVmaXg6IGBTRTogJHtmcm9tSXRlbS5uYW1lfS8ke2Zyb21JdGVtLnJvdXRlfWAsXG4gIH0pO1xufSk7XG5cbmNvbnN0IGdldElzRXF1YWxBc3BlY3RSYXRpbyA9IChmcm9tSXRlbSwgdG9JdGVtKSA9PiB7XG4gIGNvbnN0IGZyb21Bc3BlY3QgPSBNYXRoLnJvdW5kKChmcm9tSXRlbS5tZXRyaWNzLndpZHRoIC8gZnJvbUl0ZW0ubWV0cmljcy5oZWlnaHQpICogMTAwKSAvIDEwMDtcbiAgY29uc3QgdG9Bc3BlY3QgPSBNYXRoLnJvdW5kKCh0b0l0ZW0ubWV0cmljcy53aWR0aCAvIHRvSXRlbS5tZXRyaWNzLmhlaWdodCkgKiAxMDApIC8gMTAwO1xuICByZXR1cm4gZnJvbUFzcGVjdCA9PT0gdG9Bc3BlY3Q7XG59O1xuXG5jb25zdCBnZXRUcmFuc2l0aW9uU3R5bGUgPSAoXG4gIGZyb21JdGVtOiBUcmFuc2l0aW9uSXRlbSwgdG9JdGVtOiBUcmFuc2l0aW9uSXRlbSwgZ2V0SW50ZXJwb2xhdGlvbkZ1bmN0aW9uOiBGdW5jdGlvbixcbiAgZXF1YWxBc3BlY3RSYXRpbzogYm9vbGVhbixcbikgPT4ge1xuICBjb25zdCBpbnRlcnBvbGF0b3JJbmZvOiBJbnRlcnBvbGF0b3JTcGVjaWZpY2F0aW9uID0ge1xuICAgIGZyb206IHtcbiAgICAgIG1ldHJpY3M6IGZyb21JdGVtLm1ldHJpY3MsXG4gICAgICBib3VuZGluZ2JveDogZnJvbUl0ZW0uYm91bmRpbmdCb3hNZXRyaWNzLFxuICAgICAgc3R5bGU6IGZyb21JdGVtLmdldEZsYXR0ZW5lZFN0eWxlKCksXG4gICAgfSxcbiAgICB0bzoge1xuICAgICAgbWV0cmljczogdG9JdGVtLm1ldHJpY3MsXG4gICAgICBzdHlsZTogdG9JdGVtLmdldEZsYXR0ZW5lZFN0eWxlKCksXG4gICAgICBib3VuZGluZ2JveDogdG9JdGVtLmJvdW5kaW5nQm94TWV0cmljcyxcbiAgICB9LFxuICAgIHNjYWxlWDogdG9JdGVtLnNjYWxlUmVsYXRpdmVUbyhmcm9tSXRlbSkueCxcbiAgICBzY2FsZVk6IHRvSXRlbS5zY2FsZVJlbGF0aXZlVG8oZnJvbUl0ZW0pLnksXG4gICAgZXF1YWxBc3BlY3RSYXRpbyxcbiAgICBnZXRJbnRlcnBvbGF0aW9uOiBnZXRJbnRlcnBvbGF0aW9uRnVuY3Rpb24sXG4gICAgZGltZW5zaW9uczogRGltZW5zaW9ucy5nZXQoJ3dpbmRvdycpLFxuICB9O1xuXG4gIGNvbnN0IG5hdGl2ZVN0eWxlcyA9IFtdO1xuICBjb25zdCBzdHlsZXMgPSBbXTtcblxuICBnZXRJbnRlcnBvbGF0b3JUeXBlcygpLmZvckVhY2goaW50ZXJwb2xhdG9yID0+IHtcbiAgICBjb25zdCBpbnRlcnBvbGF0b3JSZXN1bHQgPSBpbnRlcnBvbGF0b3IuaW50ZXJwb2xhdG9yRnVuY3Rpb24oaW50ZXJwb2xhdG9ySW5mbyk7XG4gICAgaWYgKGludGVycG9sYXRvclJlc3VsdCkge1xuICAgICAgaWYgKGludGVycG9sYXRvclJlc3VsdC5uYXRpdmVBbmltYXRpb25TdHlsZXMpIHtcbiAgICAgICAgbmF0aXZlU3R5bGVzLnB1c2goaW50ZXJwb2xhdG9yUmVzdWx0Lm5hdGl2ZUFuaW1hdGlvblN0eWxlcyk7XG4gICAgICB9XG4gICAgICBpZiAoaW50ZXJwb2xhdG9yUmVzdWx0LmFuaW1hdGlvblN0eWxlcykge1xuICAgICAgICBzdHlsZXMucHVzaChpbnRlcnBvbGF0b3JSZXN1bHQuYW5pbWF0aW9uU3R5bGVzKTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuXG4gIHJldHVybiB7XG4gICAgbmF0aXZlU3R5bGVzOiB7XG4gICAgICAuLi5tZXJnZVN0eWxlcyhuYXRpdmVTdHlsZXMpLFxuICAgIH0sXG4gICAgc3R5bGVzOiB7XG4gICAgICB3aWR0aDogZnJvbUl0ZW0ubWV0cmljcy53aWR0aCxcbiAgICAgIGhlaWdodDogZnJvbUl0ZW0ubWV0cmljcy5oZWlnaHQsXG4gICAgICAuLi5tZXJnZVN0eWxlcyhzdHlsZXMpLFxuICAgIH0sXG4gIH07XG59O1xuXG5leHBvcnQgeyBnZXRTaGFyZWRFbGVtZW50cyB9O1xuIl19