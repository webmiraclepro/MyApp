eec1d510b12703fabd38afbbcc9e504f
var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));

var _objectSpread2 = _interopRequireDefault(require("@babel/runtime/helpers/objectSpread"));

var NavigationActions = _interopRequireWildcard(require("../NavigationActions"));

var StackActions = _interopRequireWildcard(require("./StackActions"));

var _createConfigGetter = _interopRequireDefault(require("./createConfigGetter"));

var _getScreenForRouteName = _interopRequireDefault(require("./getScreenForRouteName"));

var _StateUtils = _interopRequireDefault(require("../StateUtils"));

var _validateRouteConfigMap = _interopRequireDefault(require("./validateRouteConfigMap"));

var _invariant = _interopRequireDefault(require("../utils/invariant"));

var _KeyGenerator = require("./KeyGenerator");

var _pathUtils = require("./pathUtils");

function behavesLikePushAction(action) {
  return action.type === NavigationActions.NAVIGATE || action.type === StackActions.PUSH;
}

var defaultActionCreators = function defaultActionCreators() {
  return {};
};

function isResetToRootStack(action) {
  return action.type === StackActions.RESET && action.key === null;
}

var _default = function _default(routeConfigs) {
  var stackConfig = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
  (0, _validateRouteConfigMap.default)(routeConfigs);
  var childRouters = {};
  var routeNames = Object.keys(routeConfigs);
  routeNames.forEach(function (routeName) {
    var routeConfig = routeConfigs[routeName];
    var screen = routeConfig && routeConfig.screen ? routeConfig.screen : routeConfig;

    if (screen && screen.router) {
      childRouters[routeName] = screen.router;
    } else {
      childRouters[routeName] = null;
    }
  });
  var initialRouteParams = stackConfig.initialRouteParams;
  var getCustomActionCreators = stackConfig.getCustomActionCreators || defaultActionCreators;
  var initialRouteName = stackConfig.initialRouteName || routeNames[0];
  var initialChildRouter = childRouters[initialRouteName];

  function getInitialState(action) {
    var route = {};
    var childRouter = childRouters[action.routeName];

    if (behavesLikePushAction(action) && childRouter !== undefined) {
      var childState = {};

      if (childRouter !== null) {
        var childAction = action.action || NavigationActions.init({
          params: action.params
        });
        childState = childRouter.getStateForAction(childAction);
      }

      return {
        key: 'StackRouterRoot',
        isTransitioning: false,
        index: 0,
        routes: [(0, _objectSpread2.default)({
          params: action.params
        }, childState, {
          key: action.key || (0, _KeyGenerator.generateKey)(),
          routeName: action.routeName
        })]
      };
    }

    if (initialChildRouter) {
      route = initialChildRouter.getStateForAction(NavigationActions.navigate({
        routeName: initialRouteName,
        params: initialRouteParams
      }));
    }

    var params = (routeConfigs[initialRouteName].params || route.params || action.params || initialRouteParams) && (0, _objectSpread2.default)({}, routeConfigs[initialRouteName].params || {}, route.params || {}, action.params || {}, initialRouteParams || {});
    var initialRouteKey = stackConfig.initialRouteKey;
    route = (0, _objectSpread2.default)({}, route, params ? {
      params: params
    } : {}, {
      routeName: initialRouteName,
      key: action.key || initialRouteKey || (0, _KeyGenerator.generateKey)()
    });
    return {
      key: 'StackRouterRoot',
      isTransitioning: false,
      index: 0,
      routes: [route]
    };
  }

  function getParamsForRouteAndAction(routeName, action) {
    var routeConfig = routeConfigs[routeName];

    if (routeConfig && routeConfig.params) {
      return (0, _objectSpread2.default)({}, routeConfig.params, action.params);
    } else {
      return action.params;
    }
  }

  var _createPathParser = (0, _pathUtils.createPathParser)(childRouters, routeConfigs, stackConfig),
      getPathAndParamsForRoute = _createPathParser.getPathAndParamsForRoute,
      _getActionForPathAndParams = _createPathParser.getActionForPathAndParams;

  return {
    childRouters: childRouters,
    getComponentForState: function getComponentForState(state) {
      var activeChildRoute = state.routes[state.index];
      var routeName = activeChildRoute.routeName;

      if (childRouters[routeName]) {
        return childRouters[routeName].getComponentForState(activeChildRoute);
      }

      return (0, _getScreenForRouteName.default)(routeConfigs, routeName);
    },
    getComponentForRouteName: function getComponentForRouteName(routeName) {
      return (0, _getScreenForRouteName.default)(routeConfigs, routeName);
    },
    getActionCreators: function getActionCreators(route, navStateKey) {
      return (0, _objectSpread2.default)({}, getCustomActionCreators(route, navStateKey), {
        pop: function pop(n, params) {
          return StackActions.pop((0, _objectSpread2.default)({
            n: n
          }, params));
        },
        popToTop: function popToTop(params) {
          return StackActions.popToTop(params);
        },
        push: function push(routeName, params, action) {
          return StackActions.push({
            routeName: routeName,
            params: params,
            action: action
          });
        },
        replace: function replace(replaceWith, params, action, newKey) {
          if (typeof replaceWith === 'string') {
            return StackActions.replace({
              routeName: replaceWith,
              params: params,
              action: action,
              key: route.key,
              newKey: newKey
            });
          }

          (0, _invariant.default)(typeof replaceWith === 'object', 'Must replaceWith an object or a string');
          (0, _invariant.default)(params == null, 'Params must not be provided to .replace() when specifying an object');
          (0, _invariant.default)(action == null, 'Child action must not be provided to .replace() when specifying an object');
          (0, _invariant.default)(newKey == null, 'Child action must not be provided to .replace() when specifying an object');
          return StackActions.replace(replaceWith);
        },
        reset: function reset(actions, index) {
          return StackActions.reset({
            actions: actions,
            index: index == null ? actions.length - 1 : index,
            key: navStateKey
          });
        },
        dismiss: function dismiss() {
          return NavigationActions.back({
            key: navStateKey
          });
        }
      });
    },
    getStateForAction: function getStateForAction(action, state) {
      if (!state) {
        return getInitialState(action);
      }

      var activeChildRoute = state.routes[state.index];

      if (!isResetToRootStack(action) && action.type !== NavigationActions.NAVIGATE) {
        var activeChildRouter = childRouters[activeChildRoute.routeName];

        if (activeChildRouter) {
          var route = activeChildRouter.getStateForAction(action, activeChildRoute);

          if (route !== null && route !== activeChildRoute) {
            return _StateUtils.default.replaceAt(state, activeChildRoute.key, route, action.type === NavigationActions.SET_PARAMS);
          }
        }
      } else if (action.type === NavigationActions.NAVIGATE) {
        for (var _iterator = state.routes.slice().reverse(), _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : _iterator[typeof Symbol === "function" ? typeof Symbol === "function" ? Symbol.iterator : "@@iterator" : "@@iterator"]();;) {
          var _ref;

          if (_isArray) {
            if (_i >= _iterator.length) break;
            _ref = _iterator[_i++];
          } else {
            _i = _iterator.next();
            if (_i.done) break;
            _ref = _i.value;
          }

          var _childRoute = _ref;
          var childRouter = childRouters[_childRoute.routeName];
          var childAction = action.routeName === _childRoute.routeName && action.action ? action.action : action;

          if (childRouter) {
            var nextRouteState = childRouter.getStateForAction(childAction, _childRoute);

            if (nextRouteState === null || nextRouteState !== _childRoute) {
              var newState = _StateUtils.default.replaceAndPrune(state, nextRouteState ? nextRouteState.key : _childRoute.key, nextRouteState ? nextRouteState : _childRoute);

              return (0, _objectSpread2.default)({}, newState, {
                isTransitioning: state.index !== newState.index ? action.immediate !== true : state.isTransitioning
              });
            }
          }
        }
      }

      if (behavesLikePushAction(action) && childRouters[action.routeName] !== undefined) {
        var _childRouter = childRouters[action.routeName];

        var _route;

        (0, _invariant.default)(action.type !== StackActions.PUSH || action.key == null, 'StackRouter does not support key on the push action');
        var lastRouteIndex = state.routes.findIndex(function (r) {
          if (action.key) {
            return r.key === action.key;
          } else {
            return r.routeName === action.routeName;
          }
        });

        if (action.type !== StackActions.PUSH && lastRouteIndex !== -1) {
          if (state.index === lastRouteIndex && !action.params) {
            return null;
          }

          var routes = state.routes.slice(0, lastRouteIndex + 1);

          if (action.params) {
            var _route2 = state.routes[lastRouteIndex];
            routes[lastRouteIndex] = (0, _objectSpread2.default)({}, _route2, {
              params: (0, _objectSpread2.default)({}, _route2.params, action.params)
            });
          }

          return (0, _objectSpread2.default)({}, state, {
            isTransitioning: state.index !== lastRouteIndex ? action.immediate !== true : state.isTransitioning,
            index: lastRouteIndex,
            routes: routes
          });
        }

        if (_childRouter) {
          var _childAction = action.action || NavigationActions.init({
            params: getParamsForRouteAndAction(action.routeName, action)
          });

          _route = (0, _objectSpread2.default)({
            params: getParamsForRouteAndAction(action.routeName, action)
          }, _childRouter.getStateForAction(_childAction), {
            routeName: action.routeName,
            key: action.key || (0, _KeyGenerator.generateKey)()
          });
        } else {
          _route = {
            params: getParamsForRouteAndAction(action.routeName, action),
            routeName: action.routeName,
            key: action.key || (0, _KeyGenerator.generateKey)()
          };
        }

        return (0, _objectSpread2.default)({}, _StateUtils.default.push(state, _route), {
          isTransitioning: action.immediate !== true
        });
      } else if (action.type === StackActions.PUSH && childRouters[action.routeName] === undefined) {
        return state;
      }

      if (behavesLikePushAction(action)) {
        var childRouterNames = Object.keys(childRouters);

        for (var i = 0; i < childRouterNames.length; i++) {
          var childRouterName = childRouterNames[i];
          var _childRouter2 = childRouters[childRouterName];

          if (_childRouter2) {
            var initChildRoute = _childRouter2.getStateForAction(NavigationActions.init());

            var navigatedChildRoute = _childRouter2.getStateForAction(action, initChildRoute);

            var routeToPush = null;

            if (navigatedChildRoute === null) {
              routeToPush = initChildRoute;
            } else if (navigatedChildRoute !== initChildRoute) {
              routeToPush = navigatedChildRoute;
            }

            if (routeToPush) {
              var _route3 = (0, _objectSpread2.default)({}, routeToPush, {
                routeName: childRouterName,
                key: action.key || (0, _KeyGenerator.generateKey)()
              });

              return (0, _objectSpread2.default)({}, _StateUtils.default.push(state, _route3), {
                isTransitioning: action.immediate !== true
              });
            }
          }
        }
      }

      if (action.type === StackActions.POP_TO_TOP) {
        if (action.key && state.key !== action.key) {
          return state;
        }

        if (state.index > 0) {
          return (0, _objectSpread2.default)({}, state, {
            isTransitioning: action.immediate !== true,
            index: 0,
            routes: [state.routes[0]]
          });
        }

        return state;
      }

      if (action.type === StackActions.REPLACE) {
        var routeIndex;

        if (action.key === undefined && state.routes.length) {
          routeIndex = state.routes.length - 1;
        } else {
          routeIndex = state.routes.findIndex(function (r) {
            return r.key === action.key;
          });
        }

        if (routeIndex !== -1) {
          var _childRouter3 = childRouters[action.routeName];
          var childState = {};

          if (_childRouter3) {
            var _childAction2 = action.action || NavigationActions.init({
              params: getParamsForRouteAndAction(action.routeName, action)
            });

            childState = _childRouter3.getStateForAction(_childAction2);
          }

          var _routes = (0, _toConsumableArray2.default)(state.routes);

          _routes[routeIndex] = (0, _objectSpread2.default)({
            params: getParamsForRouteAndAction(action.routeName, action)
          }, childState, {
            routeName: action.routeName,
            key: action.newKey || (0, _KeyGenerator.generateKey)()
          });
          return (0, _objectSpread2.default)({}, state, {
            routes: _routes
          });
        }
      }

      if (action.type === StackActions.COMPLETE_TRANSITION && (action.key == null || action.key === state.key) && action.toChildKey === state.routes[state.index].key && state.isTransitioning) {
        return (0, _objectSpread2.default)({}, state, {
          isTransitioning: false
        });
      }

      if (action.type === NavigationActions.SET_PARAMS) {
        var key = action.key;
        var lastRoute = state.routes.find(function (route) {
          return route.key === key;
        });

        if (lastRoute) {
          var params = (0, _objectSpread2.default)({}, lastRoute.params, action.params);

          var _routes2 = (0, _toConsumableArray2.default)(state.routes);

          _routes2[state.routes.indexOf(lastRoute)] = (0, _objectSpread2.default)({}, lastRoute, {
            params: params
          });
          return (0, _objectSpread2.default)({}, state, {
            routes: _routes2
          });
        }
      }

      if (action.type === StackActions.RESET) {
        if (action.key != null && action.key != state.key) {
          return state;
        }

        var newStackActions = action.actions;
        return (0, _objectSpread2.default)({}, state, {
          routes: newStackActions.map(function (newStackAction) {
            var router = childRouters[newStackAction.routeName];
            var childState = {};

            if (router) {
              var _childAction3 = newStackAction.action || NavigationActions.init({
                params: getParamsForRouteAndAction(newStackAction.routeName, newStackAction)
              });

              childState = router.getStateForAction(_childAction3);
            }

            return (0, _objectSpread2.default)({
              params: getParamsForRouteAndAction(newStackAction.routeName, newStackAction)
            }, childState, {
              routeName: newStackAction.routeName,
              key: newStackAction.key || (0, _KeyGenerator.generateKey)()
            });
          }),
          index: action.index
        });
      }

      if (action.type === NavigationActions.BACK || action.type === StackActions.POP) {
        var _key = action.key,
            n = action.n,
            immediate = action.immediate;
        var backRouteIndex = state.index;

        if (action.type === StackActions.POP && n != null) {
          backRouteIndex = Math.max(1, state.index - n + 1);
        } else if (_key) {
          var backRoute = state.routes.find(function (route) {
            return route.key === _key;
          });
          backRouteIndex = state.routes.indexOf(backRoute);
        }

        if (backRouteIndex > 0) {
          return (0, _objectSpread2.default)({}, state, {
            routes: state.routes.slice(0, backRouteIndex),
            index: backRouteIndex - 1,
            isTransitioning: immediate !== true
          });
        }
      }

      var keyIndex = action.key ? _StateUtils.default.indexOf(state, action.key) : -1;

      for (var _iterator2 = state.routes.slice().reverse(), _isArray2 = Array.isArray(_iterator2), _i2 = 0, _iterator2 = _isArray2 ? _iterator2 : _iterator2[typeof Symbol === "function" ? typeof Symbol === "function" ? Symbol.iterator : "@@iterator" : "@@iterator"]();;) {
        var _ref2;

        if (_isArray2) {
          if (_i2 >= _iterator2.length) break;
          _ref2 = _iterator2[_i2++];
        } else {
          _i2 = _iterator2.next();
          if (_i2.done) break;
          _ref2 = _i2.value;
        }

        var _childRoute3 = _ref2;

        if (_childRoute3.key === activeChildRoute.key) {
          continue;
        }

        if (keyIndex >= 0 && _childRoute3.key !== action.key) {
          continue;
        }

        var _childRouter5 = childRouters[_childRoute3.routeName];

        if (_childRouter5) {
          var _route4 = _childRouter5.getStateForAction(action, _childRoute3);

          if (_route4 === null) {
            return state;
          } else if (_route4 && _route4 !== _childRoute3) {
            return _StateUtils.default.replaceAt(state, _childRoute3.key, _route4, action.preserveFocus || action.type.includes('DRAWER'));
          }
        }
      }

      return state;
    },
    getPathAndParamsForState: function getPathAndParamsForState(state) {
      var route = state.routes[state.index];
      return getPathAndParamsForRoute(route);
    },
    getActionForPathAndParams: function getActionForPathAndParams(path, params) {
      return _getActionForPathAndParams(path, params);
    },
    getScreenOptions: (0, _createConfigGetter.default)(routeConfigs, stackConfig.defaultNavigationOptions)
  };
};

exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlN0YWNrUm91dGVyLmpzIl0sIm5hbWVzIjpbImFjdGlvbiIsIk5hdmlnYXRpb25BY3Rpb25zIiwiU3RhY2tBY3Rpb25zIiwiZGVmYXVsdEFjdGlvbkNyZWF0b3JzIiwic3RhY2tDb25maWciLCJjaGlsZFJvdXRlcnMiLCJyb3V0ZU5hbWVzIiwiT2JqZWN0Iiwicm91dGVDb25maWciLCJyb3V0ZUNvbmZpZ3MiLCJzY3JlZW4iLCJpbml0aWFsUm91dGVQYXJhbXMiLCJnZXRDdXN0b21BY3Rpb25DcmVhdG9ycyIsImluaXRpYWxSb3V0ZU5hbWUiLCJpbml0aWFsQ2hpbGRSb3V0ZXIiLCJyb3V0ZSIsImNoaWxkUm91dGVyIiwiYmVoYXZlc0xpa2VQdXNoQWN0aW9uIiwiY2hpbGRTdGF0ZSIsImNoaWxkQWN0aW9uIiwicGFyYW1zIiwia2V5IiwiaXNUcmFuc2l0aW9uaW5nIiwiaW5kZXgiLCJyb3V0ZXMiLCJyb3V0ZU5hbWUiLCJpbml0aWFsUm91dGVLZXkiLCJnZXRQYXRoQW5kUGFyYW1zRm9yUm91dGUiLCJnZXRBY3Rpb25Gb3JQYXRoQW5kUGFyYW1zIiwiZ2V0Q29tcG9uZW50Rm9yU3RhdGUiLCJhY3RpdmVDaGlsZFJvdXRlIiwic3RhdGUiLCJnZXRDb21wb25lbnRGb3JSb3V0ZU5hbWUiLCJnZXRBY3Rpb25DcmVhdG9ycyIsInBvcCIsIm4iLCJwb3BUb1RvcCIsInB1c2giLCJyZXBsYWNlIiwibmV3S2V5IiwicmVzZXQiLCJhY3Rpb25zIiwiZGlzbWlzcyIsImdldFN0YXRlRm9yQWN0aW9uIiwiZ2V0SW5pdGlhbFN0YXRlIiwiaXNSZXNldFRvUm9vdFN0YWNrIiwiYWN0aXZlQ2hpbGRSb3V0ZXIiLCJTdGF0ZVV0aWxzIiwiY2hpbGRSb3V0ZSIsIm5leHRSb3V0ZVN0YXRlIiwibmV3U3RhdGUiLCJsYXN0Um91dGVJbmRleCIsInIiLCJnZXRQYXJhbXNGb3JSb3V0ZUFuZEFjdGlvbiIsImNoaWxkUm91dGVyTmFtZXMiLCJpIiwiY2hpbGRSb3V0ZXJOYW1lIiwiaW5pdENoaWxkUm91dGUiLCJuYXZpZ2F0ZWRDaGlsZFJvdXRlIiwicm91dGVUb1B1c2giLCJyb3V0ZUluZGV4IiwibGFzdFJvdXRlIiwibmV3U3RhY2tBY3Rpb25zIiwicm91dGVyIiwibmV3U3RhY2tBY3Rpb24iLCJpbW1lZGlhdGUiLCJiYWNrUm91dGVJbmRleCIsIk1hdGgiLCJiYWNrUm91dGUiLCJrZXlJbmRleCIsImdldFBhdGhBbmRQYXJhbXNGb3JTdGF0ZSIsImdldFNjcmVlbk9wdGlvbnMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFBQSxJQUFBLGlCQUFBLEdBQUEsdUJBQUEsQ0FBQSxPQUFBLENBQUEsc0JBQUEsQ0FBQSxDQUFBOztBQUNBLElBQUEsWUFBQSxHQUFBLHVCQUFBLENBQUEsT0FBQSxDQUFBLGdCQUFBLENBQUEsQ0FBQTs7QUFDQSxJQUFBLG1CQUFBLEdBQUEsc0JBQUEsQ0FBQSxPQUFBLENBQUEsc0JBQUEsQ0FBQSxDQUFBOztBQUNBLElBQUEsc0JBQUEsR0FBQSxzQkFBQSxDQUFBLE9BQUEsQ0FBQSx5QkFBQSxDQUFBLENBQUE7O0FBQ0EsSUFBQSxXQUFBLEdBQUEsc0JBQUEsQ0FBQSxPQUFBLENBQUEsZUFBQSxDQUFBLENBQUE7O0FBQ0EsSUFBQSx1QkFBQSxHQUFBLHNCQUFBLENBQUEsT0FBQSxDQUFBLDBCQUFBLENBQUEsQ0FBQTs7QUFDQSxJQUFBLFVBQUEsR0FBQSxzQkFBQSxDQUFBLE9BQUEsQ0FBQSxvQkFBQSxDQUFBLENBQUE7O0FBQ0EsSUFBQSxhQUFBLEdBQUEsT0FBQSxDQUFBLGdCQUFBLENBQUE7O0FBQ0EsSUFBQSxVQUFBLEdBQUEsT0FBQSxDQUFBLGFBQUEsQ0FBQTs7QUFFQSxTQUFBLHFCQUFBLENBQUEsTUFBQSxFQUF1QztBQUNyQyxTQUNFQSxNQUFNLENBQU5BLElBQUFBLEtBQWdCQyxpQkFBaUIsQ0FBakNELFFBQUFBLElBQ0FBLE1BQU0sQ0FBTkEsSUFBQUEsS0FBZ0JFLFlBQVksQ0FGOUIsSUFBQTtBQU1GOztBQUFBLElBQU1DLHFCQUFx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QUEsYUFBQSxLQUFBO0FBOWNHLEtBQUE7QUFpZEx1QixJQUFBQSx3QkFqZEssRUFBQSxTQUFBLHdCQUFBLENBQUEsS0FBQSxFQWlkMkI7QUFDOUIsVUFBTXZELEtBQUssR0FBR2dCLEtBQUssQ0FBTEEsTUFBQUEsQ0FBYUEsS0FBSyxDQUFoQyxLQUFjQSxDQUFkO0FBQ0EsYUFBT0osd0JBQXdCLENBQS9CLEtBQStCLENBQS9CO0FBbmRHLEtBQUE7QUFzZExDLElBQUFBLHlCQXRkSyxFQUFBLFNBQUEseUJBQUEsQ0FBQSxJQUFBLEVBQUEsTUFBQSxFQXNkbUM7QUFDdEMsYUFBT0EsMEJBQXlCLENBQUEsSUFBQSxFQUFoQyxNQUFnQyxDQUFoQztBQXZkRyxLQUFBO0FBMGRMMkMsSUFBQUEsZ0JBQWdCLEVBQUUsQ0FBQSxHQUFBLG1CQUFBLENBQUEsT0FBQSxFQUFBLFlBQUEsRUFFaEJuRSxXQUFXLENBNWRmLHdCQTBkb0I7QUExZGIsR0FBUCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIE5hdmlnYXRpb25BY3Rpb25zIGZyb20gJy4uL05hdmlnYXRpb25BY3Rpb25zJztcbmltcG9ydCAqIGFzIFN0YWNrQWN0aW9ucyBmcm9tICcuL1N0YWNrQWN0aW9ucyc7XG5pbXBvcnQgY3JlYXRlQ29uZmlnR2V0dGVyIGZyb20gJy4vY3JlYXRlQ29uZmlnR2V0dGVyJztcbmltcG9ydCBnZXRTY3JlZW5Gb3JSb3V0ZU5hbWUgZnJvbSAnLi9nZXRTY3JlZW5Gb3JSb3V0ZU5hbWUnO1xuaW1wb3J0IFN0YXRlVXRpbHMgZnJvbSAnLi4vU3RhdGVVdGlscyc7XG5pbXBvcnQgdmFsaWRhdGVSb3V0ZUNvbmZpZ01hcCBmcm9tICcuL3ZhbGlkYXRlUm91dGVDb25maWdNYXAnO1xuaW1wb3J0IGludmFyaWFudCBmcm9tICcuLi91dGlscy9pbnZhcmlhbnQnO1xuaW1wb3J0IHsgZ2VuZXJhdGVLZXkgfSBmcm9tICcuL0tleUdlbmVyYXRvcic7XG5pbXBvcnQgeyBjcmVhdGVQYXRoUGFyc2VyIH0gZnJvbSAnLi9wYXRoVXRpbHMnO1xuXG5mdW5jdGlvbiBiZWhhdmVzTGlrZVB1c2hBY3Rpb24oYWN0aW9uKSB7XG4gIHJldHVybiAoXG4gICAgYWN0aW9uLnR5cGUgPT09IE5hdmlnYXRpb25BY3Rpb25zLk5BVklHQVRFIHx8XG4gICAgYWN0aW9uLnR5cGUgPT09IFN0YWNrQWN0aW9ucy5QVVNIXG4gICk7XG59XG5cbmNvbnN0IGRlZmF1bHRBY3Rpb25DcmVhdG9ycyA9ICgpID0+ICh7fSk7XG5cbmZ1bmN0aW9uIGlzUmVzZXRUb1Jvb3RTdGFjayhhY3Rpb24pIHtcbiAgcmV0dXJuIGFjdGlvbi50eXBlID09PSBTdGFja0FjdGlvbnMuUkVTRVQgJiYgYWN0aW9uLmtleSA9PT0gbnVsbDtcbn1cblxuZXhwb3J0IGRlZmF1bHQgKHJvdXRlQ29uZmlncywgc3RhY2tDb25maWcgPSB7fSkgPT4ge1xuICAvLyBGYWlsIGZhc3Qgb24gaW52YWxpZCByb3V0ZSBkZWZpbml0aW9uc1xuICB2YWxpZGF0ZVJvdXRlQ29uZmlnTWFwKHJvdXRlQ29uZmlncyk7XG5cbiAgY29uc3QgY2hpbGRSb3V0ZXJzID0ge307XG4gIGNvbnN0IHJvdXRlTmFtZXMgPSBPYmplY3Qua2V5cyhyb3V0ZUNvbmZpZ3MpO1xuXG4gIC8vIExvb3AgdGhyb3VnaCByb3V0ZXMgYW5kIGZpbmQgY2hpbGQgcm91dGVyc1xuICByb3V0ZU5hbWVzLmZvckVhY2gocm91dGVOYW1lID0+IHtcbiAgICBjb25zdCByb3V0ZUNvbmZpZyA9IHJvdXRlQ29uZmlnc1tyb3V0ZU5hbWVdO1xuICAgIGNvbnN0IHNjcmVlbiA9XG4gICAgICByb3V0ZUNvbmZpZyAmJiByb3V0ZUNvbmZpZy5zY3JlZW4gPyByb3V0ZUNvbmZpZy5zY3JlZW4gOiByb3V0ZUNvbmZpZztcbiAgICBpZiAoc2NyZWVuICYmIHNjcmVlbi5yb3V0ZXIpIHtcbiAgICAgIC8vIElmIGl0IGhhcyBhIHJvdXRlciBpdCdzIGEgbmF2aWdhdG9yLlxuICAgICAgY2hpbGRSb3V0ZXJzW3JvdXRlTmFtZV0gPSBzY3JlZW4ucm91dGVyO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBJZiBpdCBkb2Vzbid0IGhhdmUgcm91dGVyIGl0J3MgYW4gb3JkaW5hcnkgUmVhY3QgY29tcG9uZW50LlxuICAgICAgY2hpbGRSb3V0ZXJzW3JvdXRlTmFtZV0gPSBudWxsO1xuICAgIH1cbiAgfSk7XG5cbiAgY29uc3QgeyBpbml0aWFsUm91dGVQYXJhbXMgfSA9IHN0YWNrQ29uZmlnO1xuICBjb25zdCBnZXRDdXN0b21BY3Rpb25DcmVhdG9ycyA9XG4gICAgc3RhY2tDb25maWcuZ2V0Q3VzdG9tQWN0aW9uQ3JlYXRvcnMgfHwgZGVmYXVsdEFjdGlvbkNyZWF0b3JzO1xuXG4gIGNvbnN0IGluaXRpYWxSb3V0ZU5hbWUgPSBzdGFja0NvbmZpZy5pbml0aWFsUm91dGVOYW1lIHx8IHJvdXRlTmFtZXNbMF07XG5cbiAgY29uc3QgaW5pdGlhbENoaWxkUm91dGVyID0gY2hpbGRSb3V0ZXJzW2luaXRpYWxSb3V0ZU5hbWVdO1xuXG4gIGZ1bmN0aW9uIGdldEluaXRpYWxTdGF0ZShhY3Rpb24pIHtcbiAgICBsZXQgcm91dGUgPSB7fTtcbiAgICBjb25zdCBjaGlsZFJvdXRlciA9IGNoaWxkUm91dGVyc1thY3Rpb24ucm91dGVOYW1lXTtcblxuICAgIC8vIFRoaXMgaXMgYSBwdXNoLWxpa2UgYWN0aW9uLCBhbmQgY2hpbGRSb3V0ZXIgd2lsbCBiZSBhIHJvdXRlciBvciBudWxsIGlmIHdlIGFyZSByZXNwb25zaWJsZSBmb3IgdGhpcyByb3V0ZU5hbWVcbiAgICBpZiAoYmVoYXZlc0xpa2VQdXNoQWN0aW9uKGFjdGlvbikgJiYgY2hpbGRSb3V0ZXIgIT09IHVuZGVmaW5lZCkge1xuICAgICAgbGV0IGNoaWxkU3RhdGUgPSB7fTtcbiAgICAgIC8vIFRoZSByb3V0ZXIgaXMgbnVsbCBmb3Igbm9ybWFsIGxlYWYgcm91dGVzXG4gICAgICBpZiAoY2hpbGRSb3V0ZXIgIT09IG51bGwpIHtcbiAgICAgICAgY29uc3QgY2hpbGRBY3Rpb24gPVxuICAgICAgICAgIGFjdGlvbi5hY3Rpb24gfHwgTmF2aWdhdGlvbkFjdGlvbnMuaW5pdCh7IHBhcmFtczogYWN0aW9uLnBhcmFtcyB9KTtcbiAgICAgICAgY2hpbGRTdGF0ZSA9IGNoaWxkUm91dGVyLmdldFN0YXRlRm9yQWN0aW9uKGNoaWxkQWN0aW9uKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAga2V5OiAnU3RhY2tSb3V0ZXJSb290JyxcbiAgICAgICAgaXNUcmFuc2l0aW9uaW5nOiBmYWxzZSxcbiAgICAgICAgaW5kZXg6IDAsXG4gICAgICAgIHJvdXRlczogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIHBhcmFtczogYWN0aW9uLnBhcmFtcyxcbiAgICAgICAgICAgIC4uLmNoaWxkU3RhdGUsXG4gICAgICAgICAgICBrZXk6IGFjdGlvbi5rZXkgfHwgZ2VuZXJhdGVLZXkoKSxcbiAgICAgICAgICAgIHJvdXRlTmFtZTogYWN0aW9uLnJvdXRlTmFtZSxcbiAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgICAgfTtcbiAgICB9XG5cbiAgICBpZiAoaW5pdGlhbENoaWxkUm91dGVyKSB7XG4gICAgICByb3V0ZSA9IGluaXRpYWxDaGlsZFJvdXRlci5nZXRTdGF0ZUZvckFjdGlvbihcbiAgICAgICAgTmF2aWdhdGlvbkFjdGlvbnMubmF2aWdhdGUoe1xuICAgICAgICAgIHJvdXRlTmFtZTogaW5pdGlhbFJvdXRlTmFtZSxcbiAgICAgICAgICBwYXJhbXM6IGluaXRpYWxSb3V0ZVBhcmFtcyxcbiAgICAgICAgfSlcbiAgICAgICk7XG4gICAgfVxuICAgIGNvbnN0IHBhcmFtcyA9IChyb3V0ZUNvbmZpZ3NbaW5pdGlhbFJvdXRlTmFtZV0ucGFyYW1zIHx8XG4gICAgICByb3V0ZS5wYXJhbXMgfHxcbiAgICAgIGFjdGlvbi5wYXJhbXMgfHxcbiAgICAgIGluaXRpYWxSb3V0ZVBhcmFtcykgJiYge1xuICAgICAgLi4uKHJvdXRlQ29uZmlnc1tpbml0aWFsUm91dGVOYW1lXS5wYXJhbXMgfHwge30pLFxuICAgICAgLi4uKHJvdXRlLnBhcmFtcyB8fCB7fSksXG4gICAgICAuLi4oYWN0aW9uLnBhcmFtcyB8fCB7fSksXG4gICAgICAuLi4oaW5pdGlhbFJvdXRlUGFyYW1zIHx8IHt9KSxcbiAgICB9O1xuICAgIGNvbnN0IHsgaW5pdGlhbFJvdXRlS2V5IH0gPSBzdGFja0NvbmZpZztcbiAgICByb3V0ZSA9IHtcbiAgICAgIC4uLnJvdXRlLFxuICAgICAgLi4uKHBhcmFtcyA/IHsgcGFyYW1zIH0gOiB7fSksXG4gICAgICByb3V0ZU5hbWU6IGluaXRpYWxSb3V0ZU5hbWUsXG4gICAgICBrZXk6IGFjdGlvbi5rZXkgfHwgKGluaXRpYWxSb3V0ZUtleSB8fCBnZW5lcmF0ZUtleSgpKSxcbiAgICB9O1xuICAgIHJldHVybiB7XG4gICAgICBrZXk6ICdTdGFja1JvdXRlclJvb3QnLFxuICAgICAgaXNUcmFuc2l0aW9uaW5nOiBmYWxzZSxcbiAgICAgIGluZGV4OiAwLFxuICAgICAgcm91dGVzOiBbcm91dGVdLFxuICAgIH07XG4gIH1cblxuICBmdW5jdGlvbiBnZXRQYXJhbXNGb3JSb3V0ZUFuZEFjdGlvbihyb3V0ZU5hbWUsIGFjdGlvbikge1xuICAgIGxldCByb3V0ZUNvbmZpZyA9IHJvdXRlQ29uZmlnc1tyb3V0ZU5hbWVdO1xuICAgIGlmIChyb3V0ZUNvbmZpZyAmJiByb3V0ZUNvbmZpZy5wYXJhbXMpIHtcbiAgICAgIHJldHVybiB7IC4uLnJvdXRlQ29uZmlnLnBhcmFtcywgLi4uYWN0aW9uLnBhcmFtcyB9O1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gYWN0aW9uLnBhcmFtcztcbiAgICB9XG4gIH1cblxuICBjb25zdCB7XG4gICAgZ2V0UGF0aEFuZFBhcmFtc0ZvclJvdXRlLFxuICAgIGdldEFjdGlvbkZvclBhdGhBbmRQYXJhbXMsXG4gIH0gPSBjcmVhdGVQYXRoUGFyc2VyKGNoaWxkUm91dGVycywgcm91dGVDb25maWdzLCBzdGFja0NvbmZpZyk7XG5cbiAgcmV0dXJuIHtcbiAgICBjaGlsZFJvdXRlcnMsXG5cbiAgICBnZXRDb21wb25lbnRGb3JTdGF0ZShzdGF0ZSkge1xuICAgICAgY29uc3QgYWN0aXZlQ2hpbGRSb3V0ZSA9IHN0YXRlLnJvdXRlc1tzdGF0ZS5pbmRleF07XG4gICAgICBjb25zdCB7IHJvdXRlTmFtZSB9ID0gYWN0aXZlQ2hpbGRSb3V0ZTtcbiAgICAgIGlmIChjaGlsZFJvdXRlcnNbcm91dGVOYW1lXSkge1xuICAgICAgICByZXR1cm4gY2hpbGRSb3V0ZXJzW3JvdXRlTmFtZV0uZ2V0Q29tcG9uZW50Rm9yU3RhdGUoYWN0aXZlQ2hpbGRSb3V0ZSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gZ2V0U2NyZWVuRm9yUm91dGVOYW1lKHJvdXRlQ29uZmlncywgcm91dGVOYW1lKTtcbiAgICB9LFxuXG4gICAgZ2V0Q29tcG9uZW50Rm9yUm91dGVOYW1lKHJvdXRlTmFtZSkge1xuICAgICAgcmV0dXJuIGdldFNjcmVlbkZvclJvdXRlTmFtZShyb3V0ZUNvbmZpZ3MsIHJvdXRlTmFtZSk7XG4gICAgfSxcblxuICAgIGdldEFjdGlvbkNyZWF0b3JzKHJvdXRlLCBuYXZTdGF0ZUtleSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgLi4uZ2V0Q3VzdG9tQWN0aW9uQ3JlYXRvcnMocm91dGUsIG5hdlN0YXRlS2V5KSxcbiAgICAgICAgcG9wOiAobiwgcGFyYW1zKSA9PlxuICAgICAgICAgIFN0YWNrQWN0aW9ucy5wb3Aoe1xuICAgICAgICAgICAgbixcbiAgICAgICAgICAgIC4uLnBhcmFtcyxcbiAgICAgICAgICB9KSxcbiAgICAgICAgcG9wVG9Ub3A6IHBhcmFtcyA9PiBTdGFja0FjdGlvbnMucG9wVG9Ub3AocGFyYW1zKSxcbiAgICAgICAgcHVzaDogKHJvdXRlTmFtZSwgcGFyYW1zLCBhY3Rpb24pID0+XG4gICAgICAgICAgU3RhY2tBY3Rpb25zLnB1c2goe1xuICAgICAgICAgICAgcm91dGVOYW1lLFxuICAgICAgICAgICAgcGFyYW1zLFxuICAgICAgICAgICAgYWN0aW9uLFxuICAgICAgICAgIH0pLFxuICAgICAgICByZXBsYWNlOiAocmVwbGFjZVdpdGgsIHBhcmFtcywgYWN0aW9uLCBuZXdLZXkpID0+IHtcbiAgICAgICAgICBpZiAodHlwZW9mIHJlcGxhY2VXaXRoID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgcmV0dXJuIFN0YWNrQWN0aW9ucy5yZXBsYWNlKHtcbiAgICAgICAgICAgICAgcm91dGVOYW1lOiByZXBsYWNlV2l0aCxcbiAgICAgICAgICAgICAgcGFyYW1zLFxuICAgICAgICAgICAgICBhY3Rpb24sXG4gICAgICAgICAgICAgIGtleTogcm91dGUua2V5LFxuICAgICAgICAgICAgICBuZXdLZXksXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaW52YXJpYW50KFxuICAgICAgICAgICAgdHlwZW9mIHJlcGxhY2VXaXRoID09PSAnb2JqZWN0JyxcbiAgICAgICAgICAgICdNdXN0IHJlcGxhY2VXaXRoIGFuIG9iamVjdCBvciBhIHN0cmluZydcbiAgICAgICAgICApO1xuICAgICAgICAgIGludmFyaWFudChcbiAgICAgICAgICAgIHBhcmFtcyA9PSBudWxsLFxuICAgICAgICAgICAgJ1BhcmFtcyBtdXN0IG5vdCBiZSBwcm92aWRlZCB0byAucmVwbGFjZSgpIHdoZW4gc3BlY2lmeWluZyBhbiBvYmplY3QnXG4gICAgICAgICAgKTtcbiAgICAgICAgICBpbnZhcmlhbnQoXG4gICAgICAgICAgICBhY3Rpb24gPT0gbnVsbCxcbiAgICAgICAgICAgICdDaGlsZCBhY3Rpb24gbXVzdCBub3QgYmUgcHJvdmlkZWQgdG8gLnJlcGxhY2UoKSB3aGVuIHNwZWNpZnlpbmcgYW4gb2JqZWN0J1xuICAgICAgICAgICk7XG4gICAgICAgICAgaW52YXJpYW50KFxuICAgICAgICAgICAgbmV3S2V5ID09IG51bGwsXG4gICAgICAgICAgICAnQ2hpbGQgYWN0aW9uIG11c3Qgbm90IGJlIHByb3ZpZGVkIHRvIC5yZXBsYWNlKCkgd2hlbiBzcGVjaWZ5aW5nIGFuIG9iamVjdCdcbiAgICAgICAgICApO1xuICAgICAgICAgIHJldHVybiBTdGFja0FjdGlvbnMucmVwbGFjZShyZXBsYWNlV2l0aCk7XG4gICAgICAgIH0sXG4gICAgICAgIHJlc2V0OiAoYWN0aW9ucywgaW5kZXgpID0+XG4gICAgICAgICAgU3RhY2tBY3Rpb25zLnJlc2V0KHtcbiAgICAgICAgICAgIGFjdGlvbnMsXG4gICAgICAgICAgICBpbmRleDogaW5kZXggPT0gbnVsbCA/IGFjdGlvbnMubGVuZ3RoIC0gMSA6IGluZGV4LFxuICAgICAgICAgICAga2V5OiBuYXZTdGF0ZUtleSxcbiAgICAgICAgICB9KSxcbiAgICAgICAgZGlzbWlzczogKCkgPT5cbiAgICAgICAgICBOYXZpZ2F0aW9uQWN0aW9ucy5iYWNrKHtcbiAgICAgICAgICAgIGtleTogbmF2U3RhdGVLZXksXG4gICAgICAgICAgfSksXG4gICAgICB9O1xuICAgIH0sXG5cbiAgICBnZXRTdGF0ZUZvckFjdGlvbihhY3Rpb24sIHN0YXRlKSB7XG4gICAgICAvLyBTZXQgdXAgdGhlIGluaXRpYWwgc3RhdGUgaWYgbmVlZGVkXG4gICAgICBpZiAoIXN0YXRlKSB7XG4gICAgICAgIHJldHVybiBnZXRJbml0aWFsU3RhdGUoYWN0aW9uKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgYWN0aXZlQ2hpbGRSb3V0ZSA9IHN0YXRlLnJvdXRlc1tzdGF0ZS5pbmRleF07XG5cbiAgICAgIGlmIChcbiAgICAgICAgIWlzUmVzZXRUb1Jvb3RTdGFjayhhY3Rpb24pICYmXG4gICAgICAgIGFjdGlvbi50eXBlICE9PSBOYXZpZ2F0aW9uQWN0aW9ucy5OQVZJR0FURVxuICAgICAgKSB7XG4gICAgICAgIC8vIExldCB0aGUgYWN0aXZlIGNoaWxkIHJvdXRlciBoYW5kbGUgdGhlIGFjdGlvblxuICAgICAgICBjb25zdCBhY3RpdmVDaGlsZFJvdXRlciA9IGNoaWxkUm91dGVyc1thY3RpdmVDaGlsZFJvdXRlLnJvdXRlTmFtZV07XG4gICAgICAgIGlmIChhY3RpdmVDaGlsZFJvdXRlcikge1xuICAgICAgICAgIGNvbnN0IHJvdXRlID0gYWN0aXZlQ2hpbGRSb3V0ZXIuZ2V0U3RhdGVGb3JBY3Rpb24oXG4gICAgICAgICAgICBhY3Rpb24sXG4gICAgICAgICAgICBhY3RpdmVDaGlsZFJvdXRlXG4gICAgICAgICAgKTtcbiAgICAgICAgICBpZiAocm91dGUgIT09IG51bGwgJiYgcm91dGUgIT09IGFjdGl2ZUNoaWxkUm91dGUpIHtcbiAgICAgICAgICAgIHJldHVybiBTdGF0ZVV0aWxzLnJlcGxhY2VBdChcbiAgICAgICAgICAgICAgc3RhdGUsXG4gICAgICAgICAgICAgIGFjdGl2ZUNoaWxkUm91dGUua2V5LFxuICAgICAgICAgICAgICByb3V0ZSxcbiAgICAgICAgICAgICAgLy8gdGhlIGZvbGxvd2luZyB0ZWxscyByZXBsYWNlQXQgdG8gTk9UIGNoYW5nZSB0aGUgaW5kZXggdG8gdGhpcyByb3V0ZSBmb3IgdGhlIHNldFBhcmFtIGFjdGlvbiwgYmVjYXVzZSBwZW9wbGUgZG9uJ3QgZXhwZWN0IHBhcmFtLXNldHRpbmcgYWN0aW9ucyB0byBzd2l0Y2ggdGhlIGFjdGl2ZSByb3V0ZVxuICAgICAgICAgICAgICBhY3Rpb24udHlwZSA9PT0gTmF2aWdhdGlvbkFjdGlvbnMuU0VUX1BBUkFNU1xuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAoYWN0aW9uLnR5cGUgPT09IE5hdmlnYXRpb25BY3Rpb25zLk5BVklHQVRFKSB7XG4gICAgICAgIC8vIFRyYXZlcnNlIHJvdXRlcyBmcm9tIHRoZSB0b3Agb2YgdGhlIHN0YWNrIHRvIHRoZSBib3R0b20sIHNvIHRoZVxuICAgICAgICAvLyBhY3RpdmUgcm91dGUgaGFzIHRoZSBmaXJzdCBvcHBvcnR1bml0eSwgdGhlbiB0aGUgb25lIGJlZm9yZSBpdCwgZXRjLlxuXG4gICAgICAgIGZvciAobGV0IGNoaWxkUm91dGUgb2Ygc3RhdGUucm91dGVzLnNsaWNlKCkucmV2ZXJzZSgpKSB7XG4gICAgICAgICAgbGV0IGNoaWxkUm91dGVyID0gY2hpbGRSb3V0ZXJzW2NoaWxkUm91dGUucm91dGVOYW1lXTtcbiAgICAgICAgICBsZXQgY2hpbGRBY3Rpb24gPVxuICAgICAgICAgICAgYWN0aW9uLnJvdXRlTmFtZSA9PT0gY2hpbGRSb3V0ZS5yb3V0ZU5hbWUgJiYgYWN0aW9uLmFjdGlvblxuICAgICAgICAgICAgICA/IGFjdGlvbi5hY3Rpb25cbiAgICAgICAgICAgICAgOiBhY3Rpb247XG5cbiAgICAgICAgICBpZiAoY2hpbGRSb3V0ZXIpIHtcbiAgICAgICAgICAgIGNvbnN0IG5leHRSb3V0ZVN0YXRlID0gY2hpbGRSb3V0ZXIuZ2V0U3RhdGVGb3JBY3Rpb24oXG4gICAgICAgICAgICAgIGNoaWxkQWN0aW9uLFxuICAgICAgICAgICAgICBjaGlsZFJvdXRlXG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICBpZiAobmV4dFJvdXRlU3RhdGUgPT09IG51bGwgfHwgbmV4dFJvdXRlU3RhdGUgIT09IGNoaWxkUm91dGUpIHtcbiAgICAgICAgICAgICAgY29uc3QgbmV3U3RhdGUgPSBTdGF0ZVV0aWxzLnJlcGxhY2VBbmRQcnVuZShcbiAgICAgICAgICAgICAgICBzdGF0ZSxcbiAgICAgICAgICAgICAgICBuZXh0Um91dGVTdGF0ZSA/IG5leHRSb3V0ZVN0YXRlLmtleSA6IGNoaWxkUm91dGUua2V5LFxuICAgICAgICAgICAgICAgIG5leHRSb3V0ZVN0YXRlID8gbmV4dFJvdXRlU3RhdGUgOiBjaGlsZFJvdXRlXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgLi4ubmV3U3RhdGUsXG4gICAgICAgICAgICAgICAgaXNUcmFuc2l0aW9uaW5nOlxuICAgICAgICAgICAgICAgICAgc3RhdGUuaW5kZXggIT09IG5ld1N0YXRlLmluZGV4XG4gICAgICAgICAgICAgICAgICAgID8gYWN0aW9uLmltbWVkaWF0ZSAhPT0gdHJ1ZVxuICAgICAgICAgICAgICAgICAgICA6IHN0YXRlLmlzVHJhbnNpdGlvbmluZyxcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gSGFuZGxlIHB1c2ggYW5kIG5hdmlnYXRlIGFjdGlvbnMuIFRoaXMgbXVzdCBoYXBwZW4gYWZ0ZXIgdGhlIGZvY3VzZWRcbiAgICAgIC8vIGNoaWxkIHJvdXRlciBoYXMgaGFkIGEgY2hhbmNlIHRvIGhhbmRsZSB0aGUgYWN0aW9uLlxuICAgICAgaWYgKFxuICAgICAgICBiZWhhdmVzTGlrZVB1c2hBY3Rpb24oYWN0aW9uKSAmJlxuICAgICAgICBjaGlsZFJvdXRlcnNbYWN0aW9uLnJvdXRlTmFtZV0gIT09IHVuZGVmaW5lZCAvLyB1bmRlZmluZWQgbWVhbnMgaXQncyBub3QgYSBjaGlsZFJvdXRlciBvciBhIHNjcmVlblxuICAgICAgKSB7XG4gICAgICAgIGNvbnN0IGNoaWxkUm91dGVyID0gY2hpbGRSb3V0ZXJzW2FjdGlvbi5yb3V0ZU5hbWVdO1xuICAgICAgICBsZXQgcm91dGU7XG5cbiAgICAgICAgaW52YXJpYW50KFxuICAgICAgICAgIGFjdGlvbi50eXBlICE9PSBTdGFja0FjdGlvbnMuUFVTSCB8fCBhY3Rpb24ua2V5ID09IG51bGwsXG4gICAgICAgICAgJ1N0YWNrUm91dGVyIGRvZXMgbm90IHN1cHBvcnQga2V5IG9uIHRoZSBwdXNoIGFjdGlvbidcbiAgICAgICAgKTtcblxuICAgICAgICAvLyBCZWZvcmUgcHVzaGluZyBhIG5ldyByb3V0ZSB3ZSBmaXJzdCB0cnkgdG8gZmluZCBvbmUgaW4gdGhlIGV4aXN0aW5nIHJvdXRlIHN0YWNrXG4gICAgICAgIC8vIE1vcmUgaW5mb3JtYXRpb24gb24gdGhpczogaHR0cHM6Ly9naXRodWIuY29tL3JlYWN0LW5hdmlnYXRpb24vcmZjcy9ibG9iL21hc3Rlci90ZXh0LzAwMDQtbGVzcy1wdXNoeS1uYXZpZ2F0ZS5tZFxuICAgICAgICBjb25zdCBsYXN0Um91dGVJbmRleCA9IHN0YXRlLnJvdXRlcy5maW5kSW5kZXgociA9PiB7XG4gICAgICAgICAgaWYgKGFjdGlvbi5rZXkpIHtcbiAgICAgICAgICAgIHJldHVybiByLmtleSA9PT0gYWN0aW9uLmtleTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHIucm91dGVOYW1lID09PSBhY3Rpb24ucm91dGVOYW1lO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gQW4gaW5zdGFuY2Ugb2YgdGhpcyByb3V0ZSBleGlzdHMgYWxyZWFkeSBhbmQgd2UncmUgZGVhbGluZyB3aXRoIGEgbmF2aWdhdGUgYWN0aW9uXG4gICAgICAgIGlmIChhY3Rpb24udHlwZSAhPT0gU3RhY2tBY3Rpb25zLlBVU0ggJiYgbGFzdFJvdXRlSW5kZXggIT09IC0xKSB7XG4gICAgICAgICAgLy8gSWYgaW5kZXggaXMgdW5jaGFuZ2VkIGFuZCBwYXJhbXMgYXJlIG5vdCBiZWluZyBzZXQsIGxlYXZlIHN0YXRlIGlkZW50aXR5IGludGFjdFxuICAgICAgICAgIGlmIChzdGF0ZS5pbmRleCA9PT0gbGFzdFJvdXRlSW5kZXggJiYgIWFjdGlvbi5wYXJhbXMpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIFJlbW92ZSB0aGUgbm93IHVudXNlZCByb3V0ZXMgYXQgdGhlIHRhaWwgb2YgdGhlIHJvdXRlcyBhcnJheVxuICAgICAgICAgIGNvbnN0IHJvdXRlcyA9IHN0YXRlLnJvdXRlcy5zbGljZSgwLCBsYXN0Um91dGVJbmRleCArIDEpO1xuXG4gICAgICAgICAgLy8gQXBwbHkgcGFyYW1zIGlmIHByb3ZpZGVkLCBvdGhlcndpc2UgbGVhdmUgcm91dGUgaWRlbnRpdHkgaW50YWN0XG4gICAgICAgICAgaWYgKGFjdGlvbi5wYXJhbXMpIHtcbiAgICAgICAgICAgIGNvbnN0IHJvdXRlID0gc3RhdGUucm91dGVzW2xhc3RSb3V0ZUluZGV4XTtcbiAgICAgICAgICAgIHJvdXRlc1tsYXN0Um91dGVJbmRleF0gPSB7XG4gICAgICAgICAgICAgIC4uLnJvdXRlLFxuICAgICAgICAgICAgICBwYXJhbXM6IHtcbiAgICAgICAgICAgICAgICAuLi5yb3V0ZS5wYXJhbXMsXG4gICAgICAgICAgICAgICAgLi4uYWN0aW9uLnBhcmFtcyxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfVxuICAgICAgICAgIC8vIFJldHVybiBzdGF0ZSB3aXRoIG5ldyBpbmRleC4gQ2hhbmdlIGlzVHJhbnNpdGlvbmluZyBvbmx5IGlmIGluZGV4IGhhcyBjaGFuZ2VkXG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIC4uLnN0YXRlLFxuICAgICAgICAgICAgaXNUcmFuc2l0aW9uaW5nOlxuICAgICAgICAgICAgICBzdGF0ZS5pbmRleCAhPT0gbGFzdFJvdXRlSW5kZXhcbiAgICAgICAgICAgICAgICA/IGFjdGlvbi5pbW1lZGlhdGUgIT09IHRydWVcbiAgICAgICAgICAgICAgICA6IHN0YXRlLmlzVHJhbnNpdGlvbmluZyxcbiAgICAgICAgICAgIGluZGV4OiBsYXN0Um91dGVJbmRleCxcbiAgICAgICAgICAgIHJvdXRlcyxcbiAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGNoaWxkUm91dGVyKSB7XG4gICAgICAgICAgLy8gRGVsZWdhdGUgdG8gdGhlIGNoaWxkIHJvdXRlciB3aXRoIHRoZSBnaXZlbiBhY3Rpb24sIG9yIGluaXQgaXRcbiAgICAgICAgICBjb25zdCBjaGlsZEFjdGlvbiA9XG4gICAgICAgICAgICBhY3Rpb24uYWN0aW9uIHx8XG4gICAgICAgICAgICBOYXZpZ2F0aW9uQWN0aW9ucy5pbml0KHtcbiAgICAgICAgICAgICAgcGFyYW1zOiBnZXRQYXJhbXNGb3JSb3V0ZUFuZEFjdGlvbihhY3Rpb24ucm91dGVOYW1lLCBhY3Rpb24pLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgcm91dGUgPSB7XG4gICAgICAgICAgICBwYXJhbXM6IGdldFBhcmFtc0ZvclJvdXRlQW5kQWN0aW9uKGFjdGlvbi5yb3V0ZU5hbWUsIGFjdGlvbiksXG4gICAgICAgICAgICAvLyBub3RlKGJyZW50dmF0bmUpOiBkb2VzIGl0IG1ha2Ugc2Vuc2UgdG8gd2lwZSBvdXQgdGhlIHBhcmFtc1xuICAgICAgICAgICAgLy8gaGVyZT8gb3IgZXZlbiB0byBhZGQgcGFyYW1zIGF0IGFsbD8gbmVlZCBtb3JlIGluZm8gYWJvdXQgd2hhdFxuICAgICAgICAgICAgLy8gdGhpcyBzb2x2ZXNcbiAgICAgICAgICAgIC4uLmNoaWxkUm91dGVyLmdldFN0YXRlRm9yQWN0aW9uKGNoaWxkQWN0aW9uKSxcbiAgICAgICAgICAgIHJvdXRlTmFtZTogYWN0aW9uLnJvdXRlTmFtZSxcbiAgICAgICAgICAgIGtleTogYWN0aW9uLmtleSB8fCBnZW5lcmF0ZUtleSgpLFxuICAgICAgICAgIH07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gQ3JlYXRlIHRoZSByb3V0ZSBmcm9tIHNjcmF0Y2hcbiAgICAgICAgICByb3V0ZSA9IHtcbiAgICAgICAgICAgIHBhcmFtczogZ2V0UGFyYW1zRm9yUm91dGVBbmRBY3Rpb24oYWN0aW9uLnJvdXRlTmFtZSwgYWN0aW9uKSxcbiAgICAgICAgICAgIHJvdXRlTmFtZTogYWN0aW9uLnJvdXRlTmFtZSxcbiAgICAgICAgICAgIGtleTogYWN0aW9uLmtleSB8fCBnZW5lcmF0ZUtleSgpLFxuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAuLi5TdGF0ZVV0aWxzLnB1c2goc3RhdGUsIHJvdXRlKSxcbiAgICAgICAgICBpc1RyYW5zaXRpb25pbmc6IGFjdGlvbi5pbW1lZGlhdGUgIT09IHRydWUsXG4gICAgICAgIH07XG4gICAgICB9IGVsc2UgaWYgKFxuICAgICAgICBhY3Rpb24udHlwZSA9PT0gU3RhY2tBY3Rpb25zLlBVU0ggJiZcbiAgICAgICAgY2hpbGRSb3V0ZXJzW2FjdGlvbi5yb3V0ZU5hbWVdID09PSB1bmRlZmluZWRcbiAgICAgICkge1xuICAgICAgICAvLyBSZXR1cm4gdGhlIHN0YXRlIGlkZW50aXR5IHRvIGJ1YmJsZSB0aGUgYWN0aW9uIHVwXG4gICAgICAgIHJldHVybiBzdGF0ZTtcbiAgICAgIH1cblxuICAgICAgLy8gSGFuZGxlIG5hdmlnYXRpb24gdG8gb3RoZXIgY2hpbGQgcm91dGVycyB0aGF0IGFyZSBub3QgeWV0IHB1c2hlZFxuICAgICAgaWYgKGJlaGF2ZXNMaWtlUHVzaEFjdGlvbihhY3Rpb24pKSB7XG4gICAgICAgIGNvbnN0IGNoaWxkUm91dGVyTmFtZXMgPSBPYmplY3Qua2V5cyhjaGlsZFJvdXRlcnMpO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNoaWxkUm91dGVyTmFtZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICBjb25zdCBjaGlsZFJvdXRlck5hbWUgPSBjaGlsZFJvdXRlck5hbWVzW2ldO1xuICAgICAgICAgIGNvbnN0IGNoaWxkUm91dGVyID0gY2hpbGRSb3V0ZXJzW2NoaWxkUm91dGVyTmFtZV07XG4gICAgICAgICAgaWYgKGNoaWxkUm91dGVyKSB7XG4gICAgICAgICAgICAvLyBGb3IgZWFjaCBjaGlsZCByb3V0ZXIsIHN0YXJ0IHdpdGggYSBibGFuayBzdGF0ZVxuICAgICAgICAgICAgY29uc3QgaW5pdENoaWxkUm91dGUgPSBjaGlsZFJvdXRlci5nZXRTdGF0ZUZvckFjdGlvbihcbiAgICAgICAgICAgICAgTmF2aWdhdGlvbkFjdGlvbnMuaW5pdCgpXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgLy8gVGhlbiBjaGVjayB0byBzZWUgaWYgdGhlIHJvdXRlciBoYW5kbGVzIG91ciBuYXZpZ2F0ZSBhY3Rpb25cbiAgICAgICAgICAgIGNvbnN0IG5hdmlnYXRlZENoaWxkUm91dGUgPSBjaGlsZFJvdXRlci5nZXRTdGF0ZUZvckFjdGlvbihcbiAgICAgICAgICAgICAgYWN0aW9uLFxuICAgICAgICAgICAgICBpbml0Q2hpbGRSb3V0ZVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGxldCByb3V0ZVRvUHVzaCA9IG51bGw7XG4gICAgICAgICAgICBpZiAobmF2aWdhdGVkQ2hpbGRSb3V0ZSA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAvLyBQdXNoIHRoZSByb3V0ZSBpZiB0aGUgcm91dGVyIGhhcyAnaGFuZGxlZCcgdGhlIGFjdGlvbiBhbmQgcmV0dXJuZWQgbnVsbFxuICAgICAgICAgICAgICByb3V0ZVRvUHVzaCA9IGluaXRDaGlsZFJvdXRlO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChuYXZpZ2F0ZWRDaGlsZFJvdXRlICE9PSBpbml0Q2hpbGRSb3V0ZSkge1xuICAgICAgICAgICAgICAvLyBQdXNoIHRoZSByb3V0ZSBpZiB0aGUgc3RhdGUgaGFzIGNoYW5nZWQgaW4gcmVzcG9uc2UgdG8gdGhpcyBuYXZpZ2F0aW9uXG4gICAgICAgICAgICAgIHJvdXRlVG9QdXNoID0gbmF2aWdhdGVkQ2hpbGRSb3V0ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChyb3V0ZVRvUHVzaCkge1xuICAgICAgICAgICAgICBjb25zdCByb3V0ZSA9IHtcbiAgICAgICAgICAgICAgICAuLi5yb3V0ZVRvUHVzaCxcbiAgICAgICAgICAgICAgICByb3V0ZU5hbWU6IGNoaWxkUm91dGVyTmFtZSxcbiAgICAgICAgICAgICAgICBrZXk6IGFjdGlvbi5rZXkgfHwgZ2VuZXJhdGVLZXkoKSxcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAuLi5TdGF0ZVV0aWxzLnB1c2goc3RhdGUsIHJvdXRlKSxcbiAgICAgICAgICAgICAgICBpc1RyYW5zaXRpb25pbmc6IGFjdGlvbi5pbW1lZGlhdGUgIT09IHRydWUsXG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIEhhbmRsZSBwb3AtdG8tdG9wIGJlaGF2aW9yLiBNYWtlIHN1cmUgdGhpcyBoYXBwZW5zIGFmdGVyIGNoaWxkcmVuIGhhdmUgaGFkIGEgY2hhbmNlIHRvIGhhbmRsZSB0aGUgYWN0aW9uLCBzbyB0aGF0IHRoZSBpbm5lciBzdGFjayBwb3BzIHRvIHRvcCBmaXJzdC5cbiAgICAgIGlmIChhY3Rpb24udHlwZSA9PT0gU3RhY2tBY3Rpb25zLlBPUF9UT19UT1ApIHtcbiAgICAgICAgLy8gUmVmdXNlIHRvIGhhbmRsZSBwb3AgdG8gdG9wIGlmIGEga2V5IGlzIGdpdmVuIHRoYXQgZG9lc24ndCBjb3JyZXNwb25kXG4gICAgICAgIC8vIHRvIHRoaXMgcm91dGVyXG4gICAgICAgIGlmIChhY3Rpb24ua2V5ICYmIHN0YXRlLmtleSAhPT0gYWN0aW9uLmtleSkge1xuICAgICAgICAgIHJldHVybiBzdGF0ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIElmIHdlJ3JlIGFscmVhZHkgYXQgdGhlIHRvcCwgdGhlbiB3ZSByZXR1cm4gdGhlIHN0YXRlIHdpdGggYSBuZXdcbiAgICAgICAgLy8gaWRlbnRpdHkgc28gdGhhdCB0aGUgYWN0aW9uIGlzIGhhbmRsZWQgYnkgdGhpcyByb3V0ZXIuXG4gICAgICAgIGlmIChzdGF0ZS5pbmRleCA+IDApIHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgLi4uc3RhdGUsXG4gICAgICAgICAgICBpc1RyYW5zaXRpb25pbmc6IGFjdGlvbi5pbW1lZGlhdGUgIT09IHRydWUsXG4gICAgICAgICAgICBpbmRleDogMCxcbiAgICAgICAgICAgIHJvdXRlczogW3N0YXRlLnJvdXRlc1swXV0sXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gc3RhdGU7XG4gICAgICB9XG5cbiAgICAgIC8vIEhhbmRsZSByZXBsYWNlIGFjdGlvblxuICAgICAgaWYgKGFjdGlvbi50eXBlID09PSBTdGFja0FjdGlvbnMuUkVQTEFDRSkge1xuICAgICAgICBsZXQgcm91dGVJbmRleDtcblxuICAgICAgICAvLyBJZiB0aGUga2V5IHBhcmFtIGlzIHVuZGVmaW5lZCwgc2V0IHRoZSBpbmRleCB0byB0aGUgbGFzdCByb3V0ZSBpbiB0aGUgc3RhY2tcbiAgICAgICAgaWYgKGFjdGlvbi5rZXkgPT09IHVuZGVmaW5lZCAmJiBzdGF0ZS5yb3V0ZXMubGVuZ3RoKSB7XG4gICAgICAgICAgcm91dGVJbmRleCA9IHN0YXRlLnJvdXRlcy5sZW5ndGggLSAxO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJvdXRlSW5kZXggPSBzdGF0ZS5yb3V0ZXMuZmluZEluZGV4KHIgPT4gci5rZXkgPT09IGFjdGlvbi5rZXkpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gT25seSByZXBsYWNlIGlmIHRoZSBrZXkgbWF0Y2hlcyBvbmUgb2Ygb3VyIHJvdXRlc1xuICAgICAgICBpZiAocm91dGVJbmRleCAhPT0gLTEpIHtcbiAgICAgICAgICBjb25zdCBjaGlsZFJvdXRlciA9IGNoaWxkUm91dGVyc1thY3Rpb24ucm91dGVOYW1lXTtcbiAgICAgICAgICBsZXQgY2hpbGRTdGF0ZSA9IHt9O1xuICAgICAgICAgIGlmIChjaGlsZFJvdXRlcikge1xuICAgICAgICAgICAgY29uc3QgY2hpbGRBY3Rpb24gPVxuICAgICAgICAgICAgICBhY3Rpb24uYWN0aW9uIHx8XG4gICAgICAgICAgICAgIE5hdmlnYXRpb25BY3Rpb25zLmluaXQoe1xuICAgICAgICAgICAgICAgIHBhcmFtczogZ2V0UGFyYW1zRm9yUm91dGVBbmRBY3Rpb24oYWN0aW9uLnJvdXRlTmFtZSwgYWN0aW9uKSxcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjaGlsZFN0YXRlID0gY2hpbGRSb3V0ZXIuZ2V0U3RhdGVGb3JBY3Rpb24oY2hpbGRBY3Rpb24pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCByb3V0ZXMgPSBbLi4uc3RhdGUucm91dGVzXTtcbiAgICAgICAgICByb3V0ZXNbcm91dGVJbmRleF0gPSB7XG4gICAgICAgICAgICBwYXJhbXM6IGdldFBhcmFtc0ZvclJvdXRlQW5kQWN0aW9uKGFjdGlvbi5yb3V0ZU5hbWUsIGFjdGlvbiksXG4gICAgICAgICAgICAvLyBtZXJnZSB0aGUgY2hpbGQgc3RhdGUgaW4gdGhpcyBvcmRlciB0byBhbGxvdyBwYXJhbXMgb3ZlcnJpZGVcbiAgICAgICAgICAgIC4uLmNoaWxkU3RhdGUsXG4gICAgICAgICAgICByb3V0ZU5hbWU6IGFjdGlvbi5yb3V0ZU5hbWUsXG4gICAgICAgICAgICBrZXk6IGFjdGlvbi5uZXdLZXkgfHwgZ2VuZXJhdGVLZXkoKSxcbiAgICAgICAgICB9O1xuICAgICAgICAgIHJldHVybiB7IC4uLnN0YXRlLCByb3V0ZXMgfTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBVcGRhdGUgdHJhbnNpdGlvbmluZyBzdGF0ZVxuICAgICAgaWYgKFxuICAgICAgICBhY3Rpb24udHlwZSA9PT0gU3RhY2tBY3Rpb25zLkNPTVBMRVRFX1RSQU5TSVRJT04gJiZcbiAgICAgICAgKGFjdGlvbi5rZXkgPT0gbnVsbCB8fCBhY3Rpb24ua2V5ID09PSBzdGF0ZS5rZXkpICYmXG4gICAgICAgIGFjdGlvbi50b0NoaWxkS2V5ID09PSBzdGF0ZS5yb3V0ZXNbc3RhdGUuaW5kZXhdLmtleSAmJlxuICAgICAgICBzdGF0ZS5pc1RyYW5zaXRpb25pbmdcbiAgICAgICkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIC4uLnN0YXRlLFxuICAgICAgICAgIGlzVHJhbnNpdGlvbmluZzogZmFsc2UsXG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIGlmIChhY3Rpb24udHlwZSA9PT0gTmF2aWdhdGlvbkFjdGlvbnMuU0VUX1BBUkFNUykge1xuICAgICAgICBjb25zdCBrZXkgPSBhY3Rpb24ua2V5O1xuICAgICAgICBjb25zdCBsYXN0Um91dGUgPSBzdGF0ZS5yb3V0ZXMuZmluZChyb3V0ZSA9PiByb3V0ZS5rZXkgPT09IGtleSk7XG4gICAgICAgIGlmIChsYXN0Um91dGUpIHtcbiAgICAgICAgICBjb25zdCBwYXJhbXMgPSB7XG4gICAgICAgICAgICAuLi5sYXN0Um91dGUucGFyYW1zLFxuICAgICAgICAgICAgLi4uYWN0aW9uLnBhcmFtcyxcbiAgICAgICAgICB9O1xuICAgICAgICAgIGNvbnN0IHJvdXRlcyA9IFsuLi5zdGF0ZS5yb3V0ZXNdO1xuICAgICAgICAgIHJvdXRlc1tzdGF0ZS5yb3V0ZXMuaW5kZXhPZihsYXN0Um91dGUpXSA9IHtcbiAgICAgICAgICAgIC4uLmxhc3RSb3V0ZSxcbiAgICAgICAgICAgIHBhcmFtcyxcbiAgICAgICAgICB9O1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAuLi5zdGF0ZSxcbiAgICAgICAgICAgIHJvdXRlcyxcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmIChhY3Rpb24udHlwZSA9PT0gU3RhY2tBY3Rpb25zLlJFU0VUKSB7XG4gICAgICAgIC8vIE9ubHkgaGFuZGxlIHJlc2V0IGFjdGlvbnMgdGhhdCBhcmUgdW5zcGVjaWZpZWQgb3IgbWF0Y2ggdGhpcyBzdGF0ZSBrZXlcbiAgICAgICAgaWYgKGFjdGlvbi5rZXkgIT0gbnVsbCAmJiBhY3Rpb24ua2V5ICE9IHN0YXRlLmtleSkge1xuICAgICAgICAgIC8vIERlbGliZXJhdGVseSB1c2UgIT0gaW5zdGVhZCBvZiAhPT0gc28gd2UgY2FuIG1hdGNoIG51bGwgd2l0aFxuICAgICAgICAgIC8vIHVuZGVmaW5lZCBvbiBlaXRoZXIgdGhlIHN0YXRlIG9yIHRoZSBhY3Rpb25cbiAgICAgICAgICByZXR1cm4gc3RhdGU7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbmV3U3RhY2tBY3Rpb25zID0gYWN0aW9uLmFjdGlvbnM7XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAuLi5zdGF0ZSxcbiAgICAgICAgICByb3V0ZXM6IG5ld1N0YWNrQWN0aW9ucy5tYXAobmV3U3RhY2tBY3Rpb24gPT4ge1xuICAgICAgICAgICAgY29uc3Qgcm91dGVyID0gY2hpbGRSb3V0ZXJzW25ld1N0YWNrQWN0aW9uLnJvdXRlTmFtZV07XG5cbiAgICAgICAgICAgIGxldCBjaGlsZFN0YXRlID0ge307XG5cbiAgICAgICAgICAgIGlmIChyb3V0ZXIpIHtcbiAgICAgICAgICAgICAgY29uc3QgY2hpbGRBY3Rpb24gPVxuICAgICAgICAgICAgICAgIG5ld1N0YWNrQWN0aW9uLmFjdGlvbiB8fFxuICAgICAgICAgICAgICAgIE5hdmlnYXRpb25BY3Rpb25zLmluaXQoe1xuICAgICAgICAgICAgICAgICAgcGFyYW1zOiBnZXRQYXJhbXNGb3JSb3V0ZUFuZEFjdGlvbihcbiAgICAgICAgICAgICAgICAgICAgbmV3U3RhY2tBY3Rpb24ucm91dGVOYW1lLFxuICAgICAgICAgICAgICAgICAgICBuZXdTdGFja0FjdGlvblxuICAgICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICBjaGlsZFN0YXRlID0gcm91dGVyLmdldFN0YXRlRm9yQWN0aW9uKGNoaWxkQWN0aW9uKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgcGFyYW1zOiBnZXRQYXJhbXNGb3JSb3V0ZUFuZEFjdGlvbihcbiAgICAgICAgICAgICAgICBuZXdTdGFja0FjdGlvbi5yb3V0ZU5hbWUsXG4gICAgICAgICAgICAgICAgbmV3U3RhY2tBY3Rpb25cbiAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgLi4uY2hpbGRTdGF0ZSxcbiAgICAgICAgICAgICAgcm91dGVOYW1lOiBuZXdTdGFja0FjdGlvbi5yb3V0ZU5hbWUsXG4gICAgICAgICAgICAgIGtleTogbmV3U3RhY2tBY3Rpb24ua2V5IHx8IGdlbmVyYXRlS2V5KCksXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH0pLFxuICAgICAgICAgIGluZGV4OiBhY3Rpb24uaW5kZXgsXG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIGlmIChcbiAgICAgICAgYWN0aW9uLnR5cGUgPT09IE5hdmlnYXRpb25BY3Rpb25zLkJBQ0sgfHxcbiAgICAgICAgYWN0aW9uLnR5cGUgPT09IFN0YWNrQWN0aW9ucy5QT1BcbiAgICAgICkge1xuICAgICAgICBjb25zdCB7IGtleSwgbiwgaW1tZWRpYXRlIH0gPSBhY3Rpb247XG4gICAgICAgIGxldCBiYWNrUm91dGVJbmRleCA9IHN0YXRlLmluZGV4O1xuICAgICAgICBpZiAoYWN0aW9uLnR5cGUgPT09IFN0YWNrQWN0aW9ucy5QT1AgJiYgbiAhPSBudWxsKSB7XG4gICAgICAgICAgLy8gZGV0ZXJtaW5lIHRoZSBpbmRleCB0byBnbyBiYWNrICpmcm9tKi4gSW4gdGhpcyBjYXNlLCBuPTEgbWVhbnMgdG8gZ29cbiAgICAgICAgICAvLyBiYWNrIGZyb20gc3RhdGUuaW5kZXgsIGFzIGlmIGl0IHdlcmUgYSBub3JtYWwgXCJCQUNLXCIgYWN0aW9uXG4gICAgICAgICAgYmFja1JvdXRlSW5kZXggPSBNYXRoLm1heCgxLCBzdGF0ZS5pbmRleCAtIG4gKyAxKTtcbiAgICAgICAgfSBlbHNlIGlmIChrZXkpIHtcbiAgICAgICAgICBjb25zdCBiYWNrUm91dGUgPSBzdGF0ZS5yb3V0ZXMuZmluZChyb3V0ZSA9PiByb3V0ZS5rZXkgPT09IGtleSk7XG4gICAgICAgICAgYmFja1JvdXRlSW5kZXggPSBzdGF0ZS5yb3V0ZXMuaW5kZXhPZihiYWNrUm91dGUpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGJhY2tSb3V0ZUluZGV4ID4gMCkge1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAuLi5zdGF0ZSxcbiAgICAgICAgICAgIHJvdXRlczogc3RhdGUucm91dGVzLnNsaWNlKDAsIGJhY2tSb3V0ZUluZGV4KSxcbiAgICAgICAgICAgIGluZGV4OiBiYWNrUm91dGVJbmRleCAtIDEsXG4gICAgICAgICAgICBpc1RyYW5zaXRpb25pbmc6IGltbWVkaWF0ZSAhPT0gdHJ1ZSxcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIEJ5IHRoaXMgcG9pbnQgaW4gdGhlIHJvdXRlcidzIHN0YXRlIGhhbmRsaW5nIGxvZ2ljLCB3ZSBoYXZlIGhhbmRsZWQgdGhlIGJlaGF2aW9yIG9mIHRoZSBhY3RpdmUgcm91dGUsIGFuZCBoYW5kbGVkIGFueSBzdGFjayBhY3Rpb25zLlxuICAgICAgLy8gSWYgd2UgaGF2ZW4ndCByZXR1cm5lZCBieSBub3csIHdlIHNob3VsZCBhbGxvdyBub24tYWN0aXZlIGNoaWxkIHJvdXRlcnMgdG8gaGFuZGxlIHRoaXMgYWN0aW9uLCBhbmQgc3dpdGNoIHRvIHRoYXQgaW5kZXggaWYgdGhlIGNoaWxkIHN0YXRlIChyb3V0ZSkgZG9lcyBjaGFuZ2UuLlxuXG4gICAgICBjb25zdCBrZXlJbmRleCA9IGFjdGlvbi5rZXkgPyBTdGF0ZVV0aWxzLmluZGV4T2Yoc3RhdGUsIGFjdGlvbi5rZXkpIDogLTE7XG5cbiAgICAgIC8vIFRyYXZlcnNlIHJvdXRlcyBmcm9tIHRoZSB0b3Agb2YgdGhlIHN0YWNrIHRvIHRoZSBib3R0b20sIHNvIHRoZVxuICAgICAgLy8gYWN0aXZlIHJvdXRlIGhhcyB0aGUgZmlyc3Qgb3Bwb3J0dW5pdHksIHRoZW4gdGhlIG9uZSBiZWZvcmUgaXQsIGV0Yy5cbiAgICAgIGZvciAobGV0IGNoaWxkUm91dGUgb2Ygc3RhdGUucm91dGVzLnNsaWNlKCkucmV2ZXJzZSgpKSB7XG4gICAgICAgIGlmIChjaGlsZFJvdXRlLmtleSA9PT0gYWN0aXZlQ2hpbGRSb3V0ZS5rZXkpIHtcbiAgICAgICAgICAvLyBza2lwIG92ZXIgdGhlIGFjdGl2ZSBjaGlsZCBiZWNhdXNlIHdlIGxldCBpdCBhdHRlbXB0IHRvIGhhbmRsZSB0aGUgYWN0aW9uIGVhcmxpZXJcbiAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICAvLyBJZiBhIGtleSBpcyBwcm92aWRlZCBhbmQgaW4gcm91dGVzIHN0YXRlIHRoZW4gbGV0J3MgdXNlIHRoYXRcbiAgICAgICAgLy8ga25vd2xlZGdlIHRvIHNraXAgZXh0cmEgZ2V0U3RhdGVGb3JBY3Rpb24gY2FsbHMgb24gb3RoZXIgY2hpbGRcbiAgICAgICAgLy8gcm91dGVyc1xuICAgICAgICBpZiAoa2V5SW5kZXggPj0gMCAmJiBjaGlsZFJvdXRlLmtleSAhPT0gYWN0aW9uLmtleSkge1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIGxldCBjaGlsZFJvdXRlciA9IGNoaWxkUm91dGVyc1tjaGlsZFJvdXRlLnJvdXRlTmFtZV07XG4gICAgICAgIGlmIChjaGlsZFJvdXRlcikge1xuICAgICAgICAgIGNvbnN0IHJvdXRlID0gY2hpbGRSb3V0ZXIuZ2V0U3RhdGVGb3JBY3Rpb24oYWN0aW9uLCBjaGlsZFJvdXRlKTtcblxuICAgICAgICAgIGlmIChyb3V0ZSA9PT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuIHN0YXRlO1xuICAgICAgICAgIH0gZWxzZSBpZiAocm91dGUgJiYgcm91dGUgIT09IGNoaWxkUm91dGUpIHtcbiAgICAgICAgICAgIHJldHVybiBTdGF0ZVV0aWxzLnJlcGxhY2VBdChcbiAgICAgICAgICAgICAgc3RhdGUsXG4gICAgICAgICAgICAgIGNoaWxkUm91dGUua2V5LFxuICAgICAgICAgICAgICByb3V0ZSxcbiAgICAgICAgICAgICAgLy8gUGVvcGxlIGRvbid0IGV4cGVjdCB0aGVzZSBhY3Rpb25zIHRvIHN3aXRjaCB0aGUgYWN0aXZlIHJvdXRlXG4gICAgICAgICAgICAgIC8vIFRPRE86IFdlIHNob3VsZCBzd2l0Y2ggdG8gYWN0aW9uLnByZXNlcnZlRm9jdXM6IHRydWUgZm9yIGRyYXdlciBpbiBmdXR1cmVcbiAgICAgICAgICAgICAgYWN0aW9uLnByZXNlcnZlRm9jdXMgfHwgYWN0aW9uLnR5cGUuaW5jbHVkZXMoJ0RSQVdFUicpXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gc3RhdGU7XG4gICAgfSxcblxuICAgIGdldFBhdGhBbmRQYXJhbXNGb3JTdGF0ZShzdGF0ZSkge1xuICAgICAgY29uc3Qgcm91dGUgPSBzdGF0ZS5yb3V0ZXNbc3RhdGUuaW5kZXhdO1xuICAgICAgcmV0dXJuIGdldFBhdGhBbmRQYXJhbXNGb3JSb3V0ZShyb3V0ZSk7XG4gICAgfSxcblxuICAgIGdldEFjdGlvbkZvclBhdGhBbmRQYXJhbXMocGF0aCwgcGFyYW1zKSB7XG4gICAgICByZXR1cm4gZ2V0QWN0aW9uRm9yUGF0aEFuZFBhcmFtcyhwYXRoLCBwYXJhbXMpO1xuICAgIH0sXG5cbiAgICBnZXRTY3JlZW5PcHRpb25zOiBjcmVhdGVDb25maWdHZXR0ZXIoXG4gICAgICByb3V0ZUNvbmZpZ3MsXG4gICAgICBzdGFja0NvbmZpZy5kZWZhdWx0TmF2aWdhdGlvbk9wdGlvbnNcbiAgICApLFxuICB9O1xufTtcbiJdfQ==