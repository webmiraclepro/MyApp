2b3ae9e108e2e3696b0edfea2298ec0d
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _objectSpread2 = _interopRequireDefault(require("@babel/runtime/helpers/objectSpread"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _react = _interopRequireDefault(require("react"));

var _reactNative = require("react-native");

var _propTypes = _interopRequireDefault(require("prop-types"));

var _reactNativeScreens = require("react-native-screens");

var _Types = require("./Types");

var _TransitionItem = _interopRequireDefault(require("./TransitionItem"));

var _TransitionItems = _interopRequireDefault(require("./TransitionItems"));

var _TransitionOverlayView = _interopRequireDefault(require("./TransitionOverlayView"));

var TransitionItemsView = function (_React$Component) {
  (0, _inherits2.default)(TransitionItemsView, _React$Component);

  function TransitionItemsView(props) {
    var _this;

    (0, _classCallCheck2.default)(this, TransitionItemsView);
    _this = (0, _possibleConstructorReturn2.default)(this, (0, _getPrototypeOf2.default)(TransitionItemsView).call(this, props));
    _this._shouldRunStartAnimation = true;

    _this.getDirectionForRoute = function (name, route) {
      var _this$state = _this.state,
          fromRoute = _this$state.fromRoute,
          toRoute = _this$state.toRoute;

      if (!fromRoute && !toRoute) {
        return _Types.RouteDirection.unknown;
      }

      if (!fromRoute) {
        return _Types.RouteDirection.to;
      }

      if (route === fromRoute) {
        return _Types.RouteDirection.from;
      }

      if (route === toRoute) {
        return _Types.RouteDirection.to;
      }

      return _Types.RouteDirection.unknown;
    };

    _this.getTransitionProgress = function () {
      var useNative = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;
      if (useNative) return _this._transitionProgress;

      if (!_this._nonNativeTransitionProgress) {
        _this._nonNativeTransitionProgress = new _reactNative.Animated.Value(-1);

        _this._transitionProgress.addListener(_reactNative.Animated.event([{
          value: _this._nonNativeTransitionProgress
        }], {
          useNativeDriver: false
        }));
      }

      return _this._nonNativeTransitionProgress;
    };

    _this.getRoutes = function () {
      var _this$state2 = _this.state,
          fromRoute = _this$state2.fromRoute,
          toRoute = _this$state2.toRoute;
      return [fromRoute, toRoute].filter(function (r) {
        return r !== null;
      });
    };

    _this.getIsAnchored = function (name, route) {
      var item = _this._transitionItems.getItemByNameAndRoute(name, route);

      if (!item) return false;
      var _this$state3 = _this.state,
          fromRoute = _this$state3.fromRoute,
          toRoute = _this$state3.toRoute;

      var sharedElements = _this._transitionItems.getSharedElements(fromRoute, toRoute);

      if (sharedElements && sharedElements.find(function (p) {
        return p.fromItem.name === item.anchor && p.fromItem.route === route;
      }) || sharedElements.find(function (p) {
        return p.toItem.name === item.anchor && p.toItem.route === route;
      })) {
        return true;
      }

      return false;
    };

    _this.getItemByNameAndRoute = function (name, route) {
      return _this._transitionItems.getItemByNameAndRoute(name, route);
    };

    _this.getItemDelayInfo = function (name, route) {
      var _this$state4 = _this.state,
          fromRoute = _this$state4.fromRoute,
          toRoute = _this$state4.toRoute;

      var transitionElements = _this._transitionItems.getItems().filter(function (itm) {
        return itm.route === route && !itm.shared && itm.delay;
      });

      var delayCount = transitionElements.length + 1;
      var delayFactor = 0;
      var delayIndex = 0;

      if (fromRoute === route) {
        delayFactor = 1;
        delayIndex = 0;
      } else if (toRoute === route) {
        delayFactor = -1;
        delayIndex = delayCount - 1;
      }

      for (var i = 0; i < transitionElements.length; i++) {
        delayIndex += delayFactor;

        if (transitionElements[i].name === name && transitionElements[i].route === route) {
          break;
        }
      }

      return {
        delayCount: delayCount,
        delayIndex: delayIndex
      };
    };

    _this.getIsPartOfSharedTransition = function (name, route) {
      var item = _this._transitionItems.getItemByNameAndRoute(name, route);

      if (!item || !item.shared) return false;
      var _this$state5 = _this.state,
          fromRoute = _this$state5.fromRoute,
          toRoute = _this$state5.toRoute;

      var sharedElements = _this._transitionItems.getSharedElements(fromRoute, toRoute);

      if (sharedElements.find(function (pair) {
        return pair.fromItem.name === item.name && pair.fromItem.route === item.route || pair.toItem.name === item.name && pair.toItem.route === item.route;
      })) {
        return true;
      }

      return false;
    };

    _this.getDirection = function () {
      var direction = _this.state.direction;
      return direction;
    };

    _this.getIndex = function () {
      var index = _this.state.index;
      return index;
    };

    _this.getIsPartOfTransition = function (name, route) {
      var item = _this._transitionItems.getItemByNameAndRoute(name, route);

      if (!item || !(item.appear || item.disappear)) return false;
      var _this$state6 = _this.state,
          fromRoute = _this$state6.fromRoute,
          toRoute = _this$state6.toRoute;

      var transitionElements = _this._transitionItems.getTransitionElements(fromRoute, toRoute);

      if (transitionElements.find(function (o) {
        return item.name === o.name && item.route === o.route;
      })) {
        return true;
      }

      return false;
    };

    _this._inUpdate = false;
    _this._isMounted = false;
    _this._viewRef = null;
    _this.state = {
      toRoute: null,
      fromRoute: null,
      direction: _Types.NavigationDirection.Unknown,
      sharedElements: null,
      transitionElements: null,
      index: -1
    };
    _this._transitionItems = new _TransitionItems.default();
    _this._transitionProgress = props.progress;

    _this._transitionProgress.setValue(-1);

    _this._interactionDonePromise = new Promise(function (resolve) {
      return _this._interactionDonePromiseDone = resolve;
    });
    return _this;
  }

  (0, _createClass2.default)(TransitionItemsView, [{
    key: "componentWillReceiveProps",
    value: function componentWillReceiveProps(nextProps) {
      this.updateFromProps(nextProps, this.props);
    }
  }, {
    key: "updateFromProps",
    value: function updateFromProps(props, prevProps) {
      if (!this._isMounted) return;
      var fromRoute = props.fromRoute,
          toRoute = props.toRoute;
      var direction = props.index >= (prevProps ? prevProps.index : Number.MIN_SAFE_INTEGER) ? _Types.NavigationDirection.forward : _Types.NavigationDirection.back;
      var index = prevProps ? props.index : 0;

      if (toRoute !== this.state.toRoute || fromRoute !== this.state.fromRoute || index !== this.state.index || direction !== this.state.direction) {
        this.setState({
          toRoute: toRoute,
          fromRoute: fromRoute,
          direction: direction,
          index: index
        });
      }
    }
  }, {
    key: "render",
    value: function render() {
      var _this2 = this;

      var _this$props = this.props,
          style = _this$props.style,
          children = _this$props.children;
      var _this$state7 = this.state,
          direction = _this$state7.direction,
          fromRoute = _this$state7.fromRoute,
          toRoute = _this$state7.toRoute,
          index = _this$state7.index,
          sharedElements = _this$state7.sharedElements,
          transitionElements = _this$state7.transitionElements;
      return _react.default.createElement(_reactNative.View, (0, _extends2.default)({}, this.props, {
        style: [styles.container, style],
        ref: function ref(_ref) {
          return _this2._viewRef = _ref;
        },
        collapsable: false
      }), _react.default.createElement(_reactNativeScreens.ScreenContainer, {
        style: (0, _objectSpread2.default)({}, _reactNative.StyleSheet.absoluteFillObject)
      }, children), _react.default.createElement(_TransitionOverlayView.default, {
        direction: direction,
        fromRoute: fromRoute,
        toRoute: toRoute,
        index: index,
        sharedElements: sharedElements,
        transitionElements: transitionElements
      }));
    }
  }, {
    key: "getViewMetrics",
    value: function getViewMetrics() {
      var nodeHandle, viewMetrics, promise;
      return _regenerator.default.async(function getViewMetrics$(_context) {
        while (1) {
          switch (_context.prev = _context.next) {
            case 0:
              nodeHandle = (0, _reactNative.findNodeHandle)(this._viewRef);

              if (nodeHandle) {
                _context.next = 3;
                break;
              }

              return _context.abrupt("return", viewMetrics);

            case 3:
              promise = new Promise(function (resolve) {
                _reactNative.UIManager.measureInWindow(nodeHandle, function (x, y, width, height) {
                  viewMetrics = {
                    x: x,
                    y: y,
                    width: width,
                    height: height
                  };
                  resolve();
                });
              });
              _context.next = 6;
              return _regenerator.default.awrap(promise);

            case 6:
              return _context.abrupt("return", viewMetrics);

            case 7:
            case "end":
              return _context.stop();
          }
        }
      }, null, this);
    }
  }, {
    key: "measureItems",
    value: function measureItems(sharedElements, transitionElements) {
      var promises, viewMetrics, i, pair, n, _n, _i;

      return _regenerator.default.async(function measureItems$(_context2) {
        while (1) {
          switch (_context2.prev = _context2.next) {
            case 0:
              promises = [];
              _context2.next = 3;
              return _regenerator.default.awrap(this.getViewMetrics());

            case 3:
              viewMetrics = _context2.sent;

              if (sharedElements) {
                for (i = 0; i < sharedElements.length; i++) {
                  pair = sharedElements[i];
                  promises.push(this.measureItem(viewMetrics, pair.fromItem));
                  promises.push(this.measureItem(viewMetrics, pair.toItem));

                  if (pair.fromItem && pair.fromItem.anchors) {
                    for (n = 0; n < pair.fromItem.anchors.length; n++) {
                      promises.push(this.measureItem(viewMetrics, pair.fromItem.anchors[n]));
                    }
                  }

                  if (pair.toItem && pair.toItem.anchors) {
                    for (_n = 0; _n < pair.toItem.anchors.length; _n++) {
                      promises.push(this.measureItem(viewMetrics, pair.toItem.anchors[_n]));
                    }
                  }
                }
              }

              if (transitionElements) {
                for (_i = 0; _i < transitionElements.length; _i++) {
                  promises.push(this.measureItem(viewMetrics, transitionElements[_i]));
                }
              }

              if (!(promises.length > 0)) {
                _context2.next = 9;
                break;
              }

              _context2.next = 9;
              return _regenerator.default.awrap(Promise.all(promises));

            case 9:
            case "end":
              return _context2.stop();
          }
        }
      }, null, this);
    }
  }, {
    key: "measureItem",
    value: function measureItem(viewMetrics, item) {
      var nodeHandle;
      return _regenerator.default.async(function measureItem$(_context3) {
        while (1) {
          switch (_context3.prev = _context3.next) {
            case 0:
              nodeHandle = item.getNodeHandle();

              if (nodeHandle) {
                _context3.next = 3;
                break;
              }

              return _context3.abrupt("return");

            case 3:
              _context3.next = 5;
              return _regenerator.default.awrap(new Promise(function (resolve) {
                _reactNative.UIManager.measureInWindow(nodeHandle, function (x, y, width, height) {
                  item.updateMetrics(viewMetrics, {
                    x: x,
                    y: y,
                    width: width,
                    height: height
                  });
                  resolve();
                });
              }));

            case 5:
            case "end":
              return _context3.stop();
          }
        }
      });
    }
  }, {
    key: "componentDidUpdate",
    value: function componentDidUpdate() {
      var _this3 = this;

      if (this._inUpdate) return;
      var _this$state8 = this.state,
          fromRoute = _this$state8.fromRoute,
          toRoute = _this$state8.toRoute;
      if (!fromRoute && !toRoute) return;
      this._inUpdate = true;

      var measureAndUpdateFunc = function measureAndUpdateFunc() {
        var sharedElements, transitionElements;
        return _regenerator.default.async(function measureAndUpdateFunc$(_context4) {
          while (1) {
            switch (_context4.prev = _context4.next) {
              case 0:
                sharedElements = _this3._transitionItems.getSharedElements(fromRoute, toRoute);
                transitionElements = _this3._transitionItems.getTransitionElements(fromRoute, toRoute);
                _context4.next = 4;
                return _regenerator.default.awrap(_this3._interactionDonePromise);

              case 4:
                _context4.next = 6;
                return _regenerator.default.awrap(_this3.measureItems(sharedElements, transitionElements));

              case 6:
                if (!sharedElements.find(function (p) {
                  return !p.fromItem.metrics || !p.toItem.metrics;
                }) && !transitionElements.find(function (i) {
                  return !i.metrics;
                })) {
                  _this3._transitionItems.getItems().forEach(function (item) {
                    return item.forceUpdate();
                  });

                  _this3.setState(function (prevState) {
                    return (0, _objectSpread2.default)({}, prevState, {
                      sharedElements: sharedElements,
                      transitionElements: transitionElements
                    });
                  }, function () {
                    var onLayout = _this3.props.onLayout;
                    if (onLayout) onLayout();

                    _this3._runStartAnimation(transitionElements.length);

                    _this3._inUpdate = false;
                  });
                }

              case 7:
              case "end":
                return _context4.stop();
            }
          }
        });
      };

      measureAndUpdateFunc = measureAndUpdateFunc.bind(this);
      setTimeout(measureAndUpdateFunc, 10);
    }
  }, {
    key: "_runStartAnimation",
    value: function _runStartAnimation(numberOfTransitions) {
      var getTransitionConfig, _this$props2, toRoute, navigation, index, transitionSpec, timing, animations;

      return _regenerator.default.async(function _runStartAnimation$(_context5) {
        while (1) {
          switch (_context5.prev = _context5.next) {
            case 0:
              if (this._shouldRunStartAnimation) {
                _context5.next = 2;
                break;
              }

              return _context5.abrupt("return");

            case 2:
              this._shouldRunStartAnimation = false;
              getTransitionConfig = this.context.getTransitionConfig;
              _this$props2 = this.props, toRoute = _this$props2.toRoute, navigation = _this$props2.navigation, index = _this$props2.index;

              if (index > 0) {
                this._transitionProgress.setValue(index - 1);
              }

              transitionSpec = getTransitionConfig ? getTransitionConfig(toRoute, navigation) : {
                timing: _reactNative.Animated.timing,
                duration: 650,
                easing: _reactNative.Easing.inOut(_reactNative.Easing.poly(4)),
                isInteraction: true,
                useNativeDriver: true
              };
              timing = transitionSpec.timing;
              delete transitionSpec.timing;
              animations = [timing(this._transitionProgress, (0, _objectSpread2.default)({}, transitionSpec, {
                duration: numberOfTransitions === 0 ? 25 : transitionSpec.duration,
                toValue: index
              }))];

              _reactNative.Animated.parallel(animations).start();

            case 11:
            case "end":
              return _context5.stop();
          }
        }
      }, null, this);
    }
  }, {
    key: "componentDidMount",
    value: function componentDidMount() {
      this._isMounted = true;
      this.updateFromProps((0, _objectSpread2.default)({}, this.props, {
        index: -1
      }));
      var _this$props3 = this.props,
          fromRoute = _this$props3.fromRoute,
          toRoute = _this$props3.toRoute;

      var te = this._transitionItems.getTransitionElements(fromRoute, toRoute);

      if (te.length > 0) {
        _reactNative.InteractionManager.runAfterInteractions(this._interactionDonePromiseDone);
      } else {
        this._interactionDonePromiseDone();
      }
    }
  }, {
    key: "componentWillUnmount",
    value: function componentWillUnmount() {
      this._isMounted = false;
    }
  }, {
    key: "getChildContext",
    value: function getChildContext() {
      var _this4 = this;

      return {
        register: function register(item) {
          return _this4._transitionItems.add(item);
        },
        unregister: function unregister(name, route) {
          return _this4._transitionItems.remove(name, route);
        },
        getTransitionProgress: this.getTransitionProgress,
        getDirectionForRoute: this.getDirectionForRoute,
        getIndex: function getIndex() {
          return _this4.getIndex();
        },
        getDirection: function getDirection() {
          return _this4.getDirection() || _Types.NavigationDirection.unknown;
        },
        getIsPartOfSharedTransition: this.getIsPartOfSharedTransition,
        getIsPartOfTransition: this.getIsPartOfTransition,
        getIsAnchored: this.getIsAnchored,
        getRoutes: this.getRoutes,
        getItemByNameAndRoute: this.getItemByNameAndRoute,
        getItemDelayInfo: this.getItemDelayInfo
      };
    }
  }]);
  return TransitionItemsView;
}(_react.default.Component);

exports.default = TransitionItemsView;
TransitionItemsView.childContextTypes = {
  register: _propTypes.default.func,
  unregister: _propTypes.default.func,
  getTransitionProgress: _propTypes.default.func,
  getDirectionForRoute: _propTypes.default.func,
  getDirection: _propTypes.default.func,
  getIndex: _propTypes.default.func,
  getIsPartOfSharedTransition: _propTypes.default.func,
  getIsPartOfTransition: _propTypes.default.func,
  getRoutes: _propTypes.default.func,
  getIsAnchored: _propTypes.default.func,
  getItemByNameAndRoute: _propTypes.default.func,
  getItemDelayInfo: _propTypes.default.func
};
TransitionItemsView.contextTypes = {
  getTransitionConfig: _propTypes.default.func
};

var styles = _reactNative.StyleSheet.create({
  container: {
    flex: 1,
    overflow: 'hidden'
  }
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlRyYW5zaXRpb25JdGVtc1ZpZXcuanMiXSwibmFtZXMiOlsiVHJhbnNpdGlvbkl0ZW1zVmlldyIsInByb3BzIiwiX3Nob3VsZFJ1blN0YXJ0QW5pbWF0aW9uIiwiZ2V0RGlyZWN0aW9uRm9yUm91dGUiLCJuYW1lIiwicm91dGUiLCJzdGF0ZSIsImZyb21Sb3V0ZSIsInRvUm91dGUiLCJSb3V0ZURpcmVjdGlvbiIsInVua25vd24iLCJ0byIsImZyb20iLCJnZXRUcmFuc2l0aW9uUHJvZ3Jlc3MiLCJ1c2VOYXRpdmUiLCJfdHJhbnNpdGlvblByb2dyZXNzIiwiX25vbk5hdGl2ZVRyYW5zaXRpb25Qcm9ncmVzcyIsIkFuaW1hdGVkIiwiVmFsdWUiLCJhZGRMaXN0ZW5lciIsImV2ZW50IiwidmFsdWUiLCJ1c2VOYXRpdmVEcml2ZXIiLCJnZXRSb3V0ZXMiLCJmaWx0ZXIiLCJyIiwiZ2V0SXNBbmNob3JlZCIsIml0ZW0iLCJfdHJhbnNpdGlvbkl0ZW1zIiwiZ2V0SXRlbUJ5TmFtZUFuZFJvdXRlIiwic2hhcmVkRWxlbWVudHMiLCJnZXRTaGFyZWRFbGVtZW50cyIsImZpbmQiLCJwIiwiZnJvbUl0ZW0iLCJhbmNob3IiLCJ0b0l0ZW0iLCJnZXRJdGVtRGVsYXlJbmZvIiwidHJhbnNpdGlvbkVsZW1lbnRzIiwiZ2V0SXRlbXMiLCJpdG0iLCJzaGFyZWQiLCJkZWxheSIsImRlbGF5Q291bnQiLCJsZW5ndGgiLCJkZWxheUZhY3RvciIsImRlbGF5SW5kZXgiLCJpIiwiZ2V0SXNQYXJ0T2ZTaGFyZWRUcmFuc2l0aW9uIiwicGFpciIsImdldERpcmVjdGlvbiIsImRpcmVjdGlvbiIsImdldEluZGV4IiwiaW5kZXgiLCJnZXRJc1BhcnRPZlRyYW5zaXRpb24iLCJhcHBlYXIiLCJkaXNhcHBlYXIiLCJnZXRUcmFuc2l0aW9uRWxlbWVudHMiLCJvIiwiX2luVXBkYXRlIiwiX2lzTW91bnRlZCIsIl92aWV3UmVmIiwiTmF2aWdhdGlvbkRpcmVjdGlvbiIsIlVua25vd24iLCJUcmFuc2l0aW9uSXRlbXMiLCJwcm9ncmVzcyIsInNldFZhbHVlIiwiX2ludGVyYWN0aW9uRG9uZVByb21pc2UiLCJQcm9taXNlIiwicmVzb2x2ZSIsIl9pbnRlcmFjdGlvbkRvbmVQcm9taXNlRG9uZSIsIm5leHRQcm9wcyIsInVwZGF0ZUZyb21Qcm9wcyIsInByZXZQcm9wcyIsIk51bWJlciIsIk1JTl9TQUZFX0lOVEVHRVIiLCJmb3J3YXJkIiwiYmFjayIsInNldFN0YXRlIiwic3R5bGUiLCJjaGlsZHJlbiIsInN0eWxlcyIsImNvbnRhaW5lciIsInJlZiIsIlN0eWxlU2hlZXQiLCJhYnNvbHV0ZUZpbGxPYmplY3QiLCJub2RlSGFuZGxlIiwidmlld01ldHJpY3MiLCJwcm9taXNlIiwiVUlNYW5hZ2VyIiwibWVhc3VyZUluV2luZG93IiwieCIsInkiLCJ3aWR0aCIsImhlaWdodCIsInByb21pc2VzIiwiZ2V0Vmlld01ldHJpY3MiLCJwdXNoIiwibWVhc3VyZUl0ZW0iLCJhbmNob3JzIiwibiIsImFsbCIsImdldE5vZGVIYW5kbGUiLCJ1cGRhdGVNZXRyaWNzIiwibWVhc3VyZUFuZFVwZGF0ZUZ1bmMiLCJtZWFzdXJlSXRlbXMiLCJtZXRyaWNzIiwiZm9yRWFjaCIsImZvcmNlVXBkYXRlIiwicHJldlN0YXRlIiwib25MYXlvdXQiLCJfcnVuU3RhcnRBbmltYXRpb24iLCJiaW5kIiwic2V0VGltZW91dCIsIm51bWJlck9mVHJhbnNpdGlvbnMiLCJnZXRUcmFuc2l0aW9uQ29uZmlnIiwiY29udGV4dCIsIm5hdmlnYXRpb24iLCJ0cmFuc2l0aW9uU3BlYyIsInRpbWluZyIsImR1cmF0aW9uIiwiZWFzaW5nIiwiRWFzaW5nIiwiaW5PdXQiLCJwb2x5IiwiaXNJbnRlcmFjdGlvbiIsImFuaW1hdGlvbnMiLCJ0b1ZhbHVlIiwicGFyYWxsZWwiLCJzdGFydCIsInRlIiwiSW50ZXJhY3Rpb25NYW5hZ2VyIiwicnVuQWZ0ZXJJbnRlcmFjdGlvbnMiLCJyZWdpc3RlciIsImFkZCIsInVucmVnaXN0ZXIiLCJyZW1vdmUiLCJSZWFjdCIsIkNvbXBvbmVudCIsImNoaWxkQ29udGV4dFR5cGVzIiwiUHJvcFR5cGVzIiwiZnVuYyIsImNvbnRleHRUeXBlcyIsImNyZWF0ZSIsImZsZXgiLCJvdmVyZmxvdyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFTQTs7QUFDQTs7QUFFQTs7QUFDQTs7QUFDQTs7QUFDQTs7SUFzQnFCQSxtQjs7O0FBRW5CLCtCQUFZQyxLQUFaLEVBQW1CO0FBQUE7O0FBQUE7QUFDakIseUhBQU1BLEtBQU47QUFEaUIsVUF3Q25CQyx3QkF4Q21CLEdBd0NpQixJQXhDakI7O0FBQUEsVUE2Rm5CQyxvQkE3Rm1CLEdBNkZJLFVBQUNDLElBQUQsRUFBZUMsS0FBZixFQUFpRDtBQUFBLHdCQUN2QyxNQUFLQyxLQURrQztBQUFBLFVBQzlEQyxTQUQ4RCxlQUM5REEsU0FEOEQ7QUFBQSxVQUNuREMsT0FEbUQsZUFDbkRBLE9BRG1EOztBQUV0RSxVQUFJLENBQUNELFNBQUQsSUFBYyxDQUFDQyxPQUFuQixFQUE0QjtBQUFFLGVBQU9DLHNCQUFlQyxPQUF0QjtBQUFnQzs7QUFDOUQsVUFBSSxDQUFDSCxTQUFMLEVBQWdCO0FBQUUsZUFBT0Usc0JBQWVFLEVBQXRCO0FBQTJCOztBQUM3QyxVQUFJTixLQUFLLEtBQUtFLFNBQWQsRUFBeUI7QUFDdkIsZUFBT0Usc0JBQWVHLElBQXRCO0FBQ0Q7O0FBQUMsVUFBSVAsS0FBSyxLQUFLRyxPQUFkLEVBQXVCO0FBQ3ZCLGVBQU9DLHNCQUFlRSxFQUF0QjtBQUNEOztBQUNELGFBQU9GLHNCQUFlQyxPQUF0QjtBQUNELEtBdkdrQjs7QUFBQSxVQXlHbkJHLHFCQXpHbUIsR0F5R0ssWUFBc0I7QUFBQSxVQUFyQkMsU0FBcUIsdUVBQVQsSUFBUztBQUM1QyxVQUFJQSxTQUFKLEVBQWUsT0FBTyxNQUFLQyxtQkFBWjs7QUFFZixVQUFJLENBQUMsTUFBS0MsNEJBQVYsRUFBd0M7QUFDdEMsY0FBS0EsNEJBQUwsR0FBb0MsSUFBSUMs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QUFBQSxnQkFBZ0IsRUFBRSxLQUFLQTtBQVpsQixPQUFQO0FBY0Q7OztFQTdZOENvRyxlQUFNQyxTOzs7QUFBbEMxSSxtQixDQTJXWjJJLGlCLEdBQW9CO0FBQ3pCTixFQUFBQSxRQUFRLEVBQUVPLG1CQUFVQyxJQURLO0FBRXpCTixFQUFBQSxVQUFVLEVBQUVLLG1CQUFVQyxJQUZHO0FBR3pCaEksRUFBQUEscUJBQXFCLEVBQUUrSCxtQkFBVUMsSUFIUjtBQUl6QjFJLEVBQUFBLG9CQUFvQixFQUFFeUksbUJBQVVDLElBSlA7QUFLekIzRixFQUFBQSxZQUFZLEVBQUUwRixtQkFBVUMsSUFMQztBQU16QnpGLEVBQUFBLFFBQVEsRUFBRXdGLG1CQUFVQyxJQU5LO0FBT3pCN0YsRUFBQUEsMkJBQTJCLEVBQUU0RixtQkFBVUMsSUFQZDtBQVF6QnZGLEVBQUFBLHFCQUFxQixFQUFFc0YsbUJBQVVDLElBUlI7QUFTekJ0SCxFQUFBQSxTQUFTLEVBQUVxSCxtQkFBVUMsSUFUSTtBQVV6Qm5ILEVBQUFBLGFBQWEsRUFBRWtILG1CQUFVQyxJQVZBO0FBV3pCaEgsRUFBQUEscUJBQXFCLEVBQUUrRyxtQkFBVUMsSUFYUjtBQVl6QnhHLEVBQUFBLGdCQUFnQixFQUFFdUcsbUJBQVVDO0FBWkgsQztBQTNXUjdJLG1CLENBMFhaOEksWSxHQUFlO0FBQ3BCM0IsRUFBQUEsbUJBQW1CLEVBQUV5QixtQkFBVUM7QUFEWCxDOztBQXNCeEIsSUFBTTVELE1BQU0sR0FBR0csd0JBQVcyRCxNQUFYLENBQWtCO0FBQy9CN0QsRUFBQUEsU0FBUyxFQUFFO0FBQ1Q4RCxJQUFBQSxJQUFJLEVBQUUsQ0FERztBQUVUQyxJQUFBQSxRQUFRLEVBQUU7QUFGRDtBQURvQixDQUFsQixDQUFmIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7XG4gIFZpZXcsXG4gIFN0eWxlU2hlZXQsXG4gIFVJTWFuYWdlcixcbiAgRWFzaW5nLFxuICBJbnRlcmFjdGlvbk1hbmFnZXIsXG4gIEFuaW1hdGVkLFxuICBmaW5kTm9kZUhhbmRsZSxcbn0gZnJvbSAncmVhY3QtbmF0aXZlJztcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5pbXBvcnQgeyBTY3JlZW5Db250YWluZXIgfSBmcm9tICdyZWFjdC1uYXRpdmUtc2NyZWVucyc7XG5cbmltcG9ydCB7IE1ldHJpY3MsIE5hdmlnYXRpb25EaXJlY3Rpb24sIFJvdXRlRGlyZWN0aW9uIH0gZnJvbSAnLi9UeXBlcyc7XG5pbXBvcnQgVHJhbnNpdGlvbkl0ZW0gZnJvbSAnLi9UcmFuc2l0aW9uSXRlbSc7XG5pbXBvcnQgVHJhbnNpdGlvbkl0ZW1zIGZyb20gJy4vVHJhbnNpdGlvbkl0ZW1zJztcbmltcG9ydCBUcmFuc2l0aW9uT3ZlcmxheVZpZXcgZnJvbSAnLi9UcmFuc2l0aW9uT3ZlcmxheVZpZXcnO1xuXG50eXBlIFN0YXRlID0ge1xuICBmcm9tUm91dGU6ID9zdHJpbmcsXG4gIHRvUm91dGU6ID9zdHJpbmcsXG4gIGRpcmVjdGlvbjogTmF2aWdhdGlvbkRpcmVjdGlvbixcbiAgaW5kZXg6IG51bWJlcixcbiAgc2hhcmVkRWxlbWVudHM6ID9BcnJheTxhbnk+LFxuICB0cmFuc2l0aW9uRWxlbWVudHM6ID9BcnJheTxUcmFuc2l0aW9uSXRlbT5cbn1cblxudHlwZSBQcm9wcyA9IHtcbiAgY2hpbGRyZW46IEFycmF5PGFueT4sXG4gIHByb2dyZXNzOiBBbmltYXRlZC5WYWx1ZSxcbiAgZnJvbVJvdXRlOiBzdHJpbmcsXG4gIHRvUm91dGU6IHN0cmluZyxcbiAgaW5kZXg6ID9udW1iZXIsXG4gIG5hdmlnYXRpb246IGFueSxcbiAgc3R5bGU6IFN0eWxlU2hlZXQuU3R5bGVzLFxuICBvbkxheW91dDogKGV2dDogYW55KSA9PiB2b2lkLFxufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBUcmFuc2l0aW9uSXRlbXNWaWV3IGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50PFxuICBQcm9wcywgU3RhdGU+IHtcbiAgY29uc3RydWN0b3IocHJvcHMpIHtcbiAgICBzdXBlcihwcm9wcyk7XG4gICAgdGhpcy5faXNNb3VudGVkID0gZmFsc2U7XG4gICAgdGhpcy5fdmlld1JlZiA9IG51bGw7XG5cbiAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgdG9Sb3V0ZTogbnVsbCxcbiAgICAgIGZyb21Sb3V0ZTogbnVsbCxcbiAgICAgIGRpcmVjdGlvbjogTmF2aWdhdGlvbkRpcmVjdGlvbi5Vbmtub3duLFxuICAgICAgc2hhcmVkRWxlbWVudHM6IG51bGwsXG4gICAgICB0cmFuc2l0aW9uRWxlbWVudHM6IG51bGwsXG4gICAgICBpbmRleDogLTEsXG4gICAgfTtcblxuICAgIHRoaXMuX3RyYW5zaXRpb25JdGVtcyA9IG5ldyBUcmFuc2l0aW9uSXRlbXMoKTtcbiAgICB0aGlzLl90cmFuc2l0aW9uUHJvZ3Jlc3MgPSBwcm9wcy5wcm9ncmVzcztcbiAgICB0aGlzLl90cmFuc2l0aW9uUHJvZ3Jlc3Muc2V0VmFsdWUoLTEpOyAvLyBSZXNldCB0byBoYW5kbGUgZmlyc3QgdHJhbnNpdGlvblxuICAgIC8vIHRoaXMuX3RyYW5zaXRpb25Qcm9ncmVzcy5hZGRMaXN0ZW5lcihjb25zb2xlLmxvZyk7XG5cbiAgICB0aGlzLl9pbnRlcmFjdGlvbkRvbmVQcm9taXNlID0gbmV3IFByb21pc2UoXG4gICAgICByZXNvbHZlID0+IHRoaXMuX2ludGVyYWN0aW9uRG9uZVByb21pc2VEb25lID0gcmVzb2x2ZSxcbiAgICApO1xuICB9XG5cbiAgX3ZpZXdSZWY6ID9WaWV3O1xuXG4gIF92aWV3TWV0cmljczogTWV0cmljcztcblxuICBfdHJhbnNpdGlvbkl0ZW1zOiBUcmFuc2l0aW9uSXRlbXM7XG5cbiAgX2lzTW91bnRlZDogYm9vbGVhbjtcblxuICBfdHJhbnNpdGlvblByb2dyZXNzOiBBbmltYXRlZC5WYWx1ZTtcblxuICBfbm9uTmF0aXZlVHJhbnNpdGlvblByb2dyZXNzOiBBbmltYXRlZC5WYWx1ZTtcblxuICBfaW50ZXJhY3Rpb25Eb25lUHJvbWlzZTogUHJvbWlzZTtcblxuICBfaW50ZXJhY3Rpb25Eb25lUHJvbWlzZURvbmU6IEZ1bmN0aW9uO1xuXG4gIF9zaG91bGRSdW5TdGFydEFuaW1hdGlvbjogYm9vbGVhbiA9IHRydWU7XG5cbiAgY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyhuZXh0UHJvcHMpIHtcbiAgICB0aGlzLnVwZGF0ZUZyb21Qcm9wcyhuZXh0UHJvcHMsIHRoaXMucHJvcHMpO1xuICB9XG5cbiAgdXBkYXRlRnJvbVByb3BzKHByb3BzLCBwcmV2UHJvcHMpIHtcbiAgICBpZiAoIXRoaXMuX2lzTW91bnRlZCkgcmV0dXJuO1xuXG4gICAgY29uc3QgeyBmcm9tUm91dGUsIHRvUm91dGUgfSA9IHByb3BzO1xuICAgIGNvbnN0IGRpcmVjdGlvbiA9IHByb3BzLmluZGV4ID49IChwcmV2UHJvcHMgPyBwcmV2UHJvcHMuaW5kZXggOiBOdW1iZXIuTUlOX1NBRkVfSU5URUdFUilcbiAgICAgID8gTmF2aWdhdGlvbkRpcmVjdGlvbi5mb3J3YXJkIDogTmF2aWdhdGlvbkRpcmVjdGlvbi5iYWNrO1xuXG4gICAgY29uc3QgaW5kZXggPSBwcmV2UHJvcHMgPyBwcm9wcy5pbmRleCA6IDA7XG5cbiAgICBpZiAodG9Sb3V0ZSAhPT0gdGhpcy5zdGF0ZS50b1JvdXRlXG4gICAgICB8fCBmcm9tUm91dGUgIT09IHRoaXMuc3RhdGUuZnJvbVJvdXRlXG4gICAgICB8fCBpbmRleCAhPT0gdGhpcy5zdGF0ZS5pbmRleFxuICAgICAgfHwgZGlyZWN0aW9uICE9PSB0aGlzLnN0YXRlLmRpcmVjdGlvbikge1xuICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgIHRvUm91dGUsXG4gICAgICAgIGZyb21Sb3V0ZSxcbiAgICAgICAgZGlyZWN0aW9uLFxuICAgICAgICBpbmRleCxcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7IHN0eWxlLCBjaGlsZHJlbiB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCB7IGRpcmVjdGlvbiwgZnJvbVJvdXRlLCB0b1JvdXRlLCBpbmRleCwgc2hhcmVkRWxlbWVudHMsIHRyYW5zaXRpb25FbGVtZW50cyB9ID0gdGhpcy5zdGF0ZTtcbiAgICByZXR1cm4gKFxuICAgICAgPFZpZXdcbiAgICAgICAgey4uLnRoaXMucHJvcHN9XG4gICAgICAgIHN0eWxlPXtbc3R5bGVzLmNvbnRhaW5lciwgc3R5bGVdfVxuICAgICAgICByZWY9eyhyZWYpID0+IHRoaXMuX3ZpZXdSZWYgPSByZWZ9XG4gICAgICAgIGNvbGxhcHNhYmxlPXtmYWxzZX1cbiAgICAgID5cbiAgICAgICAgPFNjcmVlbkNvbnRhaW5lciBzdHlsZT17eyAuLi5TdHlsZVNoZWV0LmFic29sdXRlRmlsbE9iamVjdCB9fT5cbiAgICAgICAgICB7Y2hpbGRyZW59XG4gICAgICAgIDwvU2NyZWVuQ29udGFpbmVyPlxuICAgICAgICA8VHJhbnNpdGlvbk92ZXJsYXlWaWV3XG4gICAgICAgICAgZGlyZWN0aW9uPXtkaXJlY3Rpb259XG4gICAgICAgICAgZnJvbVJvdXRlPXtmcm9tUm91dGV9XG4gICAgICAgICAgdG9Sb3V0ZT17dG9Sb3V0ZX1cbiAgICAgICAgICBpbmRleD17aW5kZXh9XG4gICAgICAgICAgc2hhcmVkRWxlbWVudHM9e3NoYXJlZEVsZW1lbnRzfVxuICAgICAgICAgIHRyYW5zaXRpb25FbGVtZW50cz17dHJhbnNpdGlvbkVsZW1lbnRzfVxuICAgICAgICAvPlxuICAgICAgPC9WaWV3PlxuICAgICk7XG4gIH1cblxuICBnZXREaXJlY3Rpb25Gb3JSb3V0ZSA9IChuYW1lOiBzdHJpbmcsIHJvdXRlOiBzdHJpbmcpOiBSb3V0ZURpcmVjdGlvbiA9PiB7XG4gICAgY29uc3QgeyBmcm9tUm91dGUsIHRvUm91dGUgfSA9IHRoaXMuc3RhdGU7XG4gICAgaWYgKCFmcm9tUm91dGUgJiYgIXRvUm91dGUpIHsgcmV0dXJuIFJvdXRlRGlyZWN0aW9uLnVua25vd247IH1cbiAgICBpZiAoIWZyb21Sb3V0ZSkgeyByZXR1cm4gUm91dGVEaXJlY3Rpb24udG87IH0gLy8gRmlyc3Qgc2NyZWVuLCBhbHdheXMgZGlyZWN0aW9uIHRvXG4gICAgaWYgKHJvdXRlID09PSBmcm9tUm91dGUpIHtcbiAgICAgIHJldHVybiBSb3V0ZURpcmVjdGlvbi5mcm9tO1xuICAgIH0gaWYgKHJvdXRlID09PSB0b1JvdXRlKSB7XG4gICAgICByZXR1cm4gUm91dGVEaXJlY3Rpb24udG87XG4gICAgfVxuICAgIHJldHVybiBSb3V0ZURpcmVjdGlvbi51bmtub3duO1xuICB9XG5cbiAgZ2V0VHJhbnNpdGlvblByb2dyZXNzID0gKHVzZU5hdGl2ZSA9IHRydWUpID0+IHtcbiAgICBpZiAodXNlTmF0aXZlKSByZXR1cm4gdGhpcy5fdHJhbnNpdGlvblByb2dyZXNzO1xuXG4gICAgaWYgKCF0aGlzLl9ub25OYXRpdmVUcmFuc2l0aW9uUHJvZ3Jlc3MpIHtcbiAgICAgIHRoaXMuX25vbk5hdGl2ZVRyYW5zaXRpb25Qcm9ncmVzcyA9IG5ldyBBbmltYXRlZC5WYWx1ZSgtMSk7XG4gICAgICB0aGlzLl90cmFuc2l0aW9uUHJvZ3Jlc3MuYWRkTGlzdGVuZXIoQW5pbWF0ZWQuZXZlbnQoW3tcbiAgICAgICAgdmFsdWU6IHRoaXMuX25vbk5hdGl2ZVRyYW5zaXRpb25Qcm9ncmVzcyB9XSxcbiAgICAgIHsgdXNlTmF0aXZlRHJpdmVyOiBmYWxzZSB9KSk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLl9ub25OYXRpdmVUcmFuc2l0aW9uUHJvZ3Jlc3M7XG4gIH1cblxuICBnZXRSb3V0ZXMgPSAoKSA9PiB7XG4gICAgY29uc3QgeyBmcm9tUm91dGUsIHRvUm91dGUgfSA9IHRoaXMuc3RhdGU7XG4gICAgcmV0dXJuIFtmcm9tUm91dGUsIHRvUm91dGVdLmZpbHRlcihyID0+IHIgIT09IG51bGwpO1xuICB9XG5cbiAgZ2V0SXNBbmNob3JlZCA9IChuYW1lOiBzdHJpbmcsIHJvdXRlOiBzdHJpbmcpID0+IHtcbiAgICBjb25zdCBpdGVtID0gdGhpcy5fdHJhbnNpdGlvbkl0ZW1zLmdldEl0ZW1CeU5hbWVBbmRSb3V0ZShuYW1lLCByb3V0ZSk7XG4gICAgaWYgKCFpdGVtKSByZXR1cm4gZmFsc2U7XG5cbiAgICBjb25zdCB7IGZyb21Sb3V0ZSwgdG9Sb3V0ZSB9ID0gdGhpcy5zdGF0ZTtcbiAgICBjb25zdCBzaGFyZWRFbGVtZW50cyA9IHRoaXMuX3RyYW5zaXRpb25JdGVtcy5nZXRTaGFyZWRFbGVtZW50cyhmcm9tUm91dGUsIHRvUm91dGUpO1xuICAgIGlmIChzaGFyZWRFbGVtZW50c1xuICAgICAgJiYgKHNoYXJlZEVsZW1lbnRzLmZpbmQocCA9PiBwLmZyb21JdGVtLm5hbWUgPT09IGl0ZW0uYW5jaG9yICYmIHAuZnJvbUl0ZW0ucm91dGUgPT09IHJvdXRlKSlcbiAgICAgIHx8IHNoYXJlZEVsZW1lbnRzLmZpbmQocCA9PiBwLnRvSXRlbS5uYW1lID09PSBpdGVtLmFuY2hvciAmJiBwLnRvSXRlbS5yb3V0ZSA9PT0gcm91dGUpKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgZ2V0SXRlbUJ5TmFtZUFuZFJvdXRlID0gKFxuICAgIG5hbWU6IHN0cmluZywgcm91dGU6IHN0cmluZyxcbiAgKSA9PiB0aGlzLl90cmFuc2l0aW9uSXRlbXMuZ2V0SXRlbUJ5TmFtZUFuZFJvdXRlKG5hbWUsIHJvdXRlKVxuXG4gIGdldEl0ZW1EZWxheUluZm8gPSAobmFtZTogc3RyaW5nLCByb3V0ZTogc3RyaW5nKSA9PiB7XG4gICAgY29uc3QgeyBmcm9tUm91dGUsIHRvUm91dGUgfSA9IHRoaXMuc3RhdGU7XG4gICAgY29uc3QgdHJhbnNpdGlvbkVsZW1lbnRzID0gdGhpcy5fdHJhbnNpdGlvbkl0ZW1zXG4gICAgICAuZ2V0SXRlbXMoKVxuICAgICAgLmZpbHRlcihpdG0gPT4gaXRtLnJvdXRlID09PSByb3V0ZSAmJiAhaXRtLnNoYXJlZCAmJiBpdG0uZGVsYXkpO1xuXG4gICAgY29uc3QgZGVsYXlDb3VudCA9IHRyYW5zaXRpb25FbGVtZW50cy5sZW5ndGggKyAxO1xuICAgIGxldCBkZWxheUZhY3RvciA9IDA7XG4gICAgbGV0IGRlbGF5SW5kZXggPSAwO1xuICAgIGlmIChmcm9tUm91dGUgPT09IHJvdXRlKSB7XG4gICAgICBkZWxheUZhY3RvciA9IDE7XG4gICAgICBkZWxheUluZGV4ID0gMDtcbiAgICB9IGVsc2UgaWYgKHRvUm91dGUgPT09IHJvdXRlKSB7XG4gICAgICBkZWxheUZhY3RvciA9IC0xO1xuICAgICAgZGVsYXlJbmRleCA9IGRlbGF5Q291bnQgLSAxO1xuICAgIH1cblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdHJhbnNpdGlvbkVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBkZWxheUluZGV4ICs9IGRlbGF5RmFjdG9yO1xuICAgICAgaWYgKHRyYW5zaXRpb25FbGVtZW50c1tpXS5uYW1lID09PSBuYW1lXG4gICAgICAgICYmIHRyYW5zaXRpb25FbGVtZW50c1tpXS5yb3V0ZSA9PT0gcm91dGUpIHtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHsgZGVsYXlDb3VudCwgZGVsYXlJbmRleCB9O1xuICB9XG5cbiAgZ2V0SXNQYXJ0T2ZTaGFyZWRUcmFuc2l0aW9uID0gKG5hbWU6IHN0cmluZywgcm91dGU6IHN0cmluZykgPT4ge1xuICAgIGNvbnN0IGl0ZW0gPSB0aGlzLl90cmFuc2l0aW9uSXRlbXMuZ2V0SXRlbUJ5TmFtZUFuZFJvdXRlKG5hbWUsIHJvdXRlKTtcbiAgICBpZiAoIWl0ZW0gfHwgIWl0ZW0uc2hhcmVkKSByZXR1cm4gZmFsc2U7XG5cbiAgICBjb25zdCB7IGZyb21Sb3V0ZSwgdG9Sb3V0ZSB9ID0gdGhpcy5zdGF0ZTtcbiAgICBjb25zdCBzaGFyZWRFbGVtZW50cyA9IHRoaXMuX3RyYW5zaXRpb25JdGVtcy5nZXRTaGFyZWRFbGVtZW50cyhmcm9tUm91dGUsIHRvUm91dGUpO1xuXG4gICAgaWYgKHNoYXJlZEVsZW1lbnRzLmZpbmQocGFpciA9PiAocGFpci5mcm9tSXRlbS5uYW1lID09PSBpdGVtLm5hbWVcbiAgICAgICYmIHBhaXIuZnJvbUl0ZW0ucm91dGUgPT09IGl0ZW0ucm91dGUpXG4gICAgICB8fCAocGFpci50b0l0ZW0ubmFtZSA9PT0gaXRlbS5uYW1lICYmIHBhaXIudG9JdGVtLnJvdXRlID09PSBpdGVtLnJvdXRlKSkpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBnZXREaXJlY3Rpb24gPSAoKSA9PiB7XG4gICAgY29uc3QgeyBkaXJlY3Rpb24gfSA9IHRoaXMuc3RhdGU7XG4gICAgcmV0dXJuIGRpcmVjdGlvbjtcbiAgfVxuXG4gIGdldEluZGV4ID0gKCkgPT4ge1xuICAgIGNvbnN0IHsgaW5kZXggfSA9IHRoaXMuc3RhdGU7XG4gICAgcmV0dXJuIGluZGV4O1xuICB9XG5cbiAgZ2V0SXNQYXJ0T2ZUcmFuc2l0aW9uID0gKG5hbWU6IHN0cmluZywgcm91dGU6IHN0cmluZykgPT4ge1xuICAgIGNvbnN0IGl0ZW0gPSB0aGlzLl90cmFuc2l0aW9uSXRlbXMuZ2V0SXRlbUJ5TmFtZUFuZFJvdXRlKG5hbWUsIHJvdXRlKTtcbiAgICBpZiAoIWl0ZW0gfHwgIShpdGVtLmFwcGVhciB8fCBpdGVtLmRpc2FwcGVhcikpIHJldHVybiBmYWxzZTtcblxuICAgIGNvbnN0IHsgZnJvbVJvdXRlLCB0b1JvdXRlIH0gPSB0aGlzLnN0YXRlO1xuICAgIGNvbnN0IHRyYW5zaXRpb25FbGVtZW50cyA9IHRoaXMuX3RyYW5zaXRpb25JdGVtcy5nZXRUcmFuc2l0aW9uRWxlbWVudHMoZnJvbVJvdXRlLCB0b1JvdXRlKTtcblxuICAgIGlmICh0cmFuc2l0aW9uRWxlbWVudHMuZmluZChvID0+IGl0ZW0ubmFtZSA9PT0gby5uYW1lICYmIGl0ZW0ucm91dGUgPT09IG8ucm91dGUpKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgYXN5bmMgZ2V0Vmlld01ldHJpY3MoKTpNZXRyaWNzIHtcbiAgICBjb25zdCBub2RlSGFuZGxlID0gZmluZE5vZGVIYW5kbGUodGhpcy5fdmlld1JlZik7XG4gICAgbGV0IHZpZXdNZXRyaWNzOiBNZXRyaWNzO1xuICAgIGlmICghbm9kZUhhbmRsZSkgcmV0dXJuIHZpZXdNZXRyaWNzO1xuXG4gICAgY29uc3QgcHJvbWlzZSA9IG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xuICAgICAgVUlNYW5hZ2VyLm1lYXN1cmVJbldpbmRvdyhub2RlSGFuZGxlLCAoeCwgeSwgd2lkdGgsIGhlaWdodCkgPT4ge1xuICAgICAgICB2aWV3TWV0cmljcyA9IHsgeCwgeSwgd2lkdGgsIGhlaWdodCB9O1xuICAgICAgICByZXNvbHZlKCk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgICBhd2FpdCBwcm9taXNlO1xuICAgIHJldHVybiB2aWV3TWV0cmljcztcbiAgfVxuXG4gIGFzeW5jIG1lYXN1cmVJdGVtcyhcbiAgICBzaGFyZWRFbGVtZW50czogTWFwPFRyYW5zaXRpb25JdGVtLCBUcmFuc2l0aW9uSXRlbT4sXG4gICAgdHJhbnNpdGlvbkVsZW1lbnRzOiBBcnJheTxUcmFuc2l0aW9uSXRlbT4sXG4gICkge1xuICAgIGNvbnN0IHByb21pc2VzID0gW107XG4gICAgY29uc3Qgdmlld01ldHJpY3MgPSBhd2FpdCB0aGlzLmdldFZpZXdNZXRyaWNzKCk7XG4gICAgaWYgKHNoYXJlZEVsZW1lbnRzKSB7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNoYXJlZEVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IHBhaXIgPSBzaGFyZWRFbGVtZW50c1tpXTtcbiAgICAgICAgcHJvbWlzZXMucHVzaCh0aGlzLm1lYXN1cmVJdGVtKHZpZXdNZXRyaWNzLCBwYWlyLmZyb21JdGVtKSk7XG4gICAgICAgIHByb21pc2VzLnB1c2godGhpcy5tZWFzdXJlSXRlbSh2aWV3TWV0cmljcywgcGFpci50b0l0ZW0pKTtcbiAgICAgICAgaWYgKHBhaXIuZnJvbUl0ZW0gJiYgcGFpci5mcm9tSXRlbS5hbmNob3JzKSB7XG4gICAgICAgICAgZm9yIChsZXQgbiA9IDA7IG4gPCBwYWlyLmZyb21JdGVtLmFuY2hvcnMubGVuZ3RoOyBuKyspIHtcbiAgICAgICAgICAgIHByb21pc2VzLnB1c2godGhpcy5tZWFzdXJlSXRlbSh2aWV3TWV0cmljcywgcGFpci5mcm9tSXRlbS5hbmNob3JzW25dKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChwYWlyLnRvSXRlbSAmJiBwYWlyLnRvSXRlbS5hbmNob3JzKSB7XG4gICAgICAgICAgZm9yIChsZXQgbiA9IDA7IG4gPCBwYWlyLnRvSXRlbS5hbmNob3JzLmxlbmd0aDsgbisrKSB7XG4gICAgICAgICAgICBwcm9taXNlcy5wdXNoKHRoaXMubWVhc3VyZUl0ZW0odmlld01ldHJpY3MsIHBhaXIudG9JdGVtLmFuY2hvcnNbbl0pKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAodHJhbnNpdGlvbkVsZW1lbnRzKSB7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRyYW5zaXRpb25FbGVtZW50cy5sZW5ndGg7IGkrKykge1xuICAgICAgICBwcm9taXNlcy5wdXNoKHRoaXMubWVhc3VyZUl0ZW0odmlld01ldHJpY3MsIHRyYW5zaXRpb25FbGVtZW50c1tpXSkpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChwcm9taXNlcy5sZW5ndGggPiAwKSBhd2FpdCBQcm9taXNlLmFsbChwcm9taXNlcyk7XG4gIH1cblxuICBhc3luYyBtZWFzdXJlSXRlbSh2aWV3TWV0cmljczogTWV0cmljcywgaXRlbTogVHJhbnNpdGlvbkl0ZW0pIHtcbiAgICBjb25zdCBub2RlSGFuZGxlID0gaXRlbS5nZXROb2RlSGFuZGxlKCk7XG4gICAgaWYgKCFub2RlSGFuZGxlKSByZXR1cm47XG5cbiAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcbiAgICAgIFVJTWFuYWdlci5tZWFzdXJlSW5XaW5kb3cobm9kZUhhbmRsZSwgKHgsIHksIHdpZHRoLCBoZWlnaHQpID0+IHtcbiAgICAgICAgaXRlbS51cGRhdGVNZXRyaWNzKHZpZXdNZXRyaWNzLCB7IHgsIHksIHdpZHRoLCBoZWlnaHQgfSk7XG4gICAgICAgIHJlc29sdmUoKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgX2luVXBkYXRlOiBib29sZWFuID0gZmFsc2U7XG5cbiAgY29tcG9uZW50RGlkVXBkYXRlKCkge1xuICAgIGlmICh0aGlzLl9pblVwZGF0ZSkgcmV0dXJuO1xuICAgIGNvbnN0IHsgZnJvbVJvdXRlLCB0b1JvdXRlIH0gPSB0aGlzLnN0YXRlO1xuICAgIGlmICghZnJvbVJvdXRlICYmICF0b1JvdXRlKSByZXR1cm47XG5cbiAgICB0aGlzLl9pblVwZGF0ZSA9IHRydWU7XG5cbiAgICAvLyBXYWl0IGEgbGl0dGxlIGJpdCB0byBnaXZlIHRoZSBsYXlvdXQgc3lzdGVtIHNvbWUgdGltZSB0byByZWNvbmNpbGVcbiAgICBsZXQgbWVhc3VyZUFuZFVwZGF0ZUZ1bmMgPSBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBzaGFyZWRFbGVtZW50cyA9IHRoaXMuX3RyYW5zaXRpb25JdGVtcy5nZXRTaGFyZWRFbGVtZW50cyhmcm9tUm91dGUsIHRvUm91dGUpO1xuICAgICAgY29uc3QgdHJhbnNpdGlvbkVsZW1lbnRzID0gdGhpcy5fdHJhbnNpdGlvbkl0ZW1zLmdldFRyYW5zaXRpb25FbGVtZW50cyhmcm9tUm91dGUsIHRvUm91dGUpO1xuXG4gICAgICBhd2FpdCB0aGlzLl9pbnRlcmFjdGlvbkRvbmVQcm9taXNlO1xuICAgICAgYXdhaXQgdGhpcy5tZWFzdXJlSXRlbXMoc2hhcmVkRWxlbWVudHMsIHRyYW5zaXRpb25FbGVtZW50cyk7XG5cbiAgICAgIGlmICghc2hhcmVkRWxlbWVudHMuZmluZChwID0+ICFwLmZyb21JdGVtLm1ldHJpY3MgfHwgIXAudG9JdGVtLm1ldHJpY3MpXG4gICAgICAgICYmICF0cmFuc2l0aW9uRWxlbWVudHMuZmluZChpID0+ICFpLm1ldHJpY3MpKSB7XG4gICAgICAgIC8vIFVwZGF0ZSBzdHlsZSBiYXNlZCBvbiBjYWxjdWxhdGlvbiBieSByZS1yZW5kZXJpbmcgYWxsIHRyYW5zaXRpb24gZWxlbWVudHMuXG4gICAgICAgIC8vIFJlZiwgaHR0cHM6Ly9naXRodWIuY29tL2ZyYW0teC9GbHVpZFRyYW5zaXRpb25zL2lzc3Vlcy84XG4gICAgICAgIHRoaXMuX3RyYW5zaXRpb25JdGVtcy5nZXRJdGVtcygpLmZvckVhY2goaXRlbSA9PiBpdGVtLmZvcmNlVXBkYXRlKCkpO1xuXG4gICAgICAgIC8vIEhBQ0s6IFNldHRpbmcgc3RhdGUgaW4gY29tcG9uZW50RGlkVXBkYXRlIGlzIG5vdCBuaWNlIC0gYnV0XG4gICAgICAgIC8vIHRoaXMgaXMgdGhlIG9ubHkgd2F5IHdlIGNhbiBub3RpZnkgdGhlIHRyYW5zaXRpb25lciB0aGF0IHdlIGFyZVxuICAgICAgICAvLyByZWFkeSB0byBtb3ZlIGFsb25nIHdpdGggdGhlIHRyYW5zaXRpb24gYW5kIHdlJ3JlIHRyeWluZyB0byBiZSBuaWNlXG4gICAgICAgIC8vIGJ5IHdhaXRpbmcgYSBmZXcgbWlsbGlzZWNvbmRzXG4gICAgICAgIHRoaXMuc2V0U3RhdGUoKHByZXZTdGF0ZSkgPT4gKHtcbiAgICAgICAgICAuLi5wcmV2U3RhdGUsXG4gICAgICAgICAgc2hhcmVkRWxlbWVudHMsXG4gICAgICAgICAgdHJhbnNpdGlvbkVsZW1lbnRzLFxuICAgICAgICB9KSwgKCkgPT4ge1xuICAgICAgICAgIGNvbnN0IHsgb25MYXlvdXQgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgICAgaWYgKG9uTGF5b3V0KSBvbkxheW91dCgpO1xuICAgICAgICAgIHRoaXMuX3J1blN0YXJ0QW5pbWF0aW9uKHRyYW5zaXRpb25FbGVtZW50cy5sZW5ndGgpO1xuICAgICAgICAgIHRoaXMuX2luVXBkYXRlID0gZmFsc2U7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH07XG5cbiAgICBtZWFzdXJlQW5kVXBkYXRlRnVuYyA9IG1lYXN1cmVBbmRVcGRhdGVGdW5jLmJpbmQodGhpcyk7XG4gICAgc2V0VGltZW91dChtZWFzdXJlQW5kVXBkYXRlRnVuYywgMTApO1xuICB9XG5cbiAgYXN5bmMgX3J1blN0YXJ0QW5pbWF0aW9uKG51bWJlck9mVHJhbnNpdGlvbnM6IG51bWJlcikge1xuICAgIGlmICghdGhpcy5fc2hvdWxkUnVuU3RhcnRBbmltYXRpb24pIHsgcmV0dXJuOyB9XG5cbiAgICB0aGlzLl9zaG91bGRSdW5TdGFydEFuaW1hdGlvbiA9IGZhbHNlO1xuICAgIGNvbnN0IHsgZ2V0VHJhbnNpdGlvbkNvbmZpZyB9ID0gdGhpcy5jb250ZXh0O1xuICAgIGNvbnN0IHsgdG9Sb3V0ZSwgbmF2aWdhdGlvbiwgaW5kZXggfSA9IHRoaXMucHJvcHM7XG5cbiAgICBpZiAoaW5kZXggPiAwKSB7XG4gICAgICB0aGlzLl90cmFuc2l0aW9uUHJvZ3Jlc3Muc2V0VmFsdWUoaW5kZXggLSAxKTtcbiAgICB9XG5cbiAgICBjb25zdCB0cmFuc2l0aW9uU3BlYyA9IGdldFRyYW5zaXRpb25Db25maWdcbiAgICAgID8gZ2V0VHJhbnNpdGlvbkNvbmZpZyh0b1JvdXRlLCBuYXZpZ2F0aW9uKSA6IHtcbiAgICAgICAgdGltaW5nOiBBbmltYXRlZC50aW1pbmcsXG4gICAgICAgIGR1cmF0aW9uOiA2NTAsXG4gICAgICAgIGVhc2luZzogRWFzaW5nLmluT3V0KEVhc2luZy5wb2x5KDQpKSxcbiAgICAgICAgaXNJbnRlcmFjdGlvbjogdHJ1ZSxcbiAgICAgICAgdXNlTmF0aXZlRHJpdmVyOiB0cnVlLFxuICAgICAgfTtcblxuICAgIGNvbnN0IHsgdGltaW5nIH0gPSB0cmFuc2l0aW9uU3BlYztcbiAgICBkZWxldGUgdHJhbnNpdGlvblNwZWMudGltaW5nO1xuICAgIGNvbnN0IGFuaW1hdGlvbnMgPSBbXG4gICAgICB0aW1pbmcodGhpcy5fdHJhbnNpdGlvblByb2dyZXNzLCB7XG4gICAgICAgIC4uLnRyYW5zaXRpb25TcGVjLFxuICAgICAgICBkdXJhdGlvbjogbnVtYmVyT2ZUcmFuc2l0aW9ucyA9PT0gMCA/IDI1IDogdHJhbnNpdGlvblNwZWMuZHVyYXRpb24sXG4gICAgICAgIHRvVmFsdWU6IGluZGV4LFxuICAgICAgfSksXG4gICAgXTtcblxuICAgIEFuaW1hdGVkLnBhcmFsbGVsKGFuaW1hdGlvbnMpLnN0YXJ0KCk7XG4gIH1cblxuICBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgICB0aGlzLl9pc01vdW50ZWQgPSB0cnVlO1xuICAgIHRoaXMudXBkYXRlRnJvbVByb3BzKHsgLi4udGhpcy5wcm9wcywgaW5kZXg6IC0xIH0pO1xuICAgIC8vIGNoZWNrIGZvciB0cmFuc2l0aW9uIGVsZW1lbnRzIC0gd2UgZG9uJ3QgbmVlZCB0byB3YWl0IGZvciB0cmFuc2l0aW9uc1xuICAgIC8vIGlmIHdlIGRvbid0IGhhdmUgYW55IGFwcGVhcmluZyBlbGVtZW50c1xuICAgIGNvbnN0IHsgZnJvbVJvdXRlLCB0b1JvdXRlIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IHRlID0gdGhpcy5fdHJhbnNpdGlvbkl0ZW1zLmdldFRyYW5zaXRpb25FbGVtZW50cyhmcm9tUm91dGUsIHRvUm91dGUpO1xuICAgIGlmICh0ZS5sZW5ndGggPiAwKSB7XG4gICAgICBJbnRlcmFjdGlvbk1hbmFnZXIucnVuQWZ0ZXJJbnRlcmFjdGlvbnModGhpcy5faW50ZXJhY3Rpb25Eb25lUHJvbWlzZURvbmUpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9pbnRlcmFjdGlvbkRvbmVQcm9taXNlRG9uZSgpO1xuICAgIH1cbiAgfVxuXG4gIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xuICAgIHRoaXMuX2lzTW91bnRlZCA9IGZhbHNlO1xuICB9XG5cbiAgc3RhdGljIGNoaWxkQ29udGV4dFR5cGVzID0ge1xuICAgIHJlZ2lzdGVyOiBQcm9wVHlwZXMuZnVuYyxcbiAgICB1bnJlZ2lzdGVyOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBnZXRUcmFuc2l0aW9uUHJvZ3Jlc3M6IFByb3BUeXBlcy5mdW5jLFxuICAgIGdldERpcmVjdGlvbkZvclJvdXRlOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBnZXREaXJlY3Rpb246IFByb3BUeXBlcy5mdW5jLFxuICAgIGdldEluZGV4OiBQcm9wVHlwZXMuZnVuYyxcbiAgICBnZXRJc1BhcnRPZlNoYXJlZFRyYW5zaXRpb246IFByb3BUeXBlcy5mdW5jLFxuICAgIGdldElzUGFydE9mVHJhbnNpdGlvbjogUHJvcFR5cGVzLmZ1bmMsXG4gICAgZ2V0Um91dGVzOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBnZXRJc0FuY2hvcmVkOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBnZXRJdGVtQnlOYW1lQW5kUm91dGU6IFByb3BUeXBlcy5mdW5jLFxuICAgIGdldEl0ZW1EZWxheUluZm86IFByb3BUeXBlcy5mdW5jLFxuICB9XG5cbiAgc3RhdGljIGNvbnRleHRUeXBlcyA9IHtcbiAgICBnZXRUcmFuc2l0aW9uQ29uZmlnOiBQcm9wVHlwZXMuZnVuYyxcbiAgfVxuXG4gIGdldENoaWxkQ29udGV4dCgpIHtcbiAgICByZXR1cm4ge1xuICAgICAgcmVnaXN0ZXI6IChpdGVtKSA9PiB0aGlzLl90cmFuc2l0aW9uSXRlbXMuYWRkKGl0ZW0pLFxuICAgICAgdW5yZWdpc3RlcjogKG5hbWUsIHJvdXRlKSA9PiB0aGlzLl90cmFuc2l0aW9uSXRlbXMucmVtb3ZlKG5hbWUsIHJvdXRlKSxcbiAgICAgIGdldFRyYW5zaXRpb25Qcm9ncmVzczogdGhpcy5nZXRUcmFuc2l0aW9uUHJvZ3Jlc3MsXG4gICAgICBnZXREaXJlY3Rpb25Gb3JSb3V0ZTogdGhpcy5nZXREaXJlY3Rpb25Gb3JSb3V0ZSxcbiAgICAgIGdldEluZGV4OiAoKSA9PiB0aGlzLmdldEluZGV4KCksXG4gICAgICBnZXREaXJlY3Rpb246ICgpID0+ICh0aGlzLmdldERpcmVjdGlvbigpIHx8IE5hdmlnYXRpb25EaXJlY3Rpb24udW5rbm93biksXG4gICAgICBnZXRJc1BhcnRPZlNoYXJlZFRyYW5zaXRpb246IHRoaXMuZ2V0SXNQYXJ0T2ZTaGFyZWRUcmFuc2l0aW9uLFxuICAgICAgZ2V0SXNQYXJ0T2ZUcmFuc2l0aW9uOiB0aGlzLmdldElzUGFydE9mVHJhbnNpdGlvbixcbiAgICAgIGdldElzQW5jaG9yZWQ6IHRoaXMuZ2V0SXNBbmNob3JlZCxcbiAgICAgIGdldFJvdXRlczogdGhpcy5nZXRSb3V0ZXMsXG4gICAgICBnZXRJdGVtQnlOYW1lQW5kUm91dGU6IHRoaXMuZ2V0SXRlbUJ5TmFtZUFuZFJvdXRlLFxuICAgICAgZ2V0SXRlbURlbGF5SW5mbzogdGhpcy5nZXRJdGVtRGVsYXlJbmZvLFxuICAgIH07XG4gIH1cbn1cblxuY29uc3Qgc3R5bGVzID0gU3R5bGVTaGVldC5jcmVhdGUoe1xuICBjb250YWluZXI6IHtcbiAgICBmbGV4OiAxLFxuICAgIG92ZXJmbG93OiAnaGlkZGVuJyxcbiAgfSxcbn0pO1xuIl19